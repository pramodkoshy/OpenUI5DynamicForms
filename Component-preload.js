//@ui5-bundle com/supabase/easyui5/Component-preload.js
sap.ui.predefine("com/supabase/easyui5/Component-preload", [],function(){"use strict";console.log("Component-preload.js loaded");return{}});
sap.ui.predefine("com/supabase/easyui5/Component", ["sap/ui/core/UIComponent","sap/ui/Device","./model/models","./model/EntityCacheManager"],function(e,t,i,a){"use strict";window["sap-ui-config"]=window["sap-ui-config"]||{};window["sap-ui-config"].flexibilityServices=false;return e.extend("com.supabase.easyui5.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init:function(){e.prototype.init.apply(this,arguments);const t=new sap.ui.model.json.JSONModel(sap.ui.Device);t.setDefaultBindingMode("OneWay");this.setModel(t,"device");const i=new sap.ui.model.json.JSONModel({navExpanded:!sap.ui.Device.system.phone});this.setModel(i,"appView");this.initTheme();this.initSupabase();this.getRouter().initialize();this._entityCacheManager=new a;setTimeout(this._initSplitApp.bind(this),100)},getEntityCacheManager:function(){return this._entityCacheManager},getSupabaseClient:function(){return window.supabaseClient},initSupabase:function(){const e="https://lqoiklybmvslmkitllyp.supabase.co";const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxxb2lrbHlibXZzbG1raXRsbHlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0NTI3MDMsImV4cCI6MjA1NzAyODcwM30.407lGtQeSNQ6RUarDOIpFnfh0E9sqz0SHXgd1ug3ffA";const i=document.createElement("script");i.type="module";i.onload=()=>{window.supabaseClient=window.supabase.createClient(e,t);const i=new sap.ui.model.json.JSONModel({tables:[{id:"suppliers",title:"Suppliers",icon:"sap-icon://supplier"},{id:"products",title:"Products",icon:"sap-icon://product"},{id:"customers",title:"Customers",icon:"sap-icon://customer"},{id:"orders",title:"Orders",icon:"sap-icon://sales-order"},{id:"order_items",title:"Order Items",icon:"sap-icon://list"}]});this.setModel(i,"tables");console.log("Tables model initialized with tables:",i.getProperty("/tables").length);this._initAppControllers()};i.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";document.head.appendChild(i)},initTheme:function(){const e=["sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"];let t=localStorage.getItem("preferredTheme");if(!t||!e.includes(t)){t="sap_horizon"}sap.ui.getCore().applyTheme(t);const i=new sap.ui.model.json.JSONModel({theme:t});this.setModel(i,"settings")},_initSplitApp:function(){try{const e=this.getSplitApp();if(!e){console.error("SplitApp not found");setTimeout(this._initSplitApp.bind(this),1e3);return}if(sap.ui.Device.system.phone){e.setMode("PopoverMode");const t=this.getModel("appView");if(t){t.setProperty("/navExpanded",false)}}else if(sap.ui.Device.system.tablet){e.setMode("ShowHideMode");if(window.innerHeight>window.innerWidth){e.hideMaster()}}else{e.setMode("ShowHideMode");e.showMaster()}}catch(e){console.error("Error initializing SplitApp:",e)}},getSplitApp:function(){try{const e=this.getRootControl();if(!e){console.warn("Root control not found");return null}const t=e.byId("app");if(t){console.log("SplitApp found by ID");return t}const i=function(e){if(e instanceof sap.m.SplitApp){return e}const t=e.getMetadata().getAllAggregations();for(let a in t){const t=e.getAggregation(a);if(!t){continue}const r=Array.isArray(t)?t:[t];for(let e=0;e<r.length;e++){const t=i(r[e]);if(t){return t}}}return null};const a=i(e);if(a){console.log("SplitApp found through control tree search");return a}console.warn("SplitApp not found in control tree");return null}catch(e){console.error("Error in getSplitApp:",e);return null}},getContentDensityClass:function(){if(!this._sContentDensityClass){if(document.body.classList.contains("sapUiSizeCozy")||document.body.classList.contains("sapUiSizeCompact")){this._sContentDensityClass=""}else if(!sap.ui.Device.support.touch){this._sContentDensityClass="sapUiSizeCompact"}else{this._sContentDensityClass="sapUiSizeCozy"}}return this._sContentDensityClass},getTableMetadata:function(e){const t=`metadata_${e}`;if(this._entityCacheManager){if(this._entityCacheManager.isCached(t)){return this._entityCacheManager.getEntityData(t,{},()=>Promise.resolve(this._getDefaultTableMetadata(e)))}}return Promise.resolve(this._getDefaultTableMetadata(e))},_getDefaultTableMetadata:function(e){this._tableMetadataCache=this._tableMetadataCache||{};if(this._tableMetadataCache[e]){return this._tableMetadataCache[e]}const t={suppliers:{primaryKey:"supplier_id",titleField:"company_name",subtitleField:"contact_name",columns:[{name:"supplier_id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"company_name",label:"Company",type:"string",visible:true,editable:true,required:true},{name:"contact_name",label:"Contact Name",type:"string",visible:true,editable:true,required:false},{name:"email",label:"Contact Email",type:"email",visible:true,editable:true,required:false},{name:"phone",label:"Phone",type:"string",visible:true,editable:true,required:false},{name:"address",label:"Address",type:"text",visible:true,editable:true,required:false},{name:"city",label:"City",type:"string",visible:true,editable:true,required:false},{name:"country",label:"Country",type:"string",visible:true,editable:true,required:false},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[{table:"products",foreignKey:"supplier_id"}]},products:{primaryKey:"product_id",titleField:"product_name",subtitleField:"description",columns:[{name:"product_id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"product_name",label:"Name",type:"string",visible:true,editable:true,required:true},{name:"description",label:"Description",type:"text",visible:true,editable:true,required:false},{name:"unit_price",label:"Price",type:"number",visible:true,editable:true,required:true},{name:"category",label:"Category",type:"string",visible:true,editable:true,required:false},{name:"supplier_id",label:"Supplier",type:"relation",relation:"suppliers",visible:true,editable:true,required:true},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[{table:"order_items",foreignKey:"product_id"}]},customers:{primaryKey:"customer_id",titleField:"name",subtitleField:"email",columns:[{name:"customer_id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"name",label:"Name",type:"string",visible:true,editable:true,required:true},{name:"email",label:"Email",type:"email",visible:true,editable:true,required:true},{name:"phone",label:"Phone",type:"string",visible:true,editable:true,required:false},{name:"address",label:"Address",type:"text",visible:true,editable:true,required:false},{name:"city",label:"City",type:"string",visible:true,editable:true,required:false},{name:"country",label:"Country",type:"string",visible:true,editable:true,required:false},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[{table:"orders",foreignKey:"customer_id"}]},orders:{primaryKey:"order_id",titleField:"id",subtitleField:"status",columns:[{name:"order_id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"customer_id",label:"Customer",type:"relation",relation:"customers",visible:true,editable:true,required:true},{name:"order_date",label:"Order Date",type:"date",visible:true,editable:true,required:true},{name:"total_amount",label:"Total Amount",type:"number",visible:true,editable:true,required:true},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[{table:"order_items",foreignKey:"order_id"}]},order_items:{primaryKey:"order_item_id",titleField:"id",subtitleField:"quantity",columns:[{name:"order_item_id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"order_id",label:"Order",type:"relation",relation:"orders",visible:true,editable:true,required:true},{name:"product_id",label:"Product",type:"relation",relation:"products",visible:true,editable:true,required:true},{name:"quantity",label:"Quantity",type:"number",visible:true,editable:true,required:true},{name:"unit_price",label:"Unit Price",type:"number",visible:true,editable:true,required:true},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[]}};if(t[e]){this._tableMetadataCache[e]=t[e];if(this._entityCacheManager){const i=`metadata_${e}`;this._entityCacheManager.setEntityCache(i,t[e])}return t[e]}const i={primaryKey:"id",titleField:"name",subtitleField:"description",columns:[{name:"id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"name",label:"Name",type:"string",visible:true,editable:true,required:true},{name:"description",label:"Description",type:"text",visible:true,editable:true,required:false},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[]};this._tableMetadataCache[e]=i;if(this._entityCacheManager){const t=`metadata_${e}`;this._entityCacheManager.setEntityCache(t,i)}return i},propagateModels:function(e){if(!e)return;const t=e.getView();if(!t)return;const i=this.getModel("device");if(i&&!t.getModel("device")){t.setModel(i,"device")}const a=this.getModel("appView");if(a&&!t.getModel("appView")){t.setModel(a,"appView")}const r=this.getModel("tables");if(r&&!t.getModel("tables")){t.setModel(r,"tables")}},createContent:function(){const t=e.prototype.createContent.apply(this,arguments);const i=sap.ui.view;const a=this;sap.ui.view=function(){const e=i.apply(this,arguments);const t=e.getController();if(t){a.propagateModels(t)}return e};return t},_initAppControllers:function(){const e=this.getRootControl();if(!e)return;const t=e.getController();if(!t)return;if(typeof t._initializeNavigationList==="function"){setTimeout(function(){t._initializeNavigationList()},500)}}})});
sap.ui.predefine("com/supabase/easyui5/control/FormDialog", ["sap/ui/base/Object","sap/m/Dialog","sap/m/Button","sap/ui/layout/form/SimpleForm","sap/m/Label","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/ComboBox","sap/ui/core/Item","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,a,r,i,o,s,l,n,d,u,h,c){"use strict";return e.extend("com.supabase.easyui5.control.FormDialog",{constructor:function(t,a){e.call(this);this._oController=t;this._oDialog=null;this._oForm=null;this._oFormControls={};this._fnSuccessCallback=null;this._oParams={title:"Entity Form",mode:"create",tableId:"",entityId:"",metadata:null,entity:{},parentInfo:null,successCallback:null,cancelCallback:null};if(a){for(var r in a){if(a.hasOwnProperty(r)){this._oParams[r]=a[r]}}}this._oDialogModel=new c({title:this._oParams.title,entity:this._oParams.entity||{},validationErrors:{},busy:false});this._fnSuccessCallback=this._oParams.successCallback;this._fnCancelCallback=this._oParams.cancelCallback},open:function(){if(!this._oDialog){this._createDialog()}this._oDialogModel.setProperty("/validationErrors",{});this._oDialog.open();return this},close:function(){if(this._oDialog){this._oDialog.close()}return this},getDialog:function(){if(!this._oDialog){this._createDialog()}return this._oDialog},getModel:function(){return this._oDialogModel},_createDialog:function(){this._oForm=new r({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:0,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false});this._oDialog=new t({title:"{/title}",contentWidth:"40rem",contentHeight:"auto",resizable:true,draggable:true,modal:true,verticalScrolling:true,horizontalScrolling:false,stretch:sap.ui.Device.system.phone,content:[this._oForm],beginButton:new a({text:this._oParams.mode==="create"?"Create":"Save",type:"Emphasized",press:this._onSavePress.bind(this)}),endButton:new a({text:"Cancel",press:this._onCancelPress.bind(this)}),afterClose:this._onAfterClose.bind(this),escapeHandler:this._handleEscapeKey.bind(this),busyIndicatorDelay:0});this._oDialog.setModel(this._oDialogModel);this._oController.getView().addDependent(this._oDialog);if(this._oParams.metadata){this._createFormFields(this._oParams.metadata,this._oParams.entity)}else if(this._oParams.tableId){this._loadMetadata(this._oParams.tableId)}},_handleEscapeKey:function(e){if(this._hasChanges()){e.preventDefault();h.confirm("Are you sure you want to discard your changes?",{title:"Discard Changes",onClose:function(e){if(e===h.Action.OK){this.close()}}.bind(this)})}else{return true}},_hasChanges:function(){return true},_loadMetadata:function(e){this._oDialogModel.setProperty("/busy",true);this._oController.getTableMetadata(e).then(function(e){this._oParams.metadata=e;this._createFormFields(e,this._oParams.entity);this._oDialogModel.setProperty("/busy",false)}.bind(this)).catch(function(e){console.error("Error loading metadata:",e);this._oDialogModel.setProperty("/busy",false);h.error("Error loading form: "+e.message)}.bind(this))},_createFormFields:function(e,t){this._oForm.removeAllContent();this._oFormControls={};var a=this._oParams.parentInfo;e.columns.forEach(function(t){if(t.editable===false||t.name===e.primaryKey||t.name==="created_at"||t.name==="updated_at"){return}var r=a&&t.name===a.foreignKey;var o=new i({text:t.label,required:t.required===true});this._oForm.addContent(o);var s=this._createField(t,"/entity/"+t.name,r);this._oForm.addContent(s);this._oFormControls[t.name]=s}.bind(this))},_createField:function(e,t,a){var r;var i=e.name;var u=e.required===true;var h="{= ${/validationErrors/"+i+"} ? 'Error' : 'None' }";var c="{/validationErrors/"+i+"}";switch(e.type){case"relation":if(a){r=new o({value:{path:this._oParams.parentInfo.parentId},description:"Connected to parent "+this._oParams.parentInfo.parentTable,editable:false})}else{r=new d({selectedKey:{path:t,mode:"TwoWay"},valueState:h,valueStateText:c,width:"100%",required:u,showSecondaryValues:true,enabled:true});this._loadRelationOptions(r,e.relation,u)}break;case"boolean":r=new l({selected:{path:t,mode:"TwoWay"},enabled:true});break;case"date":r=new n({value:{path:t,mode:"TwoWay",type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",valueState:h,valueStateText:c,width:"100%",required:u,change:this._createValidationHandler.bind(this,e)});break;case"text":r=new s({value:{path:t,mode:"TwoWay"},valueState:h,valueStateText:c,rows:3,growing:true,growingMaxLines:10,width:"100%",required:u});break;case"number":r=new o({value:{path:t,mode:"TwoWay",type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",valueState:h,valueStateText:c,width:"100%",required:u,liveChange:this._createValidationHandler.bind(this,e)});break;case"email":r=new o({value:{path:t,mode:"TwoWay"},type:"Email",valueState:h,valueStateText:c,width:"100%",required:u,liveChange:this._createValidationHandler.bind(this,e)});break;default:r=new o({value:{path:t,mode:"TwoWay"},valueState:h,valueStateText:c,width:"100%",required:u,liveChange:this._createValidationHandler.bind(this,e)})}return r},_createValidationHandler:function(e,t){var a=e.name;var r=t.getSource();var i=t.getParameter("value");var o=this._oDialogModel.getProperty("/validationErrors")||{};switch(e.type){case"number":if(i&&isNaN(parseFloat(i))){o[a]="Please enter a valid number";r.setValueState("Error");r.setValueStateText("Please enter a valid number")}else{delete o[a];r.setValueState("None")}break;case"email":var s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(i&&!s.test(i)){o[a]="Please enter a valid email address";r.setValueState("Error");r.setValueStateText("Please enter a valid email address")}else{delete o[a];r.setValueState("None")}break;case"date":var l=t.getParameter("valid");if(!l){o[a]="Please enter a valid date";r.setValueState("Error");r.setValueStateText("Please enter a valid date")}else{delete o[a];r.setValueState("None")}break;default:if(e.required&&(!i||i.trim()==="")){o[a]="This field is required";r.setValueState("Error");r.setValueStateText("This field is required")}else{delete o[a];r.setValueState("None")}}this._oDialogModel.setProperty("/validationErrors",o)},_loadRelationOptions:function(e,t,a){this._oController.getTableMetadata(t).then(function(r){var i=r.primaryKey;var o=r.titleField||i;this._oController.getSupabaseClient().from(t).select("*").then(function({data:t,error:r}){if(r){console.error("Error loading relation options:",r);return}e.removeAllItems();if(!a){e.addItem(new u({key:"",text:"- None -"}))}if(t&&t.length>0){t.forEach(function(t){e.addItem(new u({key:t[i],text:t[o]}))})}})}.bind(this)).catch(function(e){console.error("Error getting metadata for relation:",e)})},_validateForm:function(){var e=this._oDialogModel.getProperty("/entity");var t=this._oParams.metadata;var a={};var r=true;t.columns.forEach(function(i){if(i.editable===false||i.name===t.primaryKey||i.name==="created_at"||i.name==="updated_at"){return}var o=i.name;var s=e[o];var l=this._oFormControls[o];if(this._oParams.parentInfo&&o===this._oParams.parentInfo.foreignKey){return}if(i.required===true&&(s===undefined||s===null||s==="")){r=false;a[o]="This field is required";if(l&&l.setValueState){l.setValueState("Error");l.setValueStateText("This field is required")}console.log("Validation failed for",o,": Required field is empty")}else if(s!==undefined&&s!==null&&s!==""){var n=true;var d="";switch(i.type){case"number":if(isNaN(parseFloat(s))||!isFinite(s)){n=false;d="Please enter a valid number"}break;case"date":var u=new Date(s);if(isNaN(u.getTime())){n=false;d="Please enter a valid date"}break;case"email":var h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!h.test(s)){n=false;d="Please enter a valid email address"}break}if(!n){r=false;a[o]=d;if(l&&l.setValueState){l.setValueState("Error");l.setValueStateText(d)}console.log("Validation failed for",o,":",d)}}}.bind(this));this._oDialogModel.setProperty("/validationErrors",a);return r},_onSavePress:function(){var e=this._oDialogModel.getProperty("/entity");var t=this._oParams.tableId;var a=this._oParams.entityId;var r=this._oParams.mode;if(!this._validateForm()){h.error("Please correct the errors in the form");return}this._oDialog.setBusy(true);var i=Object.assign({},e);if(r==="create"&&this._oParams.parentInfo){var o=this._oParams.parentInfo.foreignKey;var s=this._oParams.parentInfo.parentId;i[o]=s}if(r==="create"){this._oController.getSupabaseClient().from(t).insert(i).then(({data:e,error:t})=>{this._oDialog.setBusy(false);if(t){console.error("Error creating entity:",t);h.error("Error creating entity: "+t.message);return}this._oDialog.close();if(this._fnSuccessCallback){var a=e&&e.length>0?e[0]:i;this._fnSuccessCallback(a)}}).catch(e=>{this._oDialog.setBusy(false);console.error("Error in Supabase query:",e);h.error("Error creating entity: "+e.message)})}else if(r==="edit"){var l=this._oParams.metadata;var n=l.primaryKey;this._oController.getSupabaseClient().from(t).update(i).eq(n,a).then(({data:e,error:t})=>{this._oDialog.setBusy(false);if(t){console.error("Error updating entity:",t);h.error("Error updating entity: "+t.message);return}this._oDialog.close();if(this._fnSuccessCallback){var a=e&&e.length>0?e[0]:i;this._fnSuccessCallback(a)}}).catch(e=>{this._oDialog.setBusy(false);console.error("Error in Supabase query:",e);h.error("Error updating entity: "+e.message)})}},_onCancelPress:function(){if(this._hasChanges()){h.confirm("Are you sure you want to discard your changes?",{title:"Discard Changes",onClose:function(e){if(e===h.Action.OK){this._oDialog.close()}}.bind(this)})}else{this._oDialog.close()}},_onAfterClose:function(){if(this._fnCancelCallback){this._fnCancelCallback()}},destroy:function(){if(this._oDialog){this._oDialog.destroy();this._oDialog=null}this._oFormControls={};this._oForm=null;this._fnSuccessCallback=null;this._fnCancelCallback=null}})});
sap.ui.predefine("com/supabase/easyui5/controller/App.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/m/List","sap/m/StandardListItem","sap/m/ResponsivePopover"],function(t,e,o,i,n,s,a,l,r){"use strict";return t.extend("com.supabase.easyui5.controller.App",{onInit:function(){console.log("ðŸ” APP DEBUG: App controller initializing");try{if(this.getView()&&this.getOwnerComponent()&&this.getOwnerComponent().getContentDensityClass){this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass())}const t=this.getRouter();if(t&&typeof this._onRouteMatched==="function"){t.attachRouteMatched(this._onRouteMatched,this)}const e=new sap.ui.model.json.JSONModel({navExpanded:true});this.setModel(e,"appView");if(this.getOwnerComponent()){this.getOwnerComponent().setModel(e,"appView")}this._initResponsiveBehavior();this._waitForTablesModel()}catch(t){console.error("ðŸ” APP DEBUG: Error in App controller init:",t)}},_waitForTablesModel:function(){console.log("ðŸ” APP DEBUG: Waiting for tables model...");const t=this.getOwnerComponent().getModel("tables");if(!t){console.log("ðŸ” APP DEBUG: Tables model not yet available, waiting...");setTimeout(this._waitForTablesModel.bind(this),500);return}const e=t.getProperty("/tables");if(!e||e.length===0){console.log("ðŸ” APP DEBUG: Tables data not yet available, waiting...");setTimeout(this._waitForTablesModel.bind(this),500);return}console.log("ðŸ” APP DEBUG: Tables model available, initializing navigation list");this._initializeNavigationList()},_onRouteMatched:function(t){const e=t.getParameter("name");const o=t.getParameter("arguments");console.log("Route matched:",e,o)},_adjustSplitAppMode:function(t,e){try{const o=e.getProperty("/system/phone");const i=e.getProperty("/system/tablet");const n=this.getModel("appView");console.log("Adjusting SplitApp mode. Phone:",o,"Tablet:",i);if(o){t.setMode("PopoverMode");t.hideMaster();if(n){n.setProperty("/navExpanded",false)}const e=this.byId("collapseNavButton");if(e){e.setIcon("sap-icon://menu2");e.setTooltip("Show Navigation")}}else if(i){t.setMode("ShowHideMode");if(window.innerHeight>window.innerWidth){t.hideMaster();if(n){n.setProperty("/navExpanded",false)}const e=this.byId("collapseNavButton");if(e){e.setIcon("sap-icon://menu2");e.setTooltip("Show Navigation")}}}else{t.setMode("ShowHideMode");t.showMaster();if(n){n.setProperty("/navExpanded",true)}const e=this.byId("collapseNavButton");if(e){e.setIcon("sap-icon://navigation-left-arrow");e.setTooltip("Hide Navigation")}}}catch(t){console.error("Error adjusting SplitApp mode:",t)}},onCollapseNav:function(){try{const t=this.byId("app");if(!t){console.error("SplitApp control not found!");return}const e=this.getModel("appView");const o=e.getProperty("/navExpanded");const i=this.byId("collapseNavButton");console.log("Toggle nav button pressed. Current state:",o?"expanded":"collapsed");if(o){t.hideMaster();if(i){i.setIcon("sap-icon://navigation-right-arrow");i.setTooltip("Show Navigation")}e.setProperty("/navExpanded",false)}else{t.showMaster();if(i){i.setIcon("sap-icon://navigation-left-arrow");i.setTooltip("Hide Navigation")}e.setProperty("/navExpanded",true)}}catch(t){console.error("Error in menu toggle:",t)}},onAfterMasterOpen:function(){const t=this.getModel("appView");if(t){t.setProperty("/navExpanded",true)}const e=this.byId("collapseNavButton");if(e){e.setIcon("sap-icon://navigation-left-arrow");e.setTooltip("Hide Navigation")}console.log("Master panel opened")},onAfterMasterClose:function(){const t=this.getModel("appView");if(t){t.setProperty("/navExpanded",false)}const e=this.byId("collapseNavButton");if(e){e.setIcon("sap-icon://navigation-right-arrow");e.setTooltip("Show Navigation")}console.log("Master panel closed")},onNavHome:function(){this.getRouter().navTo("home")},onNavToEntityList:function(t){const e=t.getSource();console.log("ðŸ” MENU DEBUG: Menu item pressed:",e);let o=null;if(e.data){o=e.data("tableId");console.log("ðŸ” MENU DEBUG: Table ID from data() API:",o)}if(!o&&e.getCustomData){const t=e.getCustomData();console.log("ðŸ” MENU DEBUG: Custom data entries:",t.length);if(t&&t.length>0){for(let e=0;e<t.length;e++){if(t[e].getKey()==="tableId"){o=t[e].getValue();console.log("ðŸ” MENU DEBUG: Table ID from custom data:",o);break}}}}if(o){console.log("ðŸ” MENU DEBUG: Navigating to entity list for:",o);this.getRouter().navTo("entityList",{table:o})}else{console.error("ðŸ” MENU DEBUG: No table ID found for navigation!")}},onNavListItemSelect:function(t){const e=t.getParameter("listItem");if(e.getId()===this.byId("homeItem").getId()){this.onNavHome();return}const o=e.data("tableId");if(o){this.getRouter().navTo("entityList",{table:o})}},onShowAbout:function(){if(!this._oAboutDialog){this._oAboutDialog=new i({title:"About Supabase Management",contentWidth:"26rem",content:[new s({text:"This application provides a user-friendly interface for managing your Supabase data. It's built with OpenUI5 and supports full CRUD operations on your tables."}).addStyleClass("sapUiSmallMargin")],beginButton:new n({text:"Close",press:function(){this._oAboutDialog.close()}.bind(this)})});this.getView().addDependent(this._oAboutDialog)}this._oAboutDialog.open()},onShowSettings:function(){if(!this._oSettingsDialog){this._oSettingsDialog=new i({title:"Settings",contentWidth:"20rem",content:new a({items:[new l({title:"Theme: Horizon",type:"Active",press:function(){sap.ui.getCore().applyTheme("sap_horizon");this._oSettingsDialog.close()}.bind(this)}),new l({title:"Theme: Horizon Dark",type:"Active",press:function(){sap.ui.getCore().applyTheme("sap_horizon_dark");this._oSettingsDialog.close()}.bind(this)}),new l({title:"Theme: Horizon High Contrast Black",type:"Active",press:function(){sap.ui.getCore().applyTheme("sap_horizon_hcb");this._oSettingsDialog.close()}.bind(this)}),new l({title:"Theme: Horizon High Contrast White",type:"Active",press:function(){sap.ui.getCore().applyTheme("sap_horizon_hcw");this._oSettingsDialog.close()}.bind(this)})]}),beginButton:new n({text:"Close",press:function(){this._oSettingsDialog.close()}.bind(this)})});this.getView().addDependent(this._oSettingsDialog)}this._oSettingsDialog.open()},_initResponsiveBehavior:function(){try{const t=this.byId("app");if(!t){console.error("SplitApp control not found in view!");return}let e=this.getModel("device");if(!e){e=this.getOwnerComponent().getModel("device");if(!e){console.warn("Device model not found, creating a new one");e=new sap.ui.model.json.JSONModel(sap.ui.Device);this.getOwnerComponent().setModel(e,"device");this.setModel(e,"device")}}this._adjustSplitAppMode(t,e);const o=function(){this._adjustSplitAppMode(t,e)}.bind(this);sap.ui.Device.resize.attachHandler(o);this._fnResponsiveHandler=o}catch(t){console.error("Error initializing responsive behavior:",t)}},_initializeNavigationList:function(){console.log("ðŸ” MENU DEBUG: Starting navigation list initialization");try{const t=this.getOwnerComponent().getModel("tables");if(!t){console.error("ðŸ” MENU DEBUG: Tables model not available!");setTimeout(this._initializeNavigationList.bind(this),1e3);return}const e=t.getProperty("/tables");console.log("ðŸ” MENU DEBUG: Tables from model:",e);if(!e||e.length===0){console.error("ðŸ” MENU DEBUG: No tables found in model");setTimeout(this._initializeNavigationList.bind(this),1e3);return}const o=this.byId("navigationList");console.log("ðŸ” MENU DEBUG: Navigation list control:",o);if(!o){console.error("ðŸ” MENU DEBUG: Navigation list control not found!");return}const i=this.byId("homeItem");console.log("ðŸ” MENU DEBUG: Home item:",i);console.log("ðŸ” MENU DEBUG: Clearing existing items");o.removeAllItems();if(i){console.log("ðŸ” MENU DEBUG: Re-adding existing home item");o.addItem(i)}else{console.log("ðŸ” MENU DEBUG: Creating new home item");const t=new sap.m.StandardListItem({id:this.createId("homeItem"),title:"Home",icon:"sap-icon://home",type:"Navigation"});t.attachPress(this.onNavHome,this);o.addItem(t)}console.log("ðŸ” MENU DEBUG: Adding table items, count:",e.length);e.forEach((t,e)=>{console.log(`ðŸ” MENU DEBUG: Adding item ${e+1}:`,t.id,t.title);const i=new sap.m.StandardListItem({id:this.createId("navItem_"+t.id),title:t.title,icon:t.icon||"sap-icon://table-view",type:"Navigation"});i.addCustomData(new sap.ui.core.CustomData({key:"tableId",value:t.id,writeToDom:true}));i.attachPress(this.onNavToEntityList,this);o.addItem(i);console.log(`ðŸ” MENU DEBUG: Added item for ${t.title}`)});console.log("ðŸ” MENU DEBUG: Navigation list initialization complete!");o.invalidate()}catch(t){console.error("ðŸ” MENU DEBUG: Error in initialization:",t)}}})});
sap.ui.predefine("com/supabase/easyui5/controller/BaseController", ["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,n,o){"use strict";return e.extend("com.supabase.easyui5.controller.BaseController",{getRouter:function(){return this.getOwnerComponent().getRouter()},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},navBack:function(){const e=t.getInstance();const n=e.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{this.getRouter().navTo("home",{},true)}},getSupabaseClient:function(){return window.supabaseClient},showErrorMessage:function(e,t){let o="";if(t){o=t.message||JSON.stringify(t);console.error(e,t)}n.error(e+(o?": "+o:""))},showSuccessMessage:function(e){o.show(e)},getTableMetadata:function(e){return this.getOwnerComponent().getTableMetadata(e)},showConfirmationDialog:function(e,t,o){n.confirm(e,{title:o||"Confirmation",onClose:function(e){if(e===n.Action.OK){t()}}})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EnhancedEntityList.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Column","sap/m/Text","sap/m/Label","com/supabase/easyui5/control/FormDialog"],function(t,e,o,i,s,n){"use strict";return t.extend("com.supabase.easyui5.controller.EnhancedEntityList",{onInit:function(){const t=new e({tableName:"",tableId:"",items:[],busy:false});this.setModel(t,"viewModel");this.getRouter().getRoute("entityList").attachPatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(t){const e=t.getParameter("arguments").table;console.log("EntityList route matched with table:",e);const o=this.getModel("viewModel");o.setProperty("/tableId",e);const i=e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ");o.setProperty("/tableName",i);this.getView().byId("entityListPage").setTitle(i+" List");this.getTableMetadata(e).then(t=>{this._oTableMetadata=t;this._configureTable(t);this._loadData(e,t)}).catch(t=>{console.error("Error loading metadata:",t)})},_configureTable:function(t){},_loadData:function(t,e){},onItemPress:function(t){},onCreatePress:function(){const t=this.getModel("viewModel").getProperty("/tableId");const e=this.getModel("viewModel").getProperty("/tableName");this._oCreateDialog=new n(this,{title:"Create New "+e,mode:"create",tableId:t,successCallback:function(o){this.showSuccessMessage(e+" created successfully");this._loadData(t,this._oTableMetadata)}.bind(this),cancelCallback:function(){console.log("Create operation cancelled")}}).open()},onItemContextMenu:function(t){const e=t.getSource();const o=e.getBindingContext("viewModel");if(!o){return}const i=o.getObject();const s=this.getModel("viewModel").getProperty("/tableId");const n=this.getModel("viewModel").getProperty("/tableName");const a=this._oTableMetadata.primaryKey;const l=i[a];if(!this._oContextMenu){this._oContextMenu=new sap.m.Menu({items:[new sap.m.MenuItem({text:"Edit",icon:"sap-icon://edit",press:function(){this._openEditDialog(s,l,i,n)}.bind(this)}),new sap.m.MenuItem({text:"Delete",icon:"sap-icon://delete",press:function(){this._confirmAndDeleteEntity(s,l,n)}.bind(this)})]});this.getView().addDependent(this._oContextMenu)}this._oContextMenu.openBy(e)},onEditButtonPress:function(t){const e=t.getSource();const o=e.getParent().getParent();const i=o.getBindingContext("viewModel");if(!i){return}const s=i.getObject();const n=this.getModel("viewModel").getProperty("/tableId");const a=this.getModel("viewModel").getProperty("/tableName");const l=this._oTableMetadata.primaryKey;const c=s[l];this._openEditDialog(n,c,s,a)},_openEditDialog:function(t,e,o,i){this._oEditDialog=new n(this,{title:"Edit "+i,mode:"edit",tableId:t,entityId:e,entity:o,metadata:this._oTableMetadata,successCallback:function(e){this.showSuccessMessage(i+" updated successfully");this._loadData(t,this._oTableMetadata)}.bind(this),cancelCallback:function(){console.log("Edit operation cancelled")}}).open()},_confirmAndDeleteEntity:function(t,e,o){this.showConfirmationDialog("Are you sure you want to delete this "+o+"?",function(){this.getSupabaseClient().from(t).delete().eq(this._oTableMetadata.primaryKey,e).then(({error:e})=>{if(e){this.showErrorMessage("Error deleting "+o,e);return}this.showSuccessMessage(o+" deleted successfully");this._loadData(t,this._oTableMetadata)}).catch(t=>{this.showErrorMessage("Error deleting "+o,t)})}.bind(this),"Delete Confirmation")},onDeleteSelectedPress:function(){},onRefreshPress:function(){const t=this.getModel("viewModel").getProperty("/tableId");this._loadData(t,this._oTableMetadata)},onSearch:function(t){},onExit:function(){if(this._oCreateDialog){this._oCreateDialog.destroy();this._oCreateDialog=null}if(this._oEditDialog){this._oEditDialog.destroy();this._oEditDialog=null}if(this._oContextMenu){this._oContextMenu.destroy();this._oContextMenu=null}}})});
sap.ui.predefine("com/supabase/easyui5/controller/EnhancedFormControl", ["sap/ui/base/Object","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/ComboBox","sap/m/MultiComboBox","sap/m/Select","sap/m/RadioButtonGroup","sap/m/RadioButton","sap/m/StepInput","sap/m/Slider","sap/m/Switch","sap/m/ColorPicker","sap/m/TimePicker","sap/m/Link","sap/m/Text","sap/m/FormattedText","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/m/Token","sap/m/TokenizerRenderer","sap/m/MultiInput","sap/ui/core/Item","sap/ui/core/ListItem","sap/ui/layout/form/FormElement","sap/ui/layout/form/FormContainer","sap/ui/richtexteditor/RichTextEditor","sap/ui/unified/FileUploader"],function(e,t,a,n,r,i,o,s,m,p,l,u,d,c,y,h,w,f,x,g,T,b,F,O,k,v,S,j,M,W,D){"use strict";return e.extend("com.supabase.easyui5.control.EnhancedFormControls",{constructor:function(t){e.call(this);this._oDataService=t},createField:function(e,t,a,n){n=n||{};const r=n.fieldType||e.type||"string";if(a){return this._createEditableField(e,t,r,n)}else{return this._createDisplayField(e,t,r,n)}},_createEditableField:function(e,w,f,x){const g=e.required===true;const T="{= ${"+x.errorsPath+"/"+e.name+"} ? 'Error' : 'None' }";const b="{"+x.errorsPath+"/"+e.name+"}";const O={required:g,enabled:!(e.editable===false),width:"100%",valueState:T,valueStateText:b};const S={string:()=>new t(Object.assign({value:{path:w,mode:"TwoWay"}},O)),text:()=>new a(Object.assign({value:{path:w,mode:"TwoWay"},rows:x.rows||3,growing:true,growingMaxLines:15},O)),richtext:()=>new W(Object.assign({value:{path:w,mode:"TwoWay"},editorType:x.editorType||"TinyMCE",width:"100%",height:"300px",customToolbar:true,showGroupFont:true,showGroupLink:true,showGroupInsert:true},x.editorOptions||{})),boolean:()=>new n(Object.assign({selected:{path:w,mode:"TwoWay"},text:e.checkboxLabel},O)),switch:()=>new c(Object.assign({state:{path:w,mode:"TwoWay"},customTextOn:x.textOn||"Yes",customTextOff:x.textOff||"No"},O)),date:()=>new r(Object.assign({value:{path:w,mode:"TwoWay",type:new sap.ui.model.type.Date({pattern:x.datePattern||"yyyy-MM-dd"})},valueFormat:x.valueFormat||"yyyy-MM-dd",displayFormat:x.displayFormat||"medium"},O)),datetime:()=>new i(Object.assign({value:{path:w,mode:"TwoWay",type:new sap.ui.model.type.DateTime({pattern:x.dateTimePattern||"yyyy-MM-dd'T'HH:mm:ss"})},valueFormat:x.valueFormat||"yyyy-MM-dd'T'HH:mm:ss",displayFormat:x.displayFormat||"medium"},O)),time:()=>new h(Object.assign({value:{path:w,mode:"TwoWay",type:new sap.ui.model.type.Time({pattern:x.timePattern||"HH:mm:ss"})},valueFormat:x.valueFormat||"HH:mm:ss",displayFormat:x.displayFormat||"medium"},O)),number:()=>new t(Object.assign({value:{path:w,mode:"TwoWay",type:new sap.ui.model.type.Float({minFractionDigits:x.minFractionDigits||0,maxFractionDigits:x.maxFractionDigits||2})},type:"Number"},O)),integer:()=>new u(Object.assign({value:{path:w,mode:"TwoWay",type:new sap.ui.model.type.Integer},min:x.min!==undefined?x.min:0,max:x.max!==undefined?x.max:999999,step:x.step||1},O)),slider:()=>new d(Object.assign({value:{path:w,mode:"TwoWay"},min:x.min!==undefined?x.min:0,max:x.max!==undefined?x.max:100,step:x.step||1,showAdvancedTooltip:true,showHandleTooltip:true},O)),email:()=>new t(Object.assign({value:{path:w,mode:"TwoWay"},type:"Email"},O)),url:()=>new t(Object.assign({value:{path:w,mode:"TwoWay"},type:"Url"},O)),phone:()=>new t(Object.assign({value:{path:w,mode:"TwoWay"},type:"Tel"},O)),password:()=>new t(Object.assign({value:{path:w,mode:"TwoWay"},type:"Password"},O)),color:()=>new y(Object.assign({colorString:{path:w,mode:"TwoWay"},mode:"HSL"},O)),relation:()=>{const t=new o(Object.assign({selectedKey:{path:w,mode:"TwoWay"},showSecondaryValues:true,filterSecondaryValues:true},O));if(this._oDataService&&e.relation){this._loadRelationOptions(t,e,x)}return t},multirelation:()=>{const t=new s(Object.assign({selectedKeys:{path:w,mode:"TwoWay"},showSecondaryValues:true,filterSecondaryValues:true},O));if(this._oDataService&&e.relation){this._loadRelationOptions(t,e,x)}return t},tags:()=>{const e=new k(Object.assign({value:{path:w,mode:"TwoWay"},showValueHelp:true,enableMultiLineMode:true},O));if(x.tokensPath){const t={path:x.tokensPath,template:new F({key:"{key}",text:"{text}"})};e.bindTokens(t)}return e},select:()=>{const e=new m(Object.assign({selectedKey:{path:w,mode:"TwoWay"}},O));if(x.items&&Array.isArray(x.items)){x.items.forEach(t=>{e.addItem(new v({key:t.key,text:t.text}))})}return e},radio:()=>{const e=new p(Object.assign({selectedIndex:{path:w,mode:"TwoWay",formatter:function(e){if(x.items&&Array.isArray(x.items)){return x.items.findIndex(t=>t.key===e)}return-1}},columns:x.columns||1},O));if(x.items&&Array.isArray(x.items)){x.items.forEach(t=>{e.addButton(new l({text:t.text,tooltip:t.tooltip}))})}return e},file:()=>new D(Object.assign({value:{path:w,mode:"TwoWay"},uploadUrl:x.uploadUrl||"",uploadOnChange:x.uploadOnChange===true,maximumFileSize:x.maximumFileSize||10,fileType:x.fileTypes||["jpg","png","pdf"],buttonText:x.buttonText||"Browse...",placeholder:x.placeholder||"Choose a file"},O))};if(S[f]){return S[f]()}return S["string"]()},_createDisplayField:function(e,t,a,n){const r={string:()=>new f({text:{path:t},wrapping:true}),text:()=>new f({text:{path:t},wrapping:true,maxLines:n.maxLines||5}),richtext:()=>new x({htmlText:{path:t}}),boolean:()=>new f({text:{path:t,formatter:function(e){return e?"Yes":"No"}}}),date:()=>new f({text:{path:t,formatter:function(e){if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";return t.toLocaleDateString()}catch(e){return""}}}}),datetime:()=>new f({text:{path:t,formatter:function(e){if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";return t.toLocaleString()}catch(e){return""}}}}),time:()=>new f({text:{path:t,formatter:function(e){if(!e)return"";try{let t;if(e.includes("T")||e.includes("-")){t=new Date(e)}else{const a=e.split(":");t=new Date;t.setHours(a[0]||0);t.setMinutes(a[1]||0);t.setSeconds(a[2]||0)}if(isNaN(t.getTime()))return"";return t.toLocaleTimeString()}catch(t){return e}}}}),number:()=>new f({text:{path:t,formatter:function(e){if(e===undefined||e===null)return"";const t=n.decimals!==undefined?n.decimals:2;return parseFloat(e).toFixed(t)}}}),integer:()=>new f({text:{path:t,formatter:function(e){if(e===undefined||e===null)return"";return parseInt(e,10)}}}),email:()=>new w({text:{path:t},href:{path:t,formatter:function(e){return e?"mailto:"+e:""}},target:"_blank"}),url:()=>new w({text:{path:t},href:{path:t},target:"_blank"}),phone:()=>new w({text:{path:t},href:{path:t,formatter:function(e){return e?"tel:"+e:""}}}),relation:()=>new f({text:{path:t+"_text"}}),tags:()=>{const e=new T({wrap:sap.m.FlexWrap.Wrap,renderType:sap.m.FlexRendertype.Bare});if(n.tokensPath){const t={path:n.tokensPath,templateShareable:false,template:new f({text:"{text}"}).addStyleClass("sapMTokenizer sapMToken sapUiTinyMarginEnd sapUiTinyMarginBottom")};e.bindAggregation("items",t)}else{const a={path:t,formatter:function(e){if(!e)return[];let t;if(typeof e==="string"){t=e.split(",").map(e=>e.trim())}else if(Array.isArray(e)){t=e}else{return[]}return t.map(e=>({text:e}))}};const n={path:a.path,formatter:a.formatter,templateShareable:false,template:new f({text:"{text}"}).addStyleClass("sapMTokenizer sapMToken sapUiTinyMarginEnd sapUiTinyMarginBottom")};e.bindAggregation("items",n)}return e},select:()=>new f({text:{path:t,formatter:function(e){if(n.items&&Array.isArray(n.items)){const t=n.items.find(t=>t.key===e);return t?t.text:e}return e}}}),radio:()=>new f({text:{path:t,formatter:function(e){if(n.items&&Array.isArray(n.items)){const t=n.items.find(t=>t.key===e);return t?t.text:e}return e}}}),file:()=>new w({text:{path:t,formatter:function(e){if(!e)return"";const t=e.split("/");return t[t.length-1]}},href:{path:t},target:"_blank"})};if(r[a]){return r[a]()}return r["string"]()},_loadRelationOptions:function(e,t,a){const n=t.relation;this._oDataService.getMetadata(n).then(e=>{const t=e.primaryKey||"id";const a=e.titleField||t;return this._oDataService.getRelationOptions(n,t,a)}).then(n=>{e.removeAllItems();if(!t.required){e.addItem(new v({key:"",text:a.emptyItemText||"- None -"}))}n.forEach(t=>{e.addItem(new v({key:t.key,text:t.text}))})}).catch(t=>{console.error("Error loading relation options:",t);e.removeAllItems();e.addItem(new v({key:"",text:"Error loading options"}))})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityCreate.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Text","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/ComboBox","sap/ui/core/Item"],function(e,t,o,a,r,n,i,s,l){"use strict";return e.extend("com.supabase.easyui5.controller.EntityCreate",{onInit:function(){console.log("EntityCreate controller initializing");const e=new t({tableName:"",tableId:"",entity:{},busy:false,validationErrors:{},parentInfo:null});this.setModel(e,"viewModel");this.getRouter().getRoute("entityCreate").attachPatternMatched(this._onRouteMatched,this);this._loadParentEntityInfo()},_loadParentEntityInfo:function(){try{const e=sessionStorage.getItem("parentEntityInfo");console.log("Loading parent entity info from session storage:",e);if(e){const t=JSON.parse(e);console.log("Parsed parent info:",JSON.stringify(t,null,2));if(t.parentTable&&t.parentId&&t.foreignKey){console.log("Setting parent info in view model");const e=this.getModel("viewModel");e.setProperty("/parentInfo",t);this._parentInfoBackup=JSON.parse(JSON.stringify(t));console.log("Parent info backup created")}else{console.warn("Parent info is incomplete:",JSON.stringify(t))}}else{console.log("No parent info found in session storage")}}catch(e){console.error("Error loading parent entity info:",e)}},_onRouteMatched:function(e){try{const t=e.getParameter("arguments").table;console.log("EntityCreate route matched with table:",t);const o=this.getModel("viewModel");o.setProperty("/tableId",t);const a=t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ");o.setProperty("/tableName",a);this.getView().byId("entityCreatePage").setTitle("Create New "+a);o.setProperty("/entity",{});o.setProperty("/validationErrors",{});this._loadParentEntityInfo();this.getTableMetadata(t).then(e=>{console.log("Table metadata loaded:",JSON.stringify(e,null,2));this._initializeEntityData(e);this._configureForm(e)}).catch(e=>{console.error("Error loading metadata:",e);this.showErrorMessage("Error loading metadata: "+e.message)})}catch(e){console.error("Error in route matched handler:",e);this.showErrorMessage("An unexpected error occurred: "+e.message)}},_initializeEntityData:function(e){const t={};const o=this.getModel("viewModel");const a=o.getProperty("/parentInfo");console.log("Initializing entity data with metadata:",JSON.stringify(e.columns.map(e=>e.name),null,2));console.log("Parent info:",a?JSON.stringify(a):"none");e.columns.forEach(e=>{if(a&&e.name===a.foreignKey){console.log(`Setting foreign key ${e.name} to parent ID ${a.parentId}`);t[e.name]=a.parentId}else if(e.type==="boolean"){t[e.name]=false}else if(e.type==="number"){t[e.name]=0}else if(e.type==="date"){t[e.name]=(new Date).toISOString().split("T")[0]}else{t[e.name]=""}});console.log("Initialized entity data:",JSON.stringify(t,null,2));o.setProperty("/entity",t)},_configureForm:function(e){console.log("Detailed Metadata:",JSON.stringify(e,null,2));const t=this.getView().byId("entityCreateContainer");if(!t){console.error("CRITICAL: Form container not found!");return}t.removeAllFormElements();const o=this.getModel("viewModel");const a=o.getProperty("/entity");const r=o.getProperty("/parentInfo");console.log("Current Entity Data:",JSON.stringify(a,null,2));console.log("Parent Info:",JSON.stringify(r,null,2));const n="createForm_"+Date.now()+"_";const i=e.columns.filter(t=>!(t.editable===false||t.name===e.primaryKey||t.name==="created_at"||t.name==="updated_at"));i.forEach((e,o)=>{console.log(`Processing column: ${e.name}`);const a=e.required===true;const i=new sap.ui.layout.form.FormElement({label:new sap.m.Label({text:e.label||e.name,required:a})});const s="viewModel>/entity/"+e.name;const l=n+e.name+"_"+o;const c=r&&e.name===r.foreignKey;console.log(`Column ${e.name} - Type: ${e.type}`);try{const o=this._createInputField(e,s,a,l,c);if(o){i.addField(o);t.addFormElement(i);console.log(`Added form element for ${e.name}`)}else{console.error(`Failed to create control for ${e.name}`)}}catch(t){console.error(`Error creating control for ${e.name}:`,t)}});console.log(`Form configuration complete.`);const s=this.getView().byId("entityCreateForm");if(s){s.invalidate()}},_loadRelationOptions:function(e,t,o){console.log(`Loading relation options for ${o} from table ${t}`);this.getTableMetadata(t).then(function(o){console.log(`Metadata for related table ${t}:`,JSON.stringify(o,null,2));const a=o.primaryKey;const r=o.titleField||a;console.log(`Primary Key: ${a}, Title Field: ${r}`);this.getSupabaseClient().from(t).select("*").then(({data:t,error:o})=>{if(o){console.error("Error loading relation options",o);return}console.log(`Loaded ${t?t.length:0} relation options`);if(t&&t.length>0){console.log(`Sample record fields: ${Object.keys(t[0]).join(", ")}`)}e.removeAllItems();if(t){t.forEach(t=>{let o=t[r];if(!o){const e=["name","customer_name","company_name","title","display_name","full_name","label"];for(const a of e){if(t[a]){o=t[a];console.log(`Using alternative field '${a}' for display text`);break}}if(!o){const e=Object.keys(t).filter(e=>e!==a&&!e.endsWith("_id")&&!e.includes("created_at")&&!e.includes("updated_at"));if(e.length>0){o=t[e[0]];console.log(`Using fallback field '${e[0]}' for display text`)}}if(!o){o=`ID: ${t[a]}`}}const n=new sap.ui.core.Item({key:t[a],text:o});e.addItem(n);console.log(`Added item: Key=${t[a]}, Text=${o}`)})}})}.bind(this))},_createInputField:function(e,t,o,a,r){let n;switch(e.type){case"relation":if(r){n=new sap.m.Text({id:a,text:`Connected to parent ${this.getModel("viewModel").getProperty("/parentInfo/parentTable")} (ID: ${this.getModel("viewModel").getProperty("/parentInfo/parentId")})`})}else{n=new sap.m.ComboBox({id:a,selectedKey:{path:t},width:"100%",required:o,showSecondaryValues:true,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",selectionChange:function(t){t.getSource().setValueState("None");const o=this.getModel("viewModel");const a=o.getProperty("/validationErrors")||{};if(a[e.name]){delete a[e.name];o.setProperty("/validationErrors",a)}}.bind(this)});this._loadRelationOptions(n,e.relation,e.name)}break;case"boolean":n=new sap.m.CheckBox({id:a,selected:{path:t},width:"100%",select:function(t){const o=this.getModel("viewModel");const a=o.getProperty("/validationErrors");if(a&&a[e.name]){delete a[e.name];o.setProperty("/validationErrors",a)}}.bind(this)});break;case"date":n=new sap.m.DatePicker({id:a,value:{path:t,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",change:function(t){if(t.getParameter("valid")){t.getSource().setValueState("None");const o=this.getModel("viewModel");const a=o.getProperty("/validationErrors");if(a&&a[e.name]){delete a[e.name];o.setProperty("/validationErrors",a)}}else{t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid date");const o=this.getModel("viewModel");const a=o.getProperty("/validationErrors")||{};a[e.name]="Please enter a valid date";o.setProperty("/validationErrors",a)}}.bind(this)});break;case"number":n=new sap.m.Input({id:a,value:{path:t,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const o=t.getParameter("value");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};if(o&&isNaN(parseFloat(o))){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid number");r[e.name]="Please enter a valid number";a.setProperty("/validationErrors",r)}else{t.getSource().setValueState("None");if(r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}}.bind(this)});break;case"email":n=new sap.m.Input({id:a,value:{path:t},type:"Email",width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const o=t.getParameter("value");const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const r=this.getModel("viewModel");const n=r.getProperty("/validationErrors")||{};if(o&&!a.test(o)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid email address");n[e.name]="Please enter a valid email address";r.setProperty("/validationErrors",n)}else{t.getSource().setValueState("None");if(n[e.name]){delete n[e.name];r.setProperty("/validationErrors",n)}}}.bind(this)});break;case"url":n=new sap.m.Input({id:a,value:{path:t},type:"Url",width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const o=t.getParameter("value");const a=/^(http|https):\/\/[^ "]+$/;const r=this.getModel("viewModel");const n=r.getProperty("/validationErrors")||{};if(o&&!a.test(o)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid URL (starting with http:// or https://)");n[e.name]="Please enter a valid URL (starting with http:// or https://)";r.setProperty("/validationErrors",n)}else{t.getSource().setValueState("None");if(n[e.name]){delete n[e.name];r.setProperty("/validationErrors",n)}}}.bind(this)});break;case"text":n=new sap.m.TextArea({id:a,value:{path:t},rows:3,width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;default:n=new sap.m.Input({id:a,value:{path:t},width:"100%",required:o,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"})}if(n.setId){n.setId(this.getView().createId(e.name+"Input"))}return n},_resetFormErrorStates:function(){console.log("Resetting error states on all form fields");const e=[];this.getView().$().find(".sapMInputBase").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});this.getView().$().find(".sapMCb").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});this.getView().$().find(".sapMComboBox").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});console.log("Found",e.length,"controls to reset");e.forEach(e=>{if(e.setValueState){console.log("Resetting value state for",e.getId());e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});const t=this.getModel("viewModel");if(t){t.setProperty("/validationErrors",{})}console.log("Form error states reset complete")},_validateForm:function(e,t){const o={};let a=true;const r=[];this.getView().$().find(".sapMInputBase, .sapMCheckBox").each(function(){const e=this.id;const t=sap.ui.getCore().byId(e);if(t){r.push(t)}});console.log("Found input controls:",r.length);r.forEach(e=>{if(e.setValueState){e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});e.columns.forEach(n=>{if(n.editable===false||n.name===e.primaryKey||n.name==="created_at"||n.name==="updated_at"){return}const i=n.name;const s=t[i];let l=null;for(let e=0;e<r.length;e++){const t=r[e].getId();if(t.endsWith(i+"Input")||t.indexOf(i+"Input")!==-1){l=r[e];break}}if(!l){console.log("Control not found for field:",i)}else{console.log("Found control for field:",i,l.getId())}if(n.required&&(s===undefined||s===null||s==="")){a=false;o[i]="This field is required";if(l&&l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText("This field is required")}}console.log("Required field validation failed:",i)}else if(s!==undefined&&s!==null&&s!==""){let e=true;let t="";switch(n.type){case"number":if(isNaN(parseFloat(s))||!isFinite(s)){e=false;t="Please enter a valid number"}break;case"date":const o=new Date(s);if(isNaN(o.getTime())){e=false;t="Please enter a valid date"}break;case"email":const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.test(s)){e=false;t="Please enter a valid email address"}break;case"url":const r=/^(http|https):\/\/[^ "]+$/;if(!r.test(s)){e=false;t="Please enter a valid URL (starting with http:// or https://)"}break}if(!e){a=false;o[i]=t;if(l&&l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText(t)}}console.log("Type validation failed:",i,t)}}});const n=this.getModel("viewModel");if(n){n.setProperty("/validationErrors",o)}console.log("Validation result:",a?"Valid":"Invalid",o);return a},onNavBack:function(){const e=this.getModel("viewModel").getProperty("/tableId");this.getRouter().navTo("entityList",{table:e})},onSavePress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entity");console.log("Save pressed with entity data:",JSON.stringify(o,null,2));this._resetFormErrorStates();e.setProperty("/busy",true);let a=e.getProperty("/parentInfo");if(!a&&this._parentInfoBackup){console.log("Using parent info backup");a=this._parentInfoBackup}if(!a){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){a=JSON.parse(e);console.log("Retrieved parent info from session storage:",JSON.stringify(a,null,2))}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}console.log("Final parent info for saving:",a?JSON.stringify(a):"none");this.getTableMetadata(t).then(r=>{if(!this._validateForm(r,o)){this.showErrorMessage("Please correct the errors in the form");e.setProperty("/busy",false);return}const n={};r.columns.forEach(e=>{if(e.editable===false&&e.name!==r.primaryKey||e.name===r.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}n[e.name]=o[e.name]});if(a&&a.foreignKey&&a.parentId){console.log(`Setting foreign key ${a.foreignKey} = ${a.parentId}`);n[a.foreignKey]=a.parentId}console.log("Data to insert:",JSON.stringify(n,null,2));this.getSupabaseClient().from(t).insert(n).then(({data:o,error:r})=>{e.setProperty("/busy",false);if(r){console.error("Error creating entity:",r);this.showErrorMessage("Error creating entity: "+r.message);return}const n=e.getProperty("/tableName");this.showSuccessMessage(n+" created successfully");try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}this._navigateAfterSave(a,t)}).catch(t=>{console.error("Error in Supabase query:",t);this.showErrorMessage("Error creating entity: "+t.message);e.setProperty("/busy",false)})}).catch(t=>{console.error("Error getting table metadata:",t);this.showErrorMessage("Error getting table metadata: "+t.message);e.setProperty("/busy",false)})},_navigateAfterSave:function(e,t){console.log("Navigating after save");if(e&&e.parentTable&&e.parentId){console.log("Navigating to parent entity:",e.parentTable,e.parentId);try{setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:e.parentTable,id:e.parentId});console.log("Navigation to parent initiated")},100)}catch(e){console.error("Error during navigation to parent:",e);try{this.getRouter().navTo("entityList",{table:t});console.log("Fallback navigation to list view initiated")}catch(e){console.error("Error during fallback navigation:",e)}}}else{console.log("No parent info, navigating to list view");this.getRouter().navTo("entityList",{table:t})}},onCancelPress:function(){console.log("Cancel pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");let o=e.getProperty("/parentInfo");if(!o&&this._parentInfoBackup){console.log("Using parent info backup for cancel");o=this._parentInfoBackup}if(!o){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){o=JSON.parse(e);console.log("Retrieved parent info from session storage for cancel")}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}if(o&&o.parentTable&&o.parentId){console.log("Navigating to parent entity after cancel:",o.parentTable,o.parentId);try{setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:o.parentTable,id:o.parentId});console.log("Navigation to parent initiated after cancel")},100)}catch(e){console.error("Error during navigation to parent after cancel:",e);this.getRouter().navTo("entityList",{table:t})}}else{console.log("No parent info, navigating to list view after cancel");this.getRouter().navTo("entityList",{table:t})}}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityCreateForm.controller", ["sap/ui/core/mvc/ControllerExtension","sap/m/Label"],function(e,t){"use strict";return e.extend("com.supabase.easyui5.controller.EntityCreateForm",{initializeEntityData:function(e){const t={};const r=this.getModel("viewModel");const a=r.getProperty("/parentInfo");e.columns.forEach(e=>{if(a&&e.name===a.foreignKey){t[e.name]=a.parentId}else if(e.type==="boolean"){t[e.name]=false}else if(e.type==="number"){t[e.name]=0}else if(e.type==="date"){t[e.name]=(new Date).toISOString().split("T")[0]}else{t[e.name]=""}});r.setProperty("/entity",t)},configureForm:function(e){console.log("Configuring create form with metadata:",JSON.stringify(e,null,2));const r=this.getView().byId("entityCreateContainer");if(!r){console.error("Form container not found");return}r.removeAllFormElements();const a=this.getModel("viewModel");const o=a.getProperty("/entity");const n=a.getProperty("/parentInfo");console.log("Current Entity Data:",JSON.stringify(o,null,2));console.log("Parent Info:",JSON.stringify(n,null,2));const s="createForm_"+Date.now()+"_";const i=e.columns.filter(t=>!(t.editable===false||t.name===e.primaryKey||t.name==="created_at"||t.name==="updated_at"));i.forEach((e,a)=>{console.log(`Processing column: ${e.name}`);const o=e.required===true;const i=new sap.ui.layout.form.FormElement({label:new t({text:e.label||e.name,required:o})});const l="viewModel>/entity/"+e.name;const d=s+e.name+"_"+a;const c=n&&e.name===n.foreignKey;console.log(`Column ${e.name} - Type: ${e.type}`);try{const t=this.createInputField(e,l,o,d,c);if(t){i.addField(t);r.addFormElement(i);console.log(`Added form element for ${e.name}`)}else{console.error(`Failed to create control for ${e.name}`)}}catch(t){console.error(`Error creating control for ${e.name}:`,t)}});console.log(`Form configuration complete.`);const l=this.getView().byId("entityCreateForm");if(l){l.invalidate()}},createInputField:function(e,t,r,a,o){let n;if(o){n=new sap.m.Text({id:a,text:`Connected to parent ${this.getModel("viewModel").getProperty("/parentInfo/parentTable")} (ID: ${this.getModel("viewModel").getProperty("/parentInfo/parentId")})`});return n}switch(e.type){case"relation":n=new sap.m.ComboBox({id:a,selectedKey:{path:t},width:"100%",required:r,showSecondaryValues:true,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",selectionChange:this.createFieldChangeHandler(e)});this.loadRelationOptions(n,e.relation,e.name);break;case"boolean":n=new sap.m.CheckBox({id:a,selected:{path:t},width:"100%",select:this.createFieldChangeHandler(e)});break;case"date":n=new sap.m.DatePicker({id:a,value:{path:t,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",required:r,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;case"number":n=new sap.m.Input({id:a,value:{path:t,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",required:r,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;case"email":n=new sap.m.Input({id:a,value:{path:t},type:"Email",width:"100%",required:r,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;case"text":n=new sap.m.TextArea({id:a,value:{path:t},rows:3,width:"100%",required:r,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;default:n=new sap.m.Input({id:a,value:{path:t},width:"100%",required:r,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"})}if(n.setId){n.setId(this.getView().createId(e.name+"Input"))}return n},validateAndSaveEntity:function(e){const t=this.getModel("viewModel");const r=t.getProperty("/entity");console.log("Save pressed with entity data:",r);this.resetFormErrorStates();t.setProperty("/busy",true);return new Promise((a,o)=>{this.getTableMetadata(e).then(n=>{if(!this.validateForm(n,r)){this.showErrorMessage("Please correct the errors in the form");t.setProperty("/busy",false);o(new Error("Validation failed"));return}const s={};n.columns.forEach(e=>{if(e.editable===false&&e.name!==n.primaryKey||e.name===n.primaryKey){return}s[e.name]=r[e.name]});console.log("Data to insert:",s);this.getSupabaseClient().from(e).insert(s).then(({data:e,error:r})=>{t.setProperty("/busy",false);if(r){this.showErrorMessage("Error creating entity",r);o(r);return}const n=t.getProperty("/tableName");this.showSuccessMessage(n+" created successfully");a(e)}).catch(e=>{console.error("Error in Supabase query:",e);this.showErrorMessage("Error creating entity: "+e.message);t.setProperty("/busy",false);o(e)})}).catch(e=>{console.error("Error getting table metadata:",e);this.showErrorMessage("Error getting table metadata: "+e.message);t.setProperty("/busy",false);o(e)})})},_prepareEntityDataForSave:function(e,t){const r={};const a=e.columns.map(e=>e.name);console.log("Valid column names:",a);Object.keys(t).forEach(o=>{if(!a.includes(o)){console.log(`Skipping field '${o}' as it's not found in the schema`);return}const n=e.columns.find(e=>e.name===o);if(n&&n.editable===false&&o!==e.primaryKey){console.log(`Skipping non-editable field '${o}'`);return}if(o===e.primaryKey){console.log(`Skipping primary key field '${o}'`);return}r[o]=t[o]});console.log("Prepared data for save:",r);return r},onSavePress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const r=e.getProperty("/entity");console.log("Save pressed with entity data:",r);this._resetFormErrorStates();e.setProperty("/busy",true);this.getTableMetadata(t).then(a=>{if(!this._validateForm(a,r)){this.showErrorMessage("Please correct the errors in the form");e.setProperty("/busy",false);return}const o=this._prepareEntityDataForSave(a,r);console.log("Data to insert:",o);this.getSupabaseClient().from(t).insert(o).then(({data:r,error:a})=>{e.setProperty("/busy",false);if(a){this.showErrorMessage("Error creating entity",a);console.error("Error details:",a);return}const o=e.getProperty("/tableName");this.showSuccessMessage(o+" created successfully");const n=e.getProperty("/parentInfo");if(n&&n.parentTable&&n.parentId){sessionStorage.removeItem("parentEntityInfo");this.getRouter().navTo("entityDetail",{table:n.parentTable,id:n.parentId})}else{this.getRouter().navTo("entityList",{table:t})}}).catch(t=>{console.error("Error in Supabase query:",t);this.showErrorMessage("Error creating entity: "+t.message);e.setProperty("/busy",false)})}).catch(t=>{console.error("Error getting table metadata:",t);this.showErrorMessage("Error getting table metadata: "+t.message);e.setProperty("/busy",false)})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityDetail.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Text","sap/m/Input","sap/m/Label","sap/m/Column","sap/m/ColumnListItem"],function(e,t,o,n,r,a,s){"use strict";return e.extend("com.supabase.easyui5.controller.EntityDetail",{formatter:{formatDate:function(e){if(!e){return""}return new Date(e).toLocaleDateString()},formatBoolean:function(e){return e?"Yes":"No"},formatNumber:function(e){if(e===undefined||e===null){return""}return parseFloat(e).toFixed(2)}},onInit:function(){console.log("EntityDetail controller initialized");const e=new t({tableName:"",tableId:"",entityId:"",entityTitle:"",entitySubtitle:"",entity:{},originalEntity:{},relatedItems:[],filteredRelatedItems:[],editMode:false,busy:false,delay:0,validationErrors:{},parentInfo:null});this.setModel(e,"viewModel");this.getRouter().getRoute("entityDetail").attachPatternMatched(this._onRouteMatched,this);this._loadParentInfoForEdit();try{this._registerExtensions()}catch(e){console.error("Could not register extensions:",e)}},_loadParentInfoForEdit:function(){try{const e=sessionStorage.getItem("parentEntityInfo");console.log("Checking for parent info in detail view:",e);if(e){const t=JSON.parse(e);if(t.isEditing===true){console.log("Found parent info for edit mode:",JSON.stringify(t,null,2));const e=this.getModel("viewModel");e.setProperty("/parentInfo",t);this._parentInfoBackup=JSON.parse(JSON.stringify(t))}}}catch(e){console.error("Error parsing parent entity info:",e)}},_registerExtensions:function(){console.log("Registering controller extensions");try{sap.ui.require(["com/supabase/easyui5/controller/EntityDetailExtensions.controller"],function(e){if(e){const t=e();console.log("Extensions loaded successfully");if(t.form&&t.form._configureForm){this._configureForm=t.form._configureForm.bind(this)}if(t.relatedItems&&t.relatedItems._loadRelatedItems){this._loadRelatedItems=t.relatedItems._loadRelatedItems.bind(this)}if(t.actions){if(t.actions.onSavePress){this.onSavePress=t.actions.onSavePress.bind(this)}if(t.actions.onCancelPress){this.onCancelPress=t.actions.onCancelPress.bind(this)}if(t.actions.onEditPress){this.onEditPress=t.actions.onEditPress.bind(this)}}}}.bind(this))}catch(e){console.error("Error registering extensions:",e)}},_onRouteMatched:function(e){console.log("ðŸ” ROUTE DEBUG: EntityDetail route matched event fired");try{const t=e.getParameter("arguments").table;const o=e.getParameter("arguments").id;console.log("ðŸ” ROUTE DEBUG: Parameters - Table ID:",t,"Entity ID:",o);console.log("ðŸ” ROUTE DEBUG: View available?",!!this.getView());const n=this.getModel("viewModel");if(!n){console.error("ðŸ” ROUTE DEBUG: viewModel not found! Creating a new one.");const e=new sap.ui.model.json.JSONModel({tableName:"",tableId:"",entityId:"",entityTitle:"",entitySubtitle:"",entity:{},originalEntity:{},relatedItems:[],filteredRelatedItems:[],editMode:false,busy:false,delay:0,validationErrors:{}});this.setModel(e,"viewModel")}const r=this.getModel("viewModel");console.log("ðŸ” ROUTE DEBUG: Setting properties in viewModel");r.setProperty("/tableId",t);r.setProperty("/entityId",o);const a=t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ");r.setProperty("/tableName",a);r.setProperty("/validationErrors",{});r.setProperty("/editMode",false);r.setProperty("/busy",true);r.setProperty("/relatedItems",[]);r.setProperty("/filteredRelatedItems",[]);console.log("ðŸ” ROUTE DEBUG: Checking for relatedItemsTable in view");const s=this.getView().byId("relatedItemsTable");console.log("ðŸ” ROUTE DEBUG: Table found?",!!s);if(s){console.log("ðŸ” ROUTE DEBUG: Current table binding:",s.isBound("items")?"Bound":"Not bound");if(s.isBound("items")){const e=s.getBinding("items");console.log("ðŸ” ROUTE DEBUG: Current binding path:",e?e.getPath():"unknown")}console.log("ðŸ” ROUTE DEBUG: Pre-initializing table with empty template");try{if(!s.getBindingInfo("items")||!s.getBindingInfo("items").template){const e=new sap.m.ColumnListItem;s.bindItems({path:"viewModel>/filteredRelatedItems",template:e});console.log("ðŸ” ROUTE DEBUG: Applied temporary binding with empty template")}}catch(e){console.error("ðŸ” ROUTE DEBUG: Error applying temporary binding:",e)}}console.log("ðŸ” ROUTE DEBUG: Pre-initializing related items table");this._configureRelatedItemsTable(t);console.log("ðŸ” ROUTE DEBUG: Getting table metadata");this.getTableMetadata(t).then(e=>{console.log("ðŸ” ROUTE DEBUG: Metadata loaded successfully");this._oTableMetadata=e;console.log("ðŸ” ROUTE DEBUG: Now loading entity data");this._loadEntity(t,o)}).catch(e=>{console.error("ðŸ” ROUTE DEBUG: Error loading metadata:",e);console.error("ðŸ” ROUTE DEBUG: Error stack:",e.stack);r.setProperty("/busy",false)})}catch(e){console.error("ðŸ” ROUTE DEBUG: Critical error in _onRouteMatched:",e);console.error("ðŸ” ROUTE DEBUG: Error stack:",e.stack);try{const e=this.getModel("viewModel");if(e){e.setProperty("/busy",false)}}catch(e){console.error("ðŸ” ROUTE DEBUG: Error resetting busy state:",e)}}},_configureForm:function(e,t){try{console.log("Finding suitable container for entity details");let n=null;n=this.getView().byId("detailContentArea")||this.getView().byId("entityDetailsContainer");if(!n){const e=this.getView().getControlsByType("sap.uxap.ObjectPageSubSection");if(e&&e.length>0){n=e[0];console.log("Using ObjectPageSubSection as container")}}if(!n){const e=this.getView().getControlsByType("sap.ui.layout.form.SimpleForm")||this.getView().getControlsByType("sap.ui.layout.form.Form")||this.getView().getControlsByType("sap.m.VBox")||this.getView().getControlsByType("sap.m.Panel");if(e&&e.length>0){n=e[0];console.log("Using layout container:",n.getMetadata().getName())}}if(!n){const e=this.getView().getControlsByType("sap.m.Page")[0]||this.getView().getControlsByType("sap.uxap.ObjectPageLayout")[0];if(e){if(e.getContent&&e.addContent){n=e;console.log("Using page as container")}}}if(!n){console.error("Could not find any suitable container for entity details");return}const a=new sap.ui.layout.Grid({defaultSpan:"XL4 L4 M6 S12",vSpacing:1,hSpacing:1,width:"100%"});e.columns.forEach(e=>{if(!e.visible)return;const n=new sap.m.VBox({width:"100%",alignItems:"Start"});n.addItem(new r({text:e.label,design:"Bold",width:"100%"}).addStyleClass("sapUiTinyMarginBottom"));let s;switch(e.type){case"relation":s=new o({text:t[e.name+"_text"]||t[e.name]||""});break;case"boolean":s=new o({text:t[e.name]?"Yes":"No"});break;case"date":s=new o({text:t[e.name]?new Date(t[e.name]).toLocaleDateString():""});break;case"number":s=new o({text:t[e.name]!==undefined?parseFloat(t[e.name]).toFixed(2):""});break;default:s=new o({text:t[e.name]||""})}s.addStyleClass("sapUiTinyMarginTop");s.setWidth("100%");n.addItem(s);a.addContent(n.addStyleClass("sapUiSmallMargin"))});const s=new sap.m.Panel({headerText:"Details",expandable:false,expanded:true,backgroundDesign:"Solid",content:[a]});if(n.removeAllContent){n.removeAllContent();n.addContent(s)}else if(n.removeAllItems){n.removeAllItems();n.addItem(s)}else if(n.removeAllFormElements){n.removeAllFormElements();const e=new sap.ui.layout.form.FormElement;e.addField(s);n.addFormElement(e)}else if(n.addContent){n.addContent(s)}else{console.error("Container doesn't have a method to add content:",n)}console.log("Entity details added to container")}catch(e){console.error("Error in dynamic _configureForm:",e)}},_configureRelatedItemsTable:function(e){console.log("ðŸ” TABLE DEBUG: Started _configureRelatedItemsTable for table:",e);try{const t=this.getView().byId("relatedItemsTable");console.log("ðŸ” TABLE DEBUG: Found table?",!!t,"Table ID:",t?t.getId():"null");if(!t){console.error("ðŸ” TABLE DEBUG: Related items table not found in the view! Check ID in XML");return}const o=t.getBindingInfo("items");console.log("ðŸ” TABLE DEBUG: Current binding info:",o);console.log("ðŸ” TABLE DEBUG: Existing columns count:",t.getColumns().length);t.removeAllColumns();console.log("ðŸ” TABLE DEBUG: Removed all columns");this.getTableMetadata(e).then(o=>{console.log("ðŸ” TABLE DEBUG: Got metadata for table",e,":",JSON.stringify(o,null,2));const n=o.columns.filter(e=>e.visible).slice(0,5);console.log("ðŸ” TABLE DEBUG: Visible columns:",n.length);n.forEach((e,o)=>{console.log(`ðŸ” TABLE DEBUG: Adding column ${o+1}:`,e.name);t.addColumn(new sap.m.Column({header:new sap.m.Label({text:e.label})}))});console.log("ðŸ” TABLE DEBUG: Adding actions column");t.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Actions"}),hAlign:"Right"}));console.log("ðŸ” TABLE DEBUG: Finished adding columns, total:",t.getColumns().length);console.log("ðŸ” TABLE DEBUG: Creating template for binding");const r=new sap.m.ColumnListItem({type:"Navigation",press:this.onRelatedItemPress.bind(this)});n.forEach((e,t)=>{console.log(`ðŸ” TABLE DEBUG: Adding cell ${t+1} for column:`,e.name);let o;switch(e.type){case"relation":o=new sap.m.Text({text:"{viewModel>"+e.name+"_text}"});break;case"boolean":o=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:this.formatter.formatBoolean}});break;case"date":o=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:this.formatter.formatDate}});break;case"number":o=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:this.formatter.formatNumber}});break;default:o=new sap.m.Text({text:"{viewModel>"+e.name+"}"})}r.addCell(o)});console.log("ðŸ” TABLE DEBUG: Adding actions cell to template");const a=new sap.m.HBox({justifyContent:"End",items:[new sap.m.Button({icon:"sap-icon://edit",type:"Transparent",tooltip:"Edit",press:this.onEditRelatedItemPress.bind(this)}),new sap.m.Button({icon:"sap-icon://delete",type:"Transparent",tooltip:"Delete",press:this.onDeleteRelatedItemPress.bind(this)})]});r.addCell(a);console.log("ðŸ” TABLE DEBUG: Template created with cells:",r.getCells().length);const s=this.getModel("viewModel");const i=s.getProperty("/filteredRelatedItems")||[];console.log("ðŸ” TABLE DEBUG: Current data in model:",JSON.stringify(i));try{console.log("ðŸ” TABLE DEBUG: About to bind items to table");const e={path:"viewModel>/filteredRelatedItems",template:r};console.log("ðŸ” TABLE DEBUG: Binding settings:",JSON.stringify(e,function(e,t){if(e==="template")return"[Template Object]";return t}));if(t.isBound("items")){console.log("ðŸ” TABLE DEBUG: Unbinding existing items");t.unbindItems()}t.bindItems(e);console.log("ðŸ” TABLE DEBUG: Items bound successfully");const o=t.getBindingInfo("items");console.log("ðŸ” TABLE DEBUG: New binding info path:",o?o.path:"none","Has template:",!!o&&!!o.template)}catch(e){console.error("ðŸ” TABLE DEBUG: Error during item binding:",e);console.error("ðŸ” TABLE DEBUG: Error stack:",e.stack)}console.log("ðŸ” TABLE DEBUG: Table configuration completed");t.invalidate();console.log("ðŸ” TABLE DEBUG: Table invalidated for re-rendering")}).catch(e=>{console.error("ðŸ” TABLE DEBUG: Error getting metadata:",e);console.error("ðŸ” TABLE DEBUG: Error stack:",e.stack)})}catch(e){console.error("ðŸ” TABLE DEBUG: Critical error in _configureRelatedItemsTable:",e);console.error("ðŸ” TABLE DEBUG: Error stack:",e.stack)}},onToggleNav:function(){try{const e=this.getOwnerComponent().getSplitApp();if(!e){console.error("SplitApp control not found!");return}const t=this.getOwnerComponent().getModel("appView");if(!t){console.error("AppView model not found!");return}const o=t.getProperty("/navExpanded");const n=this.getView().byId("navToggleButton");if(o){e.hideMaster();if(n){n.setIcon("sap-icon://menu2");n.setTooltip("Show Navigation")}t.setProperty("/navExpanded",false)}else{e.showMaster();if(n){n.setIcon("sap-icon://navigation-left-arrow");n.setTooltip("Hide Navigation")}t.setProperty("/navExpanded",true)}}catch(e){console.error("Error in menu toggle:",e)}},onEditPress:function(){console.log("Edit button pressed with direct validation");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");if(!o){this.showErrorMessage("Cannot edit: Missing entity ID");return}console.log("Editing entity with ID:",o);const n=JSON.parse(JSON.stringify(e.getProperty("/entity")));e.setProperty("/originalEntity",n);e.setProperty("/editMode",true);this.getView().getController()._formFields={};this.getTableMetadata(t).then(r=>{const a=new sap.m.Dialog({title:"Edit "+e.getProperty("/tableName"),contentWidth:"40rem",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,columnsXL:1,columnsL:1,content:this._createEditFormContent(r,n)})],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){let e=true;this._editControls=this._editControls||{};Object.values(this._editControls).forEach(function(e){if(e.setValueState){e.setValueState("None")}});r.columns.forEach(t=>{if(t.editable===false||!t.visible||t.name===r.primaryKey||t.name==="created_at"||t.name==="updated_at"){return}const o=this._editControls[t.name];if(!o)return;let n;if(o instanceof sap.m.CheckBox){n=o.getSelected()}else if(o.getValue){n=o.getValue()}if(t.required===true&&(n===undefined||n===null||n==="")){e=false;if(o.setValueState){o.setValueState("Error");if(o.setValueStateText){o.setValueStateText("This field is required")}}console.log("Validation failed:",t.name,"is required");return}if(n===undefined||n===null||n===""){return}let a=true;let s="";switch(t.type){case"number":if(isNaN(parseFloat(n))||!isFinite(n)){a=false;s="Please enter a valid number"}break;case"date":const e=new Date(n);if(isNaN(e.getTime())){a=false;s="Please enter a valid date"}break;case"email":const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!t.test(n)){a=false;s="Please enter a valid email address"}break;case"url":const o=/^(http|https):\/\/[^ "]+$/;if(!o.test(n)){a=false;s="Please enter a valid URL (starting with http:// or https://)"}break}if(!a){e=false;if(o.setValueState){o.setValueState("Error");if(o.setValueStateText){o.setValueStateText(s)}}console.log("Validation failed:",t.name,s)}});if(!e){sap.m.MessageToast.show("Please correct the errors before saving");return}const s=JSON.parse(JSON.stringify(n));r.columns.forEach(e=>{if(e.editable===false||!e.visible||e.name===r.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}const t=this._editControls[e.name];if(!t)return;if(t instanceof sap.m.CheckBox){s[e.name]=t.getSelected()}else if(t instanceof sap.m.DatePicker){s[e.name]=t.getValue()}else if(t.getValue){s[e.name]=t.getValue()}});if(this._areObjectsEqual(s,n)){sap.m.MessageBox.information("No changes were made to this record.",{title:"No Changes",onClose:function(){a.close()}});return}this._saveEntity(t,o,r,s);a.close()}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){a.close()}}),afterClose:function(){a.destroy();this._editControls=null}.bind(this)});this.getView().addDependent(a);a.open()})},_createEditFormContent:function(e,t){const o=[];this._editControls={};e.columns.forEach(n=>{if(n.editable===false||!n.visible||n.name===e.primaryKey||n.name==="created_at"||n.name==="updated_at"){return}o.push(new sap.m.Label({text:n.label,required:n.required===true}));let r;switch(n.type){case"relation":r=new sap.m.ComboBox({selectedKey:t[n.name],required:n.required===true,showSecondaryValues:true});this._loadRelationOptionsForEdit(r,n.relation,n.name);break;case"boolean":r=new sap.m.CheckBox({selected:t[n.name]===true});break;case"date":r=new sap.m.DatePicker({value:t[n.name]?new Date(t[n.name]).toISOString().split("T")[0]:null,valueFormat:"yyyy-MM-dd",displayFormat:"medium",required:n.required===true,change:function(e){if(e.getParameter("valid")){e.getSource().setValueState("None")}else{e.getSource().setValueState("Error");e.getSource().setValueStateText("Please enter a valid date")}}});break;case"number":r=new sap.m.Input({value:t[n.name],type:"Number",required:n.required===true,liveChange:function(e){const t=e.getParameter("value");if(t&&isNaN(parseFloat(t))){e.getSource().setValueState("Error");e.getSource().setValueStateText("Please enter a valid number")}else{e.getSource().setValueState("None")}}});break;case"email":r=new sap.m.Input({value:t[n.name],type:"Email",required:n.required===true,liveChange:function(e){const t=e.getParameter("value");const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(t&&!o.test(t)){e.getSource().setValueState("Error");e.getSource().setValueStateText("Please enter a valid email address")}else{e.getSource().setValueState("None")}}});break;case"url":r=new sap.m.Input({value:t[n.name],type:"Url",required:n.required===true,liveChange:function(e){const t=e.getParameter("value");const o=/^(http|https):\/\/[^ "]+$/;if(t&&!o.test(t)){e.getSource().setValueState("Error");e.getSource().setValueStateText("Please enter a valid URL (starting with http:// or https://)")}else{e.getSource().setValueState("None")}}});break;case"text":r=new sap.m.TextArea({value:t[n.name],rows:3,required:n.required===true});break;default:r=new sap.m.Input({value:t[n.name],required:n.required===true})}this._editControls[n.name]=r;o.push(r)});return o},_validateEditForm:function(e){let t=true;e.columns.forEach(o=>{if(o.editable===false||!o.visible||o.name===e.primaryKey||o.name==="created_at"||o.name==="updated_at"){return}const n=this._editControls[o.name];if(!n)return;if(n.setValueState){n.setValueState("None");if(n.setValueStateText){n.setValueStateText("")}}let r;if(n instanceof sap.m.CheckBox){r=n.getSelected()}else if(n.getValue){r=n.getValue()}if(o.required===true&&(r===undefined||r===null||r==="")){t=false;if(n.setValueState){n.setValueState("Error");if(n.setValueStateText){n.setValueStateText("This field is required")}}console.log("Validation failed for",o.name,": Required field is empty");return}if(r===undefined||r===null||r===""){return}let a=true;let s="";switch(o.type){case"number":if(isNaN(parseFloat(r))||!isFinite(r)){a=false;s="Please enter a valid number"}break;case"date":const e=new Date(r);if(isNaN(e.getTime())){a=false;s="Please enter a valid date"}break;case"email":const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!t.test(r)){a=false;s="Please enter a valid email address"}break;case"url":const o=/^(http|https):\/\/[^ "]+$/;if(!o.test(r)){a=false;s="Please enter a valid URL (starting with http:// or https://)"}break}if(!a){t=false;if(n.setValueState){n.setValueState("Error");if(n.setValueStateText){n.setValueStateText(s)}}console.log("Validation failed for",o.name,":",s)}});return t},_areObjectsEqual:function(e,t){if(e===t)return true;if(!e||!t)return false;const o=[...new Set([...Object.keys(e),...Object.keys(t)])];const n=["created_at","updated_at"];for(const r of o){if(n.includes(r))continue;const o=e[r];const a=t[r];if(typeof o==="object"&&typeof a==="object"&&o!==null&&a!==null){if(!this._areObjectsEqual(o,a))return false}else if(o instanceof Date&&a instanceof Date){if(o.getTime()!==a.getTime())return false}else if((o===null||o===undefined)&&(a===null||a===undefined)){continue}else if(o!==a){return false}}return true},_saveEntity:function(e,t,o,n){const r=this.getModel("viewModel");r.setProperty("/busy",true);if(typeof t==="object"||!t){console.log("Entity ID is not a string, getting from model");t=r.getProperty("/entityId");if(!t){this.showErrorMessage("Error: Missing entity ID for update operation");r.setProperty("/busy",false);return}}console.log("Using Entity ID for update:",t,"Type:",typeof t);if(!e){console.error("Missing table ID for _saveEntity");r.setProperty("/busy",false);this.showErrorMessage("Error updating entity: Missing table ID");return}const a=n||r.getProperty("/entity");if(!a){console.error("No entity data available for saving");r.setProperty("/busy",false);this.showErrorMessage("Error updating entity: No data available");return}this.getTableMetadata(e).then(o=>{if(!o||!o.columns){throw new Error("Invalid metadata structure - missing columns")}console.log("Using metadata for save:",o);const n={};const r=o.primaryKey;if(!r){throw new Error("No primary key defined in metadata")}console.log("Using primary key for update:",r);const s=async()=>{const e=[];for(const t of o.columns){if(t.editable===false&&t.name!==r||t.name===r){continue}if(t.type==="relation"){const o=t.name;let r=a[o];console.log(`Processing relation field ${o}, current value:`,r,typeof r);if(r&&(isNaN(Number(r))||typeof r==="string"&&r.includes(" "))){const a=this._resolveRelationKey(t.relation,r).then(e=>{if(e!==null){console.log(`Resolved relation key for ${o}: ${e}`);n[o]=e}else{console.log(`Could not resolve relation key for ${o}, using original value`);n[o]=r}});e.push(a)}else{if(typeof r==="string"&&!isNaN(parseInt(r))){r=parseInt(r)}n[o]=r;console.log(`Using relation value for ${o}:`,r,typeof r)}}else{n[t.name]=a[t.name]}}await Promise.all(e)};return s().then(()=>{const a=o.columns.some(e=>e.name==="updated_at");if(a){n["updated_at"]=(new Date).toISOString()}console.log("Final data to update:",n);console.log("Table ID:",e);console.log("Entity ID:",t,"Type:",typeof t);return this.getSupabaseClient().from(e).update(n).eq(r,t).then(({data:e,error:t})=>{if(t){throw t}return e})})}).then(o=>{r.setProperty("/busy",false);r.setProperty("/editMode",false);this.showSuccessMessage("Entity updated successfully");this._loadEntity(e,t)}).catch(e=>{console.error("Error updating entity:",e);this.showErrorMessage("Error updating entity: "+(e.message||JSON.stringify(e)));r.setProperty("/busy",false)})},_resolveRelationKey:function(e,t){console.log(`Trying to resolve relation key for ${e} with display value: "${t}"`);return this.getTableMetadata(e).then(o=>{const n=o.primaryKey;const r=o.titleField||n;console.log(`Using primary key ${n} and title field ${r} for relation resolution`);return this.getSupabaseClient().from(e).select(n).eq(r,t).then(({data:o,error:r})=>{if(r){console.error(`Error querying relation ${e}:`,r);return null}if(o&&o.length>0){console.log(`Found exact match for ${t} in ${e}:`,o[0][n]);return o[0][n]}const a=extractNumberFromString(t);if(a!==null){console.log(`Extracted potential key ${a} from "${t}"`);return this.getSupabaseClient().from(e).select(n).eq(n,a).then(({data:t,error:o})=>{if(o){console.error(`Error verifying key ${a}:`,o);return null}if(t&&t.length>0){console.log(`Verified key ${a} exists in ${e}`);return a}console.log(`Could not verify key ${a} in ${e}`);return null})}console.log(`No relation key found for ${t} in ${e}`);return null})}).catch(e=>{console.error(`Error resolving relation key:`,e);return null})},extractNumberFromString(e){if(!e||typeof e!=="string")return null;const t=e.match(/\d+/g);if(t&&t.length>0){return parseInt(t[t.length-1],10)}return null},onDeletePress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");const n=e.getProperty("/tableName");const r=e.getProperty("/relatedItems")||[];if(r&&r.length>0){sap.m.MessageBox.error("Cannot delete this "+e.getProperty("/tableName")+" because it has related items. Please delete all related items first.",{title:"Delete Not Allowed"});return}sap.m.MessageBox.confirm("Are you sure you want to delete this "+n+"?",{title:"Delete Confirmation",onClose:function(e){if(e===sap.m.MessageBox.Action.OK){this._deleteEntity(t,o)}}.bind(this),styleClass:this.getOwnerComponent().getContentDensityClass()})},_deleteEntity:function(e,t){const o=this.getModel("viewModel");o.setProperty("/busy",true);this.getTableMetadata(e).then(n=>{const r=n.primaryKey;this.getSupabaseClient().from(e).delete().eq(r,t).then(({error:t})=>{o.setProperty("/busy",false);if(t){this.showErrorMessage("Error deleting entity",t);return}const n=o.getProperty("/tableName");this.showSuccessMessage(n+" deleted successfully");this.getRouter().navTo("entityList",{table:e})}).catch(e=>{console.error("Error in Supabase query:",e);this.showErrorMessage("Error deleting entity: "+e.message);o.setProperty("/busy",false)})}).catch(e=>{console.error("Error getting table metadata:",e);this.showErrorMessage("Error getting table metadata: "+e.message);o.setProperty("/busy",false)})},onSavePress:function(){console.log("Save button pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");if(!o){this.showErrorMessage("Cannot save: Missing entity ID");return}console.log("Saving entity with ID:",o);const n=JSON.parse(JSON.stringify(e.getProperty("/entity")));e.setProperty("/originalEntity",n);e.setProperty("/busy",true);this.getTableMetadata(t).then(r=>{if(!this.validateForm(r,n)){this.showErrorMessage("Please correct the errors in the form");e.setProperty("/busy",false);return}const a=r.primaryKey;const s={};r.columns.forEach(e=>{if(e.editable===false&&e.name!==a||e.name===a){return}s[e.name]=n[e.name]});s["updated_at"]=(new Date).toISOString();console.log("Data to update:",JSON.stringify(s,null,2));let i=e.getProperty("/parentInfo");if(!i&&this._parentInfoBackup){console.log("Using parent info backup");i=this._parentInfoBackup}if(!i){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){i=JSON.parse(e);console.log("Retrieved parent info from session storage")}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}console.log("Parent info for navigation after save:",i?JSON.stringify(i,null,2):"none");this.getSupabaseClient().from(t).update(s).eq(a,o).then(({data:n,error:r})=>{e.setProperty("/busy",false);if(r){console.error("Update error:",r);this.showErrorMessage("Error updating entity",r);return}e.setProperty("/editMode",false);this.showSuccessMessage("Entity updated successfully");try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}if(i&&i.isEditing&&i.parentTable&&i.parentId){console.log("Navigating back to parent entity after edit:",i.parentTable,i.parentId);setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:i.parentTable,id:i.parentId});console.log("Navigation back to parent initiated")},100)}else{this._loadEntity(t,o)}}).catch(t=>{console.error("Error in Supabase query:",t);this.showErrorMessage("Error updating entity: "+t.message);e.setProperty("/busy",false)})}).catch(t=>{console.error("Error getting table metadata:",t);this.showErrorMessage("Error getting table metadata: "+t.message);e.setProperty("/busy",false)})},onCancelPress:function(){console.log("Cancel button pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");let n=e.getProperty("/parentInfo");if(!n&&this._parentInfoBackup){console.log("Using parent info backup for cancel");n=this._parentInfoBackup}if(!n){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){n=JSON.parse(e);console.log("Retrieved parent info from session storage for cancel")}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}e.setProperty("/editMode",false);if(n&&n.isEditing&&n.parentTable&&n.parentId){console.log("Navigating back to parent entity after cancel:",n.parentTable,n.parentId);setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:n.parentTable,id:n.parentId});console.log("Navigation back to parent initiated after cancel")},100)}else{this._loadEntity(t,o)}},onAddRelatedItemPress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");this.getTableMetadata(t).then(e=>{if(!e.relations||e.relations.length===0){this.showErrorMessage("No relations defined for this entity");return}const n=e.relations[0];const r={parentTable:t,parentId:o,foreignKey:n.foreignKey};sessionStorage.setItem("parentEntityInfo",JSON.stringify(r));this.getRouter().navTo("entityCreate",{table:n.table})})},onEditRelatedItemPress:function(e){const t=e.getSource();const o=t.getParent().getParent();const n=o.getBindingContext("viewModel");if(!n){console.error("No binding context found for related item");return}const r=n.getObject();const a=this.getModel("viewModel");const s=a.getProperty("/tableId");console.log("Edit related item:",r);this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const o=e.primaryKey;const n=r[o];console.log(`Navigating to edit related item: ${t.table}/${n}`);this.getRouter().navTo("entityDetail",{table:t.table,id:n})})})},onDeleteRelatedItemPress:function(e){const t=e.getSource();const o=t.getParent().getParent();const n=o.getBindingContext("viewModel");if(!n){console.error("No binding context found for related item");return}const r=n.getObject();const a=this.getModel("viewModel");const s=a.getProperty("/tableId");console.log("Delete related item:",r);this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const o=e.primaryKey;const n=r[o];console.log(`Confirming deletion of related item: ${t.table}/${n}`);this.showConfirmationDialog("Are you sure you want to delete this related item?",()=>{console.log(`Deleting related item: ${t.table}/${n}`);this.getSupabaseClient().from(t.table).delete().eq(o,n).then(({error:e})=>{if(e){console.error("Error deleting related item:",e);this.showErrorMessage("Error deleting related item",e);return}console.log("Related item deleted successfully");this._loadEntity(s,a.getProperty("/entityId"));this.showSuccessMessage("Related item deleted successfully")})},"Delete Confirmation")})})},onRelatedItemPress:function(e){const t=e.getSource();const o=t.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const a=r.getProperty("/tableId");console.log("Item pressed:",n);this.getTableMetadata(a).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined for navigation");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const o=e.primaryKey;const r=n[o];console.log(`Navigating to related item details: ${t.table}/${r}`);this.getRouter().navTo("entityDetail",{table:t.table,id:r})})})},onRelatedItemsSearch:function(e){const t=e.getParameter("query").toLowerCase();const o=this.getModel("viewModel");const n=[...o.getProperty("/relatedItems")];if(!t){o.setProperty("/filteredRelatedItems",n);return}const r=n.filter(e=>JSON.stringify(e).toLowerCase().includes(t));o.setProperty("/filteredRelatedItems",r)},resetFormErrorStates:function(){console.log("Resetting error states on all form fields");const e=[];this.getView().$().find(".sapMInputBase").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});this.getView().$().find(".sapMCb").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});this.getView().$().find(".sapMComboBox").each(function(){const t=this.id;const o=sap.ui.getCore().byId(t);if(o){e.push(o)}});console.log("Found",e.length,"controls to reset");e.forEach(e=>{if(e.setValueState){console.log("Resetting value state for",e.getId());e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});const t=this.getModel("viewModel");if(t){t.setProperty("/validationErrors",{})}console.log("Form error states reset complete")},_loadEntity:function(e,t){console.log("ðŸ” ENTITY DEBUG: Starting _loadEntity method",{tableId:e,entityId:t});try{const o=this.getModel("viewModel");if(!o){console.error("ðŸ” ENTITY DEBUG: viewModel not found!");return}o.setProperty("/busy",true);if(!this._oTableMetadata){console.log("ðŸ” ENTITY DEBUG: No stored metadata, loading it now");this.getTableMetadata(e).then(o=>{console.log("ðŸ” ENTITY DEBUG: Metadata loaded successfully");this._oTableMetadata=o;this._continueLoadingEntity(e,t,o)}).catch(e=>{console.error("ðŸ” ENTITY DEBUG: Error loading metadata:",e);console.error("ðŸ” ENTITY DEBUG: Error stack:",e.stack);o.setProperty("/busy",false)})}else{console.log("ðŸ” ENTITY DEBUG: Using stored metadata");this._continueLoadingEntity(e,t,this._oTableMetadata)}}catch(e){console.error("ðŸ” ENTITY DEBUG: Critical error in _loadEntity:",e);console.error("ðŸ” ENTITY DEBUG: Error stack:",e.stack);try{const e=this.getModel("viewModel");if(e){e.setProperty("/busy",false)}}catch(e){console.error("ðŸ” ENTITY DEBUG: Error resetting busy state:",e)}}},_continueLoadingEntity:function(e,t,o){console.log("ðŸ” ENTITY DEBUG: Continuing entity loading with metadata");try{const n=this.getModel("viewModel");const r=o.primaryKey||`${e}_id`;console.log("ðŸ” ENTITY DEBUG: Using primary key:",r);if(!r){console.error("ðŸ” ENTITY DEBUG: No primary key defined in metadata");n.setProperty("/busy",false);return}if(!t){console.error("ðŸ” ENTITY DEBUG: No entity ID specified");n.setProperty("/busy",false);return}if(!this.getSupabaseClient()){console.error("ðŸ” ENTITY DEBUG: Supabase client not available");n.setProperty("/busy",false);return}console.log(`ðŸ” ENTITY DEBUG: Building query: ${e}.select('*').eq('${r}', '${t}')`);this.getSupabaseClient().from(e).select("*").eq(r,t).single().then(async({data:e,error:t})=>{if(t){console.error("ðŸ” ENTITY DEBUG: Error loading entity data:",t);n.setProperty("/busy",false);return}if(!e){console.error("ðŸ” ENTITY DEBUG: No data found for entity");n.setProperty("/busy",false);return}console.log("ðŸ” ENTITY DEBUG: Entity data loaded:",JSON.stringify(e,null,2));console.log("ðŸ” ENTITY DEBUG: Processing relation fields");for(const t of o.columns){if(t.type==="relation"&&e[t.name]){const o=e[t.name];const n=t.relation;console.log(`ðŸ” ENTITY DEBUG: Processing relation ${t.name} -> ${n} (ID: ${o})`);try{const r=await this.getTableMetadata(n);const a=r.primaryKey||`${n}_id`;console.log(`ðŸ” ENTITY DEBUG: Loading related data from ${n} where ${a}=${o}`);const{data:s,error:i}=await this.getSupabaseClient().from(n).select("*").eq(a,o).single();if(!i&&s){const o=r.titleField||a;e[t.name+"_text"]=s[o];e[t.name+"_obj"]=s;console.log(`ðŸ” ENTITY DEBUG: Loaded related text: ${e[t.name+"_text"]}`)}else if(i){console.error(`ðŸ” ENTITY DEBUG: Error loading related data:`,i)}}catch(e){console.error(`ðŸ” ENTITY DEBUG: Exception loading related data:`,e)}}}console.log("ðŸ” ENTITY DEBUG: Setting entity data to model");n.setProperty("/entity",e);n.setProperty("/originalEntity",JSON.parse(JSON.stringify(e)));const a=o.titleField||r;const s=o.subtitleField;n.setProperty("/entityTitle",e[a]);if(s&&e[s]){n.setProperty("/entitySubtitle",e[s])}else{n.setProperty("/entitySubtitle","ID: "+e[r])}console.log("ðŸ” ENTITY DEBUG: Configuring entity form");this._configureForm(o,e);console.log("ðŸ” ENTITY DEBUG: Loading related items");this._loadRelatedItems(o,e)}).catch(e=>{console.error("ðŸ” ENTITY DEBUG: Error in Supabase query:",e);console.error("ðŸ” ENTITY DEBUG: Error stack:",e.stack);n.setProperty("/busy",false)})}catch(e){console.error("ðŸ” ENTITY DEBUG: Critical error in _continueLoadingEntity:",e);console.error("ðŸ” ENTITY DEBUG: Error stack:",e.stack);try{const e=this.getModel("viewModel");if(e){e.setProperty("/busy",false)}}catch(e){console.error("ðŸ” ENTITY DEBUG: Error resetting busy state:",e)}}},_loadRelatedItems:function(e,t){console.log("ðŸ” RELATED DEBUG: Starting _loadRelatedItems method");console.log("ðŸ” RELATED DEBUG: Metadata:",JSON.stringify(e,null,2));console.log("ðŸ” RELATED DEBUG: Entity data:",JSON.stringify(t,null,2));try{const o=this.getModel("viewModel");if(!o){console.error("ðŸ” RELATED DEBUG: viewModel not found! Aborting method.");return}const n=o.getProperty("/tableId");console.log("ðŸ” RELATED DEBUG: Table ID from viewModel:",n);const r=this.getView().byId("relatedItemsSection");console.log("ðŸ” RELATED DEBUG: Related items section found?",!!r);if(r){console.log("ðŸ” RELATED DEBUG: Setting related items section to ALWAYS visible");r.setVisible(true)}else{console.error("ðŸ” RELATED DEBUG: Related items section not found in view! Check the ID in your XML")}console.log("ðŸ” RELATED DEBUG: Checking for relations in metadata");if(!e.relations||e.relations.length===0){console.log("ðŸ” RELATED DEBUG: No relations defined for table:",n);console.log("ðŸ” RELATED DEBUG: Setting empty arrays for items");o.setProperty("/relatedItems",[]);o.setProperty("/filteredRelatedItems",[]);console.log("ðŸ” RELATED DEBUG: Calling _configureRelatedItemsTable with empty data");this._configureRelatedItemsTable(n);o.setProperty("/busy",false);return}const a=e.relations[0];console.log("ðŸ” RELATED DEBUG: Found relation:",JSON.stringify(a));const s=e.primaryKey||`${n}_id`;console.log("ðŸ” RELATED DEBUG: Using primary key:",s);console.log("ðŸ” RELATED DEBUG: Entity data keys:",Object.keys(t).join(", "));console.log("ðŸ” RELATED DEBUG: Primary key value:",t[s]);const i=t[s];if(!i){console.error("ðŸ” RELATED DEBUG: Primary key value not found in entity data!");console.log("ðŸ” RELATED DEBUG: Setting empty arrays for related items");o.setProperty("/relatedItems",[]);o.setProperty("/filteredRelatedItems",[]);console.log("ðŸ” RELATED DEBUG: Calling _configureRelatedItemsTable with empty data");this._configureRelatedItemsTable(n);o.setProperty("/busy",false);return}console.log(`ðŸ” RELATED DEBUG: Will query: ${a.table}.select('*').eq('${a.foreignKey}', '${i}')`);if(!this.getSupabaseClient()){console.error("ðŸ” RELATED DEBUG: Supabase client not available!");o.setProperty("/busy",false);return}try{console.log("ðŸ” RELATED DEBUG: Executing Supabase query");this.getSupabaseClient().from(a.table).select("*").eq(a.foreignKey,i).then(({data:e,error:t})=>{console.log("ðŸ” RELATED DEBUG: Supabase query completed");if(t){console.error("ðŸ” RELATED DEBUG: Error loading related items:",t);o.setProperty("/busy",false);return}console.log("ðŸ” RELATED DEBUG: Related items loaded:",e?e.length:0);console.log("ðŸ” RELATED DEBUG: Full related items data:",JSON.stringify(e));console.log("ðŸ” RELATED DEBUG: Setting model data for related items");o.setProperty("/relatedItems",e||[]);o.setProperty("/filteredRelatedItems",e||[]);const n=o.getProperty("/filteredRelatedItems");console.log("ðŸ” RELATED DEBUG: Model data set, count:",n.length);console.log("ðŸ” RELATED DEBUG: Now configuring the table");this._configureRelatedItemsTable(a.table);o.setProperty("/busy",false);console.log("ðŸ” RELATED DEBUG: _loadRelatedItems completed successfully")}).catch(e=>{console.error("ðŸ” RELATED DEBUG: Error in Supabase query:",e);console.error("ðŸ” RELATED DEBUG: Error stack:",e.stack);o.setProperty("/busy",false)})}catch(e){console.error("ðŸ” RELATED DEBUG: Exception during Supabase query:",e);console.error("ðŸ” RELATED DEBUG: Error stack:",e.stack);o.setProperty("/busy",false)}}catch(e){console.error("ðŸ” RELATED DEBUG: Critical error in _loadRelatedItems:",e);console.error("ðŸ” RELATED DEBUG: Error stack:",e.stack);const t=this.getModel("viewModel");if(t){t.setProperty("/busy",false)}}},_loadRelationOptionsForEdit:function(e,t,o){console.log(`Loading relation options for ${o} from table ${t}`);this.getTableMetadata(t).then(function(n){const r=n.primaryKey;const a=n.titleField||r;console.log(`Relation ${o}: Using primary key '${r}' and title field '${a}' from ${t}`);this.getSupabaseClient().from(t).select(`${r}, ${a}`).then(({data:t,error:s})=>{if(s){console.error(`Error loading relation options for ${o}:`,s);return}console.log(`Loaded ${t?t.length:0} relation options for ${o}`);e.removeAllItems();const i=n.columns.find(e=>e.name===o);if(i&&!i.required){e.addItem(new sap.ui.core.Item({key:"",text:"- None -"}))}if(t&&t.length>0){t.forEach(t=>{const o=t[r];const n=t[a]||o;e.addItem(new sap.ui.core.Item({key:o,text:n}));console.log(`Added relation option: key=${o}, text=${n}`)})}console.log(`Initial selected key for ${o}: ${e.getSelectedKey()}`)})}.bind(this)).catch(e=>{console.error(`Error getting metadata for relation ${o}:`,e)})},onNavBack:function(){console.log("Back button pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");let o=e.getProperty("/parentInfo");if(!o&&this._parentInfoBackup){console.log("Using parent info backup for back navigation");o=this._parentInfoBackup}if(!o){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){o=JSON.parse(e);console.log("Retrieved parent info from session storage for back navigation")}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}if(o&&o.parentTable&&o.parentId){console.log("Navigating to parent entity after back button:",o.parentTable,o.parentId);try{setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:o.parentTable,id:o.parentId});console.log("Navigation to parent initiated after back button")},100)}catch(e){console.error("Error during navigation to parent after back button:",e);this.getRouter().navTo("entityList",{table:t})}}else{console.log("No parent info, navigating to list view after back button");this.getRouter().navTo("entityList",{table:t})}},_updateDeleteButtonState:function(e){let t=null;const o=this.getView().byId("ObjectPageLayout");if(o){const e=o.getHeaderTitle();if(e){const o=e.getActions()||[];for(let e=0;e<o.length;e++){const n=o[e];if(n.getIcon&&n.getIcon()==="sap-icon://delete"){t=n;break}}}}if(!t){t=this.getView().byId("deleteButton")}if(t){const o=e&&e.length>0;t.setEnabled(!o);if(o){t.setTooltip("Cannot delete while related items exist")}else{t.setTooltip("Delete this entity")}}}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityDetailActions.controller", ["sap/ui/core/mvc/ControllerExtension","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/m/MessageToast","sap/ui/core/IconPool"],function(e,t,o,s,r,i){"use strict";return e.extend("com.supabase.easyui5.controller.EntityDetailActions",{onSavePress:function(){console.log("Save button pressed in extensions");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");e.setProperty("/busy",true);const s=JSON.parse(JSON.stringify(e.getProperty("/entity")));console.log("Full Entity Data:",JSON.stringify(s,null,2));this.getTableMetadata(t).then(r=>{this.getView().getController()._currentMetadata=r;if(this.validateForm&&typeof this.validateForm==="function"){if(!this.validateForm()){this._showErrorDialog("Validation Error","Please correct the errors in the form");e.setProperty("/busy",false);return}}else{if(!this.validateForm(r,s)){this._showErrorDialog("Validation Error","Please correct the errors in the form");e.setProperty("/busy",false);return}}const i=r.primaryKey;const n={};r.columns.forEach(e=>{if(e.editable===false&&e.name!==i){return}n[e.name]=s[e.name]});console.log("Prepared Update Data:",JSON.stringify(n,null,2));if("updated_at"in s){n["updated_at"]=(new Date).toISOString()}this._showConfirmationDialog("Save Changes","Are you sure you want to save these changes?",()=>{this.getSupabaseClient().from(t).update(n).eq(i,o).then(({data:s,error:r})=>{e.setProperty("/busy",false);if(r){console.error("Update error:",r);this._showErrorDialog("Update Error","Error updating entity: "+r.message);return}e.setProperty("/editMode",false);this._showSuccessDialog("Success","Entity updated successfully");this._loadEntity(t,o)}).catch(t=>{console.error("Error in Supabase query:",t);this._showErrorDialog("Update Error","Error updating entity: "+t.message);e.setProperty("/busy",false)})},()=>{e.setProperty("/busy",false)})}).catch(t=>{console.error("Error getting table metadata:",t);this._showErrorDialog("Metadata Error","Error getting table metadata: "+t.message);e.setProperty("/busy",false)})},onCancelPress:function(){console.log("Cancel button pressed in extensions");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");this._showConfirmationDialog("Cancel Editing","Are you sure you want to discard your changes?",()=>{e.setProperty("/editMode",false);this._loadEntity(t,o)},null)},onEditPress:function(){console.log("Edit button pressed in extensions");const e=this.getModel("viewModel");this.getView().getController()._formFields={};e.setProperty("/editMode",true);const t=e.getProperty("/entity");e.setProperty("/originalEntity",JSON.parse(JSON.stringify(t)))},onDeletePress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const o=e.getProperty("/entityId");const s=e.getProperty("/tableName");this._showConfirmationDialog("Delete Confirmation","Are you sure you want to delete this "+s+"?",()=>{this._deleteEntity(t,o)},null)},_deleteEntity:function(e,t){const o=this.getModel("viewModel");o.setProperty("/busy",true);this.getTableMetadata(e).then(s=>{const r=s.primaryKey;this.getSupabaseClient().from(e).delete().eq(r,t).then(({error:t})=>{o.setProperty("/busy",false);if(t){this._showErrorDialog("Delete Error","Error deleting entity: "+t.message);return}const s=o.getProperty("/tableName");this._showSuccessDialog("Success",s+" deleted successfully",()=>{this.getRouter().navTo("entityList",{table:e})})}).catch(e=>{console.error("Error in Supabase query:",e);this._showErrorDialog("Delete Error","Error deleting entity: "+e.message);o.setProperty("/busy",false)})}).catch(e=>{console.error("Error getting table metadata:",e);this._showErrorDialog("Metadata Error","Error loading metadata: "+e.message);o.setProperty("/busy",false)})},_showConfirmationDialog:function(e,r,n,a){if(this._oConfirmDialog){this._oConfirmDialog.destroy()}this._oConfirmDialog=new t({title:e,type:"Message",state:"Warning",icon:i.getIconURI("question-mark"),content:new s({text:r}),beginButton:new o({text:"Yes",press:function(){this._oConfirmDialog.close();if(n){n()}}.bind(this)}),endButton:new o({text:"No",press:function(){this._oConfirmDialog.close();if(a){a()}}.bind(this)}),styleClass:this.getOwnerComponent().getContentDensityClass(),verticalScrolling:false});this._oConfirmDialog.open()},_showSuccessDialog:function(e,r,n){if(this._oSuccessDialog){this._oSuccessDialog.destroy()}this._oSuccessDialog=new t({title:e,type:"Message",state:"Success",icon:i.getIconURI("accept"),content:new s({text:r}),beginButton:new o({text:"OK",press:function(){this._oSuccessDialog.close();if(n){n()}}.bind(this)}),styleClass:this.getOwnerComponent().getContentDensityClass(),verticalScrolling:false});this._oSuccessDialog.open()},_showErrorDialog:function(e,r,n){if(this._oErrorDialog){this._oErrorDialog.destroy()}this._oErrorDialog=new t({title:e,type:"Message",state:"Error",icon:i.getIconURI("error"),content:new s({text:r}),beginButton:new o({text:"OK",press:function(){this._oErrorDialog.close();if(n){n()}}.bind(this)}),styleClass:this.getOwnerComponent().getContentDensityClass(),verticalScrolling:false});this._oErrorDialog.open()},showSuccessMessage:function(e){this._showSuccessDialog("Success",e)},showErrorMessage:function(e,t){let o=e;if(t){o+=": "+(t.message||JSON.stringify(t))}this._showErrorDialog("Error",o)}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityDetailExtensions.controller", ["com/supabase/easyui5/controller/EntityDetailForm.controller","com/supabase/easyui5/controller/EntityDetailRelatedItems.controller","com/supabase/easyui5/controller/EntityDetailActions.controller","com/supabase/easyui5/controller/EntityForm.utils.controller"],function(e,t,n){"use strict";return function(){const r=new e;const l=new t;const o=new n;const s=new EntityFormUtils;return{form:{_configureForm:function(e,t){return r.configureForm.call(this,e,t)},configureForm:function(e,t){return r.configureForm.call(this,e,t)},configureGridForm:function(e,t){return r.configureGridForm.call(this,e,t)},validateForm:function(){return r.validateForm.call(this)},createDisplayField:function(e,t){return s.createDisplayField.call(this,e,t)},createFieldChangeHandler:function(e){return r.createFieldChangeHandler.call(this,e)},setFieldError:function(e,t){return r.setFieldError.call(this,e,t)},clearFieldError:function(e){return r.clearFieldError.call(this,e)}},relatedItems:{_loadRelatedItems:function(e,t){return l._loadRelatedItems.call(this,e,t)},loadRelatedItems:function(e,t){return l._loadRelatedItems.call(this,e,t)},_configureRelatedItemsTable:function(e){return l._configureRelatedItemsTable.call(this,e)},configureRelatedItemsTable:function(e){return l._configureRelatedItemsTable.call(this,e)},onRelatedItemsSearch:function(e){return l.onRelatedItemsSearch.call(this,e)},onRelatedItemPress:function(e){return l.onRelatedItemPress.call(this,e)},onEditRelatedItemPress:function(e){return l.onEditRelatedItemPress.call(this,e)},onDeleteRelatedItemPress:function(e){return l.onDeleteRelatedItemPress.call(this,e)},onAddRelatedItemPress:function(){return l.onAddRelatedItemPress.call(this)}},actions:{onSavePress:function(){return o.onSavePress.call(this)},onCancelPress:function(){return o.onCancelPress.call(this)},onEditPress:function(){return o.onEditPress.call(this)},onDeletePress:function(){return o.onDeletePress.call(this)}}}}});
sap.ui.predefine("com/supabase/easyui5/controller/EntityDetailForm.controller", ["sap/ui/core/mvc/ControllerExtension","sap/m/Label","sap/m/Text","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/ComboBox","sap/ui/layout/Grid","sap/ui/layout/GridData","sap/m/VBox","sap/m/HBox","sap/m/Panel"],function(e,t,a,r,o,i,s,n,l,d,u,c,m){"use strict";return e.extend("com.supabase.easyui5.controller.EntityDetailForm",{configureForm:function(e,a){console.log("Configuring form with metadata:",e);const l=this.getView().byId("entityDetailsContainer");if(!l){console.error("Form container not found");return}l.removeAllFormElements();const d=this.getModel("viewModel");const u=d.getProperty("/editMode");console.log("Edit Mode:",u);if(u){this.initFormFields()}e.columns.forEach(e=>{if(!e.visible){return}const d=new sap.ui.layout.form.FormElement({label:new t({text:e.label,required:u&&e.required})});let c;const m="viewModel>/entity/"+e.name;if(u){if(e.type==="relation"){c=new n({selectedKey:{path:m,mode:"TwoWay"},width:"100%",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",selectionChange:this.createFieldChangeHandler(e)});this.loadRelationOptions(c,e.relation,e.name)}else if(e.type==="boolean"){c=new i({selected:{path:m,mode:"TwoWay"},enabled:!(e.editable===false),select:this.createFieldChangeHandler(e)})}else if(e.type==="date"){c=new s({value:{path:m,mode:"TwoWay",type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"mediumDate",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",change:function(t){if(t.getParameter("valid")){t.getSource().setValueState("None");this.clearFieldError(e.name)}else{t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid date");this.setFieldError(e.name,"Please enter a valid date")}}.bind(this)})}else if(e.type==="number"){c=new r({value:{path:m,mode:"TwoWay",type:new sap.ui.model.type.Float({decimals:2})},type:"Number",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");if(a&&isNaN(parseFloat(a))){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid number");this.setFieldError(e.name,"Please enter a valid number")}else{t.getSource().setValueState("None");this.clearFieldError(e.name)}}.bind(this)})}else if(e.type==="email"){c=new r({value:{path:m,mode:"TwoWay"},type:"Email",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid email address");this.setFieldError(e.name,"Please enter a valid email address")}else{t.getSource().setValueState("None");this.clearFieldError(e.name)}}.bind(this)})}else if(e.type==="url"){c=new r({value:{path:m,mode:"TwoWay"},type:"Url",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^(http|https):\/\/[^ "]+$/;if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid URL (starting with http:// or https://)");this.setFieldError(e.name,"Please enter a valid URL (starting with http:// or https://)")}else{t.getSource().setValueState("None");this.clearFieldError(e.name)}}.bind(this)})}else if(e.type==="text"){c=new o({value:{path:m,mode:"TwoWay"},rows:3,width:"100%",enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:this.createFieldChangeHandler(e)})}else{c=new r({value:{path:m,mode:"TwoWay"},enabled:!(e.editable===false),valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:this.createFieldChangeHandler(e)})}if(this.getView().getController()._formFields){this.getView().getController()._formFields[e.name]=c}}else{c=this.createDisplayField(e,a)}d.addField(c);l.addFormElement(d)});console.log("Form configuration complete")},configureGridForm:function(e,a){try{console.log("Finding suitable container for entity details");let r=null;r=this.getView().byId("detailContentArea")||this.getView().byId("entityDetailsContainer");if(!r){const e=this.getView().getControlsByType("sap.uxap.ObjectPageSubSection");if(e&&e.length>0){r=e[0];console.log("Using ObjectPageSubSection as container")}}if(!r){const e=this.getView().getControlsByType("sap.ui.layout.form.SimpleForm")||this.getView().getControlsByType("sap.ui.layout.form.Form")||this.getView().getControlsByType("sap.m.VBox")||this.getView().getControlsByType("sap.m.Panel");if(e&&e.length>0){r=e[0];console.log("Using layout container:",r.getMetadata().getName())}}if(!r){const e=this.getView().getControlsByType("sap.m.Page")[0]||this.getView().getControlsByType("sap.uxap.ObjectPageLayout")[0];if(e){if(e.getContent&&e.addContent){r=e;console.log("Using page as container")}}}if(!r){console.error("Could not find any suitable container for entity details");return}const o=new l({defaultSpan:"XL4 L4 M6 S12",vSpacing:1,hSpacing:1,width:"100%"});e.columns.forEach(e=>{if(!e.visible)return;const r=new u({width:"100%",alignItems:"Start"});r.addItem(new t({text:e.label,design:"Bold",width:"100%"}).addStyleClass("sapUiTinyMarginBottom"));let i=this.createDisplayField(e,a);i.addStyleClass("sapUiTinyMarginTop");i.setWidth("100%");r.addItem(i);o.addContent(r.addStyleClass("sapUiSmallMargin"))});const i=new m({headerText:"Details",expandable:false,expanded:true,backgroundDesign:"Solid",content:[o]});if(r.removeAllContent){r.removeAllContent();r.addContent(i)}else if(r.removeAllItems){r.removeAllItems();r.addItem(i)}else if(r.removeAllFormElements){r.removeAllFormElements();const e=new sap.ui.layout.form.FormElement;e.addField(i);r.addFormElement(e)}else if(r.addContent){r.addContent(i)}else{console.error("Container doesn't have a method to add content:",r)}console.log("Entity details added to container")}catch(e){console.error("Error in dynamic configureGridForm:",e)}},loadEntity:function(e,t){console.log("Loading entity data for table:",e,"entity ID:",t);const a=this.getModel("viewModel");a.setProperty("/busy",true);return new Promise((r,o)=>{this.getTableMetadata(e).then(i=>{console.log("Got metadata for table:",e);const s=i.primaryKey;console.log("Primary key from metadata:",s);if(!s){this.showErrorMessage("Error: No primary key defined in metadata");a.setProperty("/busy",false);o(new Error("No primary key defined"));return}if(!t){this.showErrorMessage("Error: No entity ID specified");a.setProperty("/busy",false);o(new Error("No entity ID specified"));return}this.getView().getController()._currentMetadata=i;this.getSupabaseClient().from(e).select("*").eq(s,t).single().then(async({data:e,error:t})=>{if(t){console.error("Error loading entity data:",t);this.showErrorMessage("Error loading entity: "+t.message);a.setProperty("/busy",false);o(t);return}if(!e){console.error("No data found for entity");this.showErrorMessage("Entity not found");a.setProperty("/busy",false);o(new Error("Entity not found"));return}console.log("Entity data loaded:",e);for(const t of i.columns){if(t.type==="relation"&&e[t.name]){const a=e[t.name];const r=t.relation;try{const o=await this.getTableMetadata(r);const{data:i,error:s}=await this.getSupabaseClient().from(r).select("*").eq(o.primaryKey,a).single();if(!s&&i){e[t.name+"_text"]=i[o.titleField];e[t.name+"_obj"]=i}}catch(e){console.error("Error loading related data",e)}}}console.log("Setting entity data to model");a.setProperty("/entity",e);const n=i.titleField||s;const l=i.subtitleField;a.setProperty("/entityTitle",e[n]);if(l&&e[l]){a.setProperty("/entitySubtitle",e[l])}else{a.setProperty("/entitySubtitle","ID: "+e[s])}const d=a.getProperty("/useGridForm");if(d){this.configureGridForm(i,e)}else{this.configureForm(i,e)}a.setProperty("/busy",false);r(e)}).catch(e=>{console.error("Error in Supabase query:",e);this.showErrorMessage("Error loading entity: "+e.message);a.setProperty("/busy",false);o(e)})}).catch(e=>{console.error("Error getting table metadata:",e);this.showErrorMessage("Error loading metadata: "+e.message);a.setProperty("/busy",false);o(e)})})},validateForm:function(){const e=this.getModel("viewModel");const t=e.getProperty("/entity");const a={};const r=this.getView().getController()._currentMetadata;let o=true;if(!r){console.error("No metadata available for validation");return false}const i=this.getView().getController()._formFields||{};Object.values(i).forEach(e=>{if(e.setValueState){e.setValueState("None")}});r.columns.forEach(e=>{if(e.editable===false||e.name===r.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}const s=e.name;const n=t[s];const l=i[s];if(e.required&&(n===undefined||n===null||n==="")){o=false;a[s]="This field is required";if(l&&l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText("This field is required")}}console.log("Required field validation failed:",s)}else if(n!==undefined&&n!==null&&n!==""){let t=true;let r="";switch(e.type){case"number":if(isNaN(parseFloat(n))||!isFinite(n)){t=false;r="Please enter a valid number"}break;case"date":const e=new Date(n);if(isNaN(e.getTime())){t=false;r="Please enter a valid date"}break;case"email":const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.test(n)){t=false;r="Please enter a valid email address"}break;case"url":const o=/^(http|https):\/\/[^ "]+$/;if(!o.test(n)){t=false;r="Please enter a valid URL (starting with http:// or https://)"}break}if(!t){o=false;a[s]=r;if(l&&l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText(r)}}console.log("Type validation failed:",s,r)}}});e.setProperty("/validationErrors",a);return o},saveEntity:function(e,t){const a=this.getModel("viewModel");const r=a.getProperty("/entity");a.setProperty("/busy",true);return new Promise((o,i)=>{this.getTableMetadata(e).then(s=>{const n=s.primaryKey;if(!this.validateForm()){this.showErrorMessage("Please correct the errors in the form");a.setProperty("/busy",false);i(new Error("Validation failed"));return}const l=this.getEntityDataForSave(s,r,n);console.log("Data to update:",l);this.getSupabaseClient().from(e).update(l).eq(n,t).then(({data:s,error:n})=>{a.setProperty("/busy",false);if(n){console.error("Update error:",n);this.showErrorMessage("Error updating entity",n);i(n);return}a.setProperty("/editMode",false);this.showSuccessMessage("Entity updated successfully");this.loadEntity(e,t).then(e=>o(e)).catch(e=>{console.error("Error reloading entity after save:",e);o(r)})}).catch(e=>{console.error("Error in Supabase query:",e);this.showErrorMessage("Error updating entity: "+e.message);a.setProperty("/busy",false);i(e)})}).catch(e=>{console.error("Error getting table metadata:",e);this.showErrorMessage("Error getting table metadata: "+e.message);a.setProperty("/busy",false);i(e)})})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityDetailRelatedItems.controller", ["sap/ui/core/mvc/ControllerExtension","sap/m/Column","sap/m/Label","sap/m/Text","sap/m/ColumnListItem","sap/m/HBox","sap/m/Button","sap/m/Dialog","sap/m/MessageBox"],function(e,t,a,o,n,r,s,i,l){"use strict";return e.extend("com.supabase.easyui5.controller.EntityDetailRelatedItems",{_processRelatedItemsRelations:function(e,t){if(!t||t.length===0){return Promise.resolve(t)}console.log("ðŸ” RELATED DEBUG: Processing relations for",t.length,"items");return this.getTableMetadata(e).then(e=>{const a=e.columns.filter(e=>e.type==="relation");if(a.length===0){return t}console.log("ðŸ” RELATED DEBUG: Found",a.length,"relation columns");const o=t.map(e=>{const t=a.filter(t=>e[t.name]).map(t=>{const a=e[t.name];const o=t.relation;console.log(`ðŸ” RELATED DEBUG: Processing relation ${t.name} -> ${o} (ID: ${a})`);return this.getTableMetadata(o).then(n=>{const r=n.primaryKey;const s=n.titleField||r;return this.getSupabaseClient().from(o).select("*").eq(r,a).single().then(({data:o,error:n})=>{if(!n&&o){e[t.name+"_text"]=o[s]||o[r];console.log(`ðŸ” RELATED DEBUG: Loaded related text: ${e[t.name+"_text"]}`)}else if(n){console.error(`ðŸ” RELATED DEBUG: Error loading related data:`,n);e[t.name+"_text"]=`ID: ${a}`}return e}).catch(o=>{console.error("ðŸ” RELATED DEBUG: Error processing relation in related item",o);e[t.name+"_text"]=`ID: ${a}`;return e})})});if(t.length===0){return Promise.resolve(e)}return Promise.all(t).then(()=>e)});return Promise.all(o).then(e=>{console.log("ðŸ” RELATED DEBUG: Completed processing relations for all items");return e})}).catch(e=>{console.error("ðŸ” RELATED DEBUG: Error processing relations in related items",e);return t})},onRelatedItemsSearch:function(e){const t=e.getParameter("query")||e.getParameter("newValue")||"";const a=this.getModel("viewModel");const o=a.getProperty("/relatedItems")||[];if(!t){a.setProperty("/filteredRelatedItems",o);return}const n=t.toLowerCase();const r=o.filter(e=>Object.values(e).some(e=>{if(e===null||e===undefined){return false}return String(e).toLowerCase().includes(n)}));a.setProperty("/filteredRelatedItems",r);console.log(`ðŸ” RELATED DEBUG: Filtered related items to ${r.length} of ${o.length} total`)},onRelatedItemPress:function(e){const t=e.getSource();const a=t.getBindingContext("viewModel");if(!a){console.error("No binding context found for related item");return}const o=a.getObject();const n=this.getModel("viewModel");const r=n.getProperty("/tableId");console.log("Item pressed:",o);this.getTableMetadata(r).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined for navigation");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const a=e.primaryKey;const n=o[a];console.log(`Navigating to related item details: ${t.table}/${n}`);this.getRouter().navTo("entityDetail",{table:t.table,id:n})})})},onDeleteRelatedItemPress:function(e){e.preventDefault();e.stopPropagation();const t=e.getSource();const a=t.getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");console.log("Delete related item:",n);this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const a=e.primaryKey;const o=n[a];console.log(`Confirming deletion of related item: ${t.table}/${o}`);sap.m.MessageBox.confirm("Are you sure you want to delete this related item?",{title:"Delete Confirmation",onClose:function(e){if(e===sap.m.MessageBox.Action.OK){console.log(`Deleting related item: ${t.table}/${o}`);r.setProperty("/busy",true);this.getSupabaseClient().from(t.table).delete().eq(a,o).then(({error:e})=>{r.setProperty("/busy",false);if(e){console.error("Error deleting related item:",e);sap.m.MessageBox.error("Error deleting related item: "+e.message);return}console.log("Related item deleted successfully");const t=[...r.getProperty("/relatedItems")];const n=[...r.getProperty("/filteredRelatedItems")];const s=t.findIndex(e=>e[a]===o);if(s!==-1){t.splice(s,1);r.setProperty("/relatedItems",t)}const i=n.findIndex(e=>e[a]===o);if(i!==-1){n.splice(i,1);r.setProperty("/filteredRelatedItems",n)}sap.m.MessageToast.show("Related item deleted successfully")}).catch(e=>{r.setProperty("/busy",false);console.error("Error in delete operation:",e);sap.m.MessageBox.error("Error deleting related item: "+e.message)})}}.bind(this)})})})},onAddRelatedItemPress:function(){console.log("Add related item button pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");const a=e.getProperty("/entityId");console.log(`Adding related item for parent entity ${t}/${a}`);this.getTableMetadata(t).then(o=>{if(!o.relations||o.relations.length===0){console.error("No relations defined in metadata");sap.m.MessageBox.error("No relations defined for this entity");return}const n=o.relations[0];const r=n.table;console.log(`Creating dialog for new ${r} related to ${t}/${a}`);this.getTableMetadata(r).then(t=>{const s={};t.columns.forEach(e=>{if(e.name===n.foreignKey){s[e.name]=a}else if(e.type==="boolean"){s[e.name]=false}else if(e.type==="number"){s[e.name]=0}else if(e.type==="date"){s[e.name]=(new Date).toISOString().split("T")[0]}else{s[e.name]=""}});const i=new sap.ui.model.json.JSONModel({entity:s,validationErrors:{},title:`Add New ${t.titleField?t.titleField:"Related Item"}`,busy:false});const l=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:0,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false});const d={};t.columns.forEach(o=>{if(o.editable===false||o.name===t.primaryKey||o.name==="created_at"||o.name==="updated_at"){return}const r=o.name===n.foreignKey;if(r){l.addContent(new sap.m.Label({text:o.label,required:o.required}));l.addContent(new sap.m.Text({text:`Connected to ${e.getProperty("/tableName")} (ID: ${a})`}));return}l.addContent(new sap.m.Label({text:o.label,required:o.required===true}));let s;switch(o.type){case"relation":s=new sap.m.ComboBox({selectedKey:"{/entity/"+o.name+"}",width:"100%",enabled:true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"});this._loadRelationOptionsForDialog(s,o.relation,o.required);break;case"boolean":s=new sap.m.CheckBox({selected:"{/entity/"+o.name+"}"});break;case"date":s=new sap.m.DatePicker({value:{path:"/entity/"+o.name,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",required:o.required===true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"});break;case"number":s=new sap.m.Input({value:{path:"/entity/"+o.name,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",required:o.required===true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"});break;case"email":s=new sap.m.Input({value:"{/entity/"+o.name+"}",type:"Email",width:"100%",required:o.required===true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"});break;case"text":s=new sap.m.TextArea({value:"{/entity/"+o.name+"}",rows:3,growing:true,width:"100%",required:o.required===true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"});break;default:s=new sap.m.Input({value:"{/entity/"+o.name+"}",width:"100%",required:o.required===true,valueState:"{= ${/validationErrors/"+o.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+o.name+"}"})}l.addContent(s);d[o.name]=s});const c=new sap.m.Dialog({title:"{/title}",contentWidth:"40rem",contentHeight:"auto",resizable:true,draggable:true,stretch:sap.ui.Device.system.phone,content:[l],beginButton:new sap.m.Button({text:"Create",type:"Emphasized",press:function(){const s=this._validateDialogForm(t,i.getProperty("/entity"),d);if(!s){sap.m.MessageToast.show("Please correct the errors in the form");return}i.setProperty("/busy",true);const l=i.getProperty("/entity");l[n.foreignKey]=a;this.getSupabaseClient().from(r).insert(l).then(({data:t,error:a})=>{i.setProperty("/busy",false);if(a){console.error("Error creating related item:",a);sap.m.MessageBox.error("Error creating related item: "+a.message);return}c.close();sap.m.MessageToast.show("Related item created successfully");this._loadRelatedItems(o,e.getProperty("/entity"))}).catch(e=>{i.setProperty("/busy",false);console.error("Error in Supabase query:",e);sap.m.MessageBox.error("Error creating related item: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){c.close()}}),afterClose:function(){c.destroy()}});c.setModel(i);this.getView().addDependent(c);c.open()})})},onEditRelatedItemPress:function(e){e.preventDefault();e.stopPropagation();const t=e.getSource();const a=t.getParent().getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");const i=r.getProperty("/entityId");console.log("Editing related item:",JSON.stringify(n,null,2));console.log("Parent entity:",s,i);this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");l.error("No relations defined for this entity");return}const t=e.relations[0];const a=t.table;console.log(`Relation found: ${a} with foreign key ${t.foreignKey}`);this.getTableMetadata(a).then(e=>{const o=e.primaryKey;const r=n[o];console.log(`Related item primary key: ${o}, value: ${r}`);const l={parentTable:s,parentId:i,isEditing:true,foreignKey:t.foreignKey};console.log("Storing parent info in session storage:",JSON.stringify(l,null,2));sessionStorage.setItem("parentEntityInfo",JSON.stringify(l));this.getRouter().navTo("entityDetail",{table:a,id:r})})})},_configureRelatedItemsTable:function(e){console.log("ðŸ” TABLE DEBUG: Started _configureRelatedItemsTable for table:",e);try{const t=this.getView().byId("relatedItemsTable");if(!t){console.error("ðŸ” TABLE DEBUG: Related items table not found in the view! Check ID in XML");return}t.removeAllColumns();console.log("ðŸ” TABLE DEBUG: Removed all columns");this.getTableMetadata(e).then(a=>{console.log("ðŸ” TABLE DEBUG: Got metadata for table",e);const o=a.columns.filter(e=>e.visible).slice(0,5);console.log("ðŸ” TABLE DEBUG: Visible columns:",o.length);o.forEach((e,a)=>{console.log(`ðŸ” TABLE DEBUG: Adding column ${a+1}:`,e.name);t.addColumn(new sap.m.Column({header:new sap.m.Label({text:e.label})}))});console.log("ðŸ” TABLE DEBUG: Adding actions column");t.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Actions"}),hAlign:"Right"}));console.log("ðŸ” TABLE DEBUG: Finished adding columns, total:",t.getColumns().length);t.setMode("None");console.log("ðŸ” TABLE DEBUG: Creating template for binding");const n=new sap.m.ColumnListItem({type:"Inactive"});o.forEach((e,t)=>{console.log(`ðŸ” TABLE DEBUG: Adding cell ${t+1} for column:`,e.name);let a;switch(e.type){case"relation":a=new sap.m.Text({text:"{viewModel>"+e.name+"_text}"});break;case"boolean":a=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:function(e){return e?"Yes":"No"}}});break;case"date":a=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:function(e){if(!e)return"";return new Date(e).toLocaleDateString()}}});break;case"number":a=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:function(e){if(e===undefined||e===null)return"";return parseFloat(e).toFixed(2)}}});break;default:a=new sap.m.Text({text:"{viewModel>"+e.name+"}"})}n.addCell(a)});console.log("ðŸ” TABLE DEBUG: Adding actions cell to template");const r=new sap.m.HBox({justifyContent:"End",items:[new sap.m.Button({icon:"sap-icon://edit",type:"Transparent",tooltip:"Edit",press:this._handleRelatedItemEdit.bind(this)}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Button({icon:"sap-icon://display",type:"Transparent",tooltip:"View Details",press:this._handleRelatedItemView.bind(this)}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Button({icon:"sap-icon://delete",type:"Transparent",tooltip:"Delete",press:this._handleRelatedItemDelete.bind(this)})]});n.addCell(r);try{if(t.isBound("items")){console.log("ðŸ” TABLE DEBUG: Unbinding existing items");t.unbindItems()}t.bindItems({path:"viewModel>/filteredRelatedItems",template:n});console.log("ðŸ” TABLE DEBUG: Items bound successfully")}catch(e){console.error("ðŸ” TABLE DEBUG: Error during item binding:",e)}t.invalidate()}).catch(e=>{console.error("ðŸ” TABLE DEBUG: Error getting metadata:",e)})}catch(e){console.error("ðŸ” TABLE DEBUG: Critical error in _configureRelatedItemsTable:",e)}},_handleRelatedItemEdit:function(e){console.log("ðŸ” HANDLER DEBUG: Edit button clicked");const t=e.getSource();const a=t.getParent().getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");sap.m.MessageBox.error("No relations defined for this entity");return}const t=e.relations[0];const a=t.table;console.log(`Using relation: ${a} with foreign key ${t.foreignKey}`);this.getTableMetadata(a).then(o=>{const s=o.primaryKey;const i=n[s];console.log(`Primary key: ${s}, value: ${i}`);const l=new sap.ui.model.json.JSONModel({entity:JSON.parse(JSON.stringify(n)),validationErrors:{},title:`Edit ${n[o.titleField]||"Related Item"}`});const d=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:0,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false});const c={};o.columns.forEach(e=>{if(e.editable===false||e.name===o.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}const a=e.name===t.foreignKey;d.addContent(new sap.m.Label({text:e.label,required:e.required===true}));let n;if(a){n=new sap.m.Text({text:`Connected to ${r.getProperty("/tableName")} (ID: ${r.getProperty("/entityId")})`})}else if(e.type==="relation"){n=new sap.m.ComboBox({selectedKey:{path:"/entity/"+e.name},width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"});this._loadRelationOptionsForDialog(n,e.relation,e.required===true)}else if(e.type==="boolean"){n=new sap.m.CheckBox({selected:{path:"/entity/"+e.name}})}else if(e.type==="date"){n=new sap.m.DatePicker({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else if(e.type==="number"){n=new sap.m.Input({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else if(e.type==="text"){n=new sap.m.TextArea({value:{path:"/entity/"+e.name},rows:3,growing:true,width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else{n=new sap.m.Input({value:{path:"/entity/"+e.name},width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}d.addContent(n);c[e.name]=n});const m=new sap.m.Dialog({title:"{/title}",contentWidth:"40rem",contentHeight:"auto",resizable:true,draggable:true,content:[d],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){const n=this._validateDialogForm(o,l.getProperty("/entity"),c);if(!n){sap.m.MessageBox.error("Please correct the errors in the form");return}const d=l.getProperty("/entity");d[t.foreignKey]=r.getProperty("/entityId");console.log("Saving updated data:",JSON.stringify(d,null,2));m.setBusy(true);this.getSupabaseClient().from(a).update(d).eq(s,i).then(({data:t,error:a})=>{m.setBusy(false);if(a){console.error("Error updating related item:",a);sap.m.MessageBox.error("Error updating related item: "+a.message);return}console.log("Related item updated successfully:",t);sap.m.MessageToast.show("Related item updated successfully");m.close();this._loadRelatedItems(e,r.getProperty("/entity"))}).catch(e=>{m.setBusy(false);console.error("Error in Supabase query:",e);sap.m.MessageBox.error("Error updating related item: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){m.close()}}),afterClose:function(){m.destroy()}});m.setModel(l);this.getView().addDependent(m);m.open()}).catch(e=>{console.error("Error loading related table metadata:",e);sap.m.MessageBox.error("Error loading metadata: "+e.message)})}).catch(e=>{console.error("Error loading parent table metadata:",e);sap.m.MessageBox.error("Error loading metadata: "+e.message)})},_handleRelatedItemView:function(e){console.log("ðŸ” HANDLER DEBUG: View button clicked");const t=e.getSource();const a=t.getParent().getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const a=e.primaryKey;const o=n[a];console.log(`Navigating to related item details: ${t.table}/${o}`);this.getRouter().navTo("entityDetail",{table:t.table,id:o})})})},_handleRelatedItemDelete:function(e){console.log("ðŸ” HANDLER DEBUG: Delete button clicked");const t=e.getSource();const a=t.getParent().getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");return}const t=e.relations[0];this.getTableMetadata(t.table).then(e=>{const a=e.primaryKey;const o=n[a];console.log(`Confirming deletion of related item: ${t.table}/${o}`);sap.m.MessageBox.confirm("Are you sure you want to delete this related item?",{title:"Delete Confirmation",onClose:function(e){if(e===sap.m.MessageBox.Action.OK){console.log(`Deleting related item: ${t.table}/${o}`);r.setProperty("/busy",true);this.getSupabaseClient().from(t.table).delete().eq(a,o).then(({error:e})=>{r.setProperty("/busy",false);if(e){console.error("Error deleting related item:",e);sap.m.MessageBox.error("Error deleting related item: "+e.message);return}console.log("Related item deleted successfully");const t=[...r.getProperty("/relatedItems")];const n=[...r.getProperty("/filteredRelatedItems")];const s=t.findIndex(e=>e[a]===o);if(s!==-1){t.splice(s,1);r.setProperty("/relatedItems",t)}const i=n.findIndex(e=>e[a]===o);if(i!==-1){n.splice(i,1);r.setProperty("/filteredRelatedItems",n)}sap.m.MessageToast.show("Related item deleted successfully")}).catch(e=>{r.setProperty("/busy",false);console.error("Error in delete operation:",e);sap.m.MessageBox.error("Error deleting related item: "+e.message)})}}.bind(this)})})})},_setupRelatedItemsTable:function(e){const t=this.getView().byId("relatedItemsTable");if(!t){console.error("Related items table not found");return}t.removeAllColumns();t.removeAllItems();const a=this.getModel("viewModel");const o=a.getProperty("/filteredRelatedItems")||[];this.getTableMetadata(e).then(a=>{if(!a.relations||a.relations.length===0){console.log("No relations defined for table:",e);return}const n=a.relations[0];const r=n.table;this.getTableMetadata(r).then(e=>{const a=e.columns.filter(e=>e.visible).slice(0,4);a.forEach(e=>{t.addColumn(new sap.m.Column({header:new sap.m.Label({text:e.label})}))});t.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Actions"}),hAlign:"End"}));o.forEach((o,r)=>{const s=new sap.m.ColumnListItem({type:"Inactive"});a.forEach(e=>{let t;const a=o[e.name];switch(e.type){case"relation":t=new sap.m.Text({text:o[e.name+"_text"]||a});break;case"boolean":t=new sap.m.Text({text:a?"Yes":"No"});break;case"date":t=new sap.m.Text({text:a?new Date(a).toLocaleDateString():""});break;case"number":t=new sap.m.Text({text:a!==undefined&&a!==null?parseFloat(a).toFixed(2):""});break;default:t=new sap.m.Text({text:a||""})}s.addCell(t)});const i=new sap.m.HBox({justifyContent:"End",items:[new sap.m.Button({icon:"sap-icon://edit",type:"Transparent",tooltip:"Edit",press:function(){this._openEditDialog(n.table,o,e)}.bind(this)}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Button({icon:"sap-icon://display",type:"Transparent",tooltip:"View Details",press:function(){const t=e.primaryKey;this.getRouter().navTo("entityDetail",{table:n.table,id:o[t]})}.bind(this)}).addStyleClass("sapUiTinyMarginEnd"),new sap.m.Button({icon:"sap-icon://delete",type:"Transparent",tooltip:"Delete",press:function(){this._confirmDeleteItem(n.table,o,e)}.bind(this)})]});s.addCell(i);t.addItem(s)})})})},_openEditDialog:function(e,t,a){const o=new sap.ui.model.json.JSONModel({entity:JSON.parse(JSON.stringify(t)),validationErrors:{},title:`Edit ${t[a.titleField]||"Related Item"}`});const n=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:0,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false});const r={};a.columns.forEach(e=>{if(e.editable===false||e.name===a.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}n.addContent(new sap.m.Label({text:e.label,required:e.required===true}));let t;switch(e.type){case"relation":t=new sap.m.ComboBox({selectedKey:{path:"/entity/"+e.name},width:"100%"});break;case"boolean":t=new sap.m.CheckBox({selected:{path:"/entity/"+e.name}});break;case"date":t=new sap.m.DatePicker({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%"});break;case"number":t=new sap.m.Input({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%"});break;case"text":t=new sap.m.TextArea({value:{path:"/entity/"+e.name},rows:3,growing:true,width:"100%"});break;default:t=new sap.m.Input({value:{path:"/entity/"+e.name},width:"100%"})}n.addContent(t);r[e.name]=t});const s=new sap.m.Dialog({title:"{/title}",contentWidth:"40rem",contentHeight:"auto",resizable:true,draggable:true,content:[n],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){const n=o.getProperty("/entity");this.getSupabaseClient().from(e).update(n).eq(a.primaryKey,t[a.primaryKey]).then(({data:e,error:t})=>{if(t){sap.m.MessageBox.error("Error updating item: "+t.message);return}sap.m.MessageToast.show("Item updated successfully");s.close();this._loadRelatedItems(this._oTableMetadata,this.getModel("viewModel").getProperty("/entity"))}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){s.close()}}),afterClose:function(){s.destroy()}});s.setModel(o);this.getView().addDependent(s);s.open()},_confirmDeleteItem:function(e,t,a){sap.m.MessageBox.confirm("Are you sure you want to delete this item?",{title:"Delete Confirmation",onClose:function(o){if(o===sap.m.MessageBox.Action.OK){this.getSupabaseClient().from(e).delete().eq(a.primaryKey,t[a.primaryKey]).then(({error:e})=>{if(e){sap.m.MessageBox.error("Error deleting item: "+e.message);return}sap.m.MessageToast.show("Item deleted successfully");this._loadRelatedItems(this._oTableMetadata,this.getModel("viewModel").getProperty("/entity"))}).catch(e=>{sap.m.MessageBox.error("Error: "+e.message)})}}.bind(this)})},_loadRelatedItems:function(e,t){console.log("Starting _loadRelatedItems method");try{const a=this.getModel("viewModel");const o=a.getProperty("/tableId");const n=this.getView().byId("relatedItemsSection");if(n){n.setVisible(true)}if(!e.relations||e.relations.length===0){console.log("No relations defined for table:",o);a.setProperty("/relatedItems",[]);a.setProperty("/filteredRelatedItems",[]);this._setupRelatedItemsTable(o);a.setProperty("/busy",false);return Promise.resolve([])}const r=e.relations[0];const s=e.primaryKey||`${o}_id`;const i=t[s];if(!i){console.error("Primary key value not found in entity data!");a.setProperty("/relatedItems",[]);a.setProperty("/filteredRelatedItems",[]);this._setupRelatedItemsTable(o);a.setProperty("/busy",false);return Promise.resolve([])}this._sRelatedTableId=r.table;console.log(`Loading data from ${r.table} where ${r.foreignKey}=${i}`);return this.getSupabaseClient().from(r.table).select("*").eq(r.foreignKey,i).then(({data:e,error:t})=>{if(t){console.error("Error loading related items:",t);a.setProperty("/busy",false);return[]}const n=e||[];console.log(`Loaded ${n.length} related items`);return this._processRelatedItemsRelations(r.table,n).then(e=>{a.setProperty("/relatedItems",e);a.setProperty("/filteredRelatedItems",e);this._updateDeleteButtonState(e);this._configureRelatedItemsTable(o);a.setProperty("/busy",false);console.log("Related items loading complete");return e})}).catch(e=>{console.error("Error in Supabase query:",e);a.setProperty("/busy",false);return[]})}catch(e){console.error("Critical error in _loadRelatedItems:",e);const t=this.getModel("viewModel");if(t){t.setProperty("/busy",false)}return Promise.resolve([])}},onInit:function(){console.log("EntityDetail controller initialized");const e=new JSONModel({tableName:"",tableId:"",entityId:"",entityTitle:"",entitySubtitle:"",entity:{},originalEntity:{},relatedItems:[],filteredRelatedItems:[],editMode:false,busy:false,delay:0,validationErrors:{},parentInfo:null});this.setModel(e,"viewModel");this.getRouter().getRoute("entityDetail").attachPatternMatched(this._onRouteMatched,this);this._loadParentInfoForEdit();try{this._registerExtensions()}catch(e){console.error("Could not register extensions:",e)}},_loadParentInfoForEdit:function(){try{const e=sessionStorage.getItem("parentEntityInfo");console.log("Checking for parent info in detail view:",e);if(e){const t=JSON.parse(e);if(t.isEditing===true){console.log("Found parent info for edit mode:",JSON.stringify(t,null,2));const e=this.getModel("viewModel");e.setProperty("/parentInfo",t);this._parentInfoBackup=JSON.parse(JSON.stringify(t))}}}catch(e){console.error("Error parsing parent entity info:",e)}},onNavBack:function(){console.log("Back button pressed");const e=this.getModel("viewModel");const t=e.getProperty("/tableId");let a=e.getProperty("/parentInfo");if(!a&&this._parentInfoBackup){console.log("Using parent info backup for back navigation");a=this._parentInfoBackup}if(!a){try{const e=sessionStorage.getItem("parentEntityInfo");if(e){a=JSON.parse(e);console.log("Retrieved parent info from session storage for back navigation")}}catch(e){console.error("Error retrieving parent info from session storage:",e)}}try{sessionStorage.removeItem("parentEntityInfo");console.log("Cleared parent info from session storage")}catch(e){console.warn("Could not clear session storage:",e)}if(a&&a.parentTable&&a.parentId){console.log("Navigating to parent entity after back button:",a.parentTable,a.parentId);try{setTimeout(()=>{this.getRouter().navTo("entityDetail",{table:a.parentTable,id:a.parentId});console.log("Navigation to parent initiated after back button")},100)}catch(e){console.error("Error during navigation to parent after back button:",e);this.getRouter().navTo("entityList",{table:t})}}else{console.log("No parent info, navigating to list view after back button");this.getRouter().navTo("entityList",{table:t})}},_handleRelatedItemEdit:function(e){console.log("ðŸ” HANDLER DEBUG: Edit button clicked");const t=e.getSource();const a=t.getParent().getParent().getParent();const o=a.getBindingContext("viewModel");if(!o){console.error("No binding context found for related item");return}const n=o.getObject();const r=this.getModel("viewModel");const s=r.getProperty("/tableId");this.getTableMetadata(s).then(e=>{if(!e.relations||e.relations.length===0){console.error("No relations defined in metadata");sap.m.MessageBox.error("No relations defined for this entity");return}const t=e.relations[0];const a=t.table;console.log(`Using relation: ${a} with foreign key ${t.foreignKey}`);this.getTableMetadata(a).then(o=>{const s=o.primaryKey;const i=n[s];console.log(`Primary key: ${s}, value: ${i}`);const l=new sap.ui.model.json.JSONModel({entity:JSON.parse(JSON.stringify(n)),validationErrors:{},title:`Edit ${n[o.titleField]||"Related Item"}`});const d=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:0,emptySpanL:0,emptySpanM:0,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false});const c={};o.columns.forEach(e=>{if(e.editable===false||e.name===o.primaryKey||e.name==="created_at"||e.name==="updated_at"){return}const a=e.name===t.foreignKey;d.addContent(new sap.m.Label({text:e.label,required:e.required===true}));let n;if(a){n=new sap.m.Text({text:`Connected to ${r.getProperty("/tableName")} (ID: ${r.getProperty("/entityId")})`})}else if(e.type==="relation"){n=new sap.m.ComboBox({selectedKey:{path:"/entity/"+e.name},width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"});this._loadRelationOptionsForDialog(n,e.relation,e.required===true)}else if(e.type==="boolean"){n=new sap.m.CheckBox({selected:{path:"/entity/"+e.name}})}else if(e.type==="date"){n=new sap.m.DatePicker({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else if(e.type==="number"){n=new sap.m.Input({value:{path:"/entity/"+e.name,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else if(e.type==="text"){n=new sap.m.TextArea({value:{path:"/entity/"+e.name},rows:3,growing:true,width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}else{n=new sap.m.Input({value:{path:"/entity/"+e.name},width:"100%",valueState:"{= ${/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{/validationErrors/"+e.name+"}"})}d.addContent(n);c[e.name]=n});const m=new sap.m.Dialog({title:"{/title}",contentWidth:"40rem",contentHeight:"auto",resizable:true,draggable:true,content:[d],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:function(){const n=this._validateDialogForm(o,l.getProperty("/entity"),c);if(!n){sap.m.MessageBox.error("Please correct the errors in the form");return}const d=l.getProperty("/entity");d[t.foreignKey]=r.getProperty("/entityId");console.log("Saving updated data:",JSON.stringify(d,null,2));m.setBusy(true);this.getSupabaseClient().from(a).update(d).eq(s,i).then(({data:t,error:a})=>{m.setBusy(false);if(a){console.error("Error updating related item:",a);sap.m.MessageBox.error("Error updating related item: "+a.message);return}console.log("Related item updated successfully:",t);sap.m.MessageToast.show("Related item updated successfully");m.close();this._loadRelatedItems(e,r.getProperty("/entity"))}).catch(e=>{m.setBusy(false);console.error("Error in Supabase query:",e);sap.m.MessageBox.error("Error updating related item: "+e.message)})}.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:function(){m.close()}}),afterClose:function(){m.destroy()}});m.setModel(l);this.getView().addDependent(m);m.open()}).catch(e=>{console.error("Error loading related table metadata:",e);sap.m.MessageBox.error("Error loading metadata: "+e.message)})}).catch(e=>{console.error("Error loading parent table metadata:",e);sap.m.MessageBox.error("Error loading metadata: "+e.message)})},_validateDialogForm:function(e,t,a){const o={};let n=true;Object.values(a).forEach(e=>{if(e.setValueState){e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});e.columns.forEach(r=>{if(r.editable===false||r.name===e.primaryKey||r.name==="created_at"||r.name==="updated_at"){return}const s=r.name;const i=t[s];const l=a[s];if(!l)return;if(r.required&&(i===undefined||i===null||i==="")){n=false;o[s]="This field is required";if(l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText("This field is required")}}console.log("Required field validation failed:",s);return}if(i===undefined||i===null||i===""){return}let d=true;let c="";switch(r.type){case"number":if(isNaN(parseFloat(i))||!isFinite(i)){d=false;c="Please enter a valid number"}break;case"date":const e=new Date(i);if(isNaN(e.getTime())){d=false;c="Please enter a valid date"}break;case"email":const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!t.test(i)){d=false;c="Please enter a valid email address"}break;case"url":const a=/^(http|https):\/\/[^ "]+$/;if(!a.test(i)){d=false;c="Please enter a valid URL (starting with http:// or https://)"}break}if(!d){n=false;o[s]=c;if(l.setValueState){l.setValueState("Error");if(l.setValueStateText){l.setValueStateText(c)}}console.log("Type validation failed:",s,c)}});return n},_loadRelationOptionsForDialog:function(e,t,a){console.log(`Loading relation options for table ${t}`);this.getTableMetadata(t).then(o=>{const n=o.primaryKey;const r=o.titleField||n;console.log(`Using primary key ${n} and title field ${r}`);this.getSupabaseClient().from(t).select("*").then(({data:o,error:s})=>{if(s){console.error(`Error loading relation options for ${t}:`,s);return}console.log(`Loaded ${o?o.length:0} options from ${t}`);e.removeAllItems();if(!a){e.addItem(new sap.ui.core.Item({key:"",text:"- None -"}))}if(o&&o.length>0){o.forEach(t=>{const a=t[r]||`ID: ${t[n]}`;e.addItem(new sap.ui.core.Item({key:t[n],text:a}));console.log(`Added option: ${t[n]} - ${a}`)})}else{console.log(`No items found in ${t}`)}}).catch(e=>{console.error(`Error in Supabase query for ${t}:`,e)})}).catch(e=>{console.error(`Error getting metadata for relation ${t}:`,e)})},_updateDeleteButtonState:function(e){let t=null;const a=this.getView().byId("ObjectPageLayout");if(a){const e=a.getHeaderTitle();if(e){const a=e.getActions()||[];for(let e=0;e<a.length;e++){const o=a[e];if(o.getIcon&&o.getIcon()==="sap-icon://delete"){t=o;break}}}}if(!t){t=this.getView().byId("deleteButton")}if(t){const a=e&&e.length>0;t.setEnabled(!a);if(a){t.setTooltip("Cannot delete while related items exist")}else{t.setTooltip("Delete this entity")}}},_updateDeleteButtonState:function(e){const t=this.getView().byId("ObjectPageLayout");if(t){const a=t.getHeaderTitle();if(a){const t=a.getActions()||[];for(let a=0;a<t.length;a++){const o=t[a];if(o.getIcon&&o.getIcon()==="sap-icon://delete"){const t=e&&e.length>0;o.setEnabled(!t);if(t){o.setTooltip("Cannot delete while related items exist")}else{o.setTooltip("Delete this entity")}break}}}}}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityForm.utils.controller", ["sap/ui/core/mvc/ControllerExtension","sap/m/Text","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/ComboBox","sap/ui/core/Item"],function(e,t,a,r,o,i,n,l){"use strict";return e.extend("com.supabase.easyui5.controller.EntityFormUtils",{loadRelationOptions:function(e,t,a){console.log(`Loading relation options for ${a} from table ${t}`);this.getTableMetadata(t).then(a=>{console.log(`Metadata for related table ${t}:`,JSON.stringify(a,null,2));const r=a.primaryKey;const o=a.titleField||r;console.log(`Primary Key: ${r}, Title Field: ${o}`);this.getSupabaseClient().from(t).select("*").then(({data:t,error:a})=>{if(a){console.error("Error loading relation options",a);return}console.log(`Loaded ${t?t.length:0} relation options`);e.removeAllItems();if(t){t.forEach(t=>{const a=new l({key:t[r],text:t[o]});e.addItem(a);console.log(`Added item: Key=${t[r]}, Text=${t[o]}`)})}})})},createInputField:function(e,l,s,d,u){let c;switch(e.type){case"relation":if(u){c=new t({id:d,text:`Connected to parent ${this.getModel("viewModel").getProperty("/parentInfo/parentTable")} (ID: ${this.getModel("viewModel").getProperty("/parentInfo/parentId")})`})}else{c=new n({id:d,selectedKey:{path:l},width:"100%",required:s,showSecondaryValues:true,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",selectionChange:function(t){t.getSource().setValueState("None");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};if(r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}.bind(this)});this.loadRelationOptions(c,e.relation,e.name)}break;case"boolean":c=new o({id:d,selected:{path:l},width:"100%",select:function(t){const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors");if(r&&r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}.bind(this)});break;case"date":c=new i({id:d,value:{path:l,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",change:function(t){if(t.getParameter("valid")){t.getSource().setValueState("None");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors");if(r&&r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}else{t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid date");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};r[e.name]="Please enter a valid date";a.setProperty("/validationErrors",r)}}.bind(this)});break;case"number":c=new a({id:d,value:{path:l,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=this.getModel("viewModel");const o=r.getProperty("/validationErrors")||{};if(a&&isNaN(parseFloat(a))){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid number");o[e.name]="Please enter a valid number";r.setProperty("/validationErrors",o)}else{t.getSource().setValueState("None");if(o[e.name]){delete o[e.name];r.setProperty("/validationErrors",o)}}}.bind(this)});break;case"email":c=new a({id:d,value:{path:l},type:"Email",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const o=this.getModel("viewModel");const i=o.getProperty("/validationErrors")||{};if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid email address");i[e.name]="Please enter a valid email address";o.setProperty("/validationErrors",i)}else{t.getSource().setValueState("None");if(i[e.name]){delete i[e.name];o.setProperty("/validationErrors",i)}}}.bind(this)});break;case"url":c=new a({id:d,value:{path:l},type:"Url",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^(http|https):\/\/[^ "]+$/;const o=this.getModel("viewModel");const i=o.getProperty("/validationErrors")||{};if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid URL (starting with http:// or https://)");i[e.name]="Please enter a valid URL (starting with http:// or https://)";o.setProperty("/validationErrors",i)}else{t.getSource().setValueState("None");if(i[e.name]){delete i[e.name];o.setProperty("/validationErrors",i)}}}.bind(this)});break;case"text":c=new r({id:d,value:{path:l},rows:3,width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;default:c=new a({id:d,value:{path:l},width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"})}if(c.setId){c.setId(this.getView().createId(e.name+"Input"))}return c},createFieldChangeHandler:function(e){return function(t){if(t.getSource().setValueState){t.getSource().setValueState("None")}this.clearFieldError(e.name)}.bind(this)},setFieldError:function(e,t){const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};r[e]=t;a.setProperty("/validationErrors",r)},clearFieldError:function(e){const t=this.getModel("viewModel");const a=t.getProperty("/validationErrors")||{};if(a[e]){delete a[e];t.setProperty("/validationErrors",a)}},createDisplayField:function(e,a){let r;switch(e.type){case"relation":const o=a[e.name+"_text"]||a[e.name];r=new t({text:o||""});break;case"boolean":r=new t({text:a[e.name]?"Yes":"No"});break;case"date":r=new t({text:a[e.name]?new Date(a[e.name]).toLocaleDateString():""});break;case"number":r=new t({text:a[e.name]!==undefined?parseFloat(a[e.name]).toFixed(2):""});break;default:r=new t({text:a[e.name]||""})}return r},initFormFields:function(){this.getView().getController()._formFields=this.getView().getController()._formFields||{}},getEntityDataForSave:function(e,t,a){const r={};if(!e||!t){return r}e.columns.forEach(e=>{if(e.editable===false&&e.name!==a||e.name===a){return}r[e.name]=t[e.name]});if("updated_at"in t){r["updated_at"]=(new Date).toISOString()}return r}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityList.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Column","sap/m/Text","sap/m/Label","sap/m/Input","sap/m/DatePicker","sap/m/CheckBox","sap/m/ComboBox","sap/m/Token","sap/m/Dialog","sap/m/List","sap/m/StandardListItem","sap/ui/core/Item","sap/ui/layout/form/SimpleForm","sap/m/MessageToast","sap/m/MessageBox","sap/m/Button"],function(e,t,o,n,r,i,a,s,l,c,d,h,u,m,f,p,g,y){"use strict";return e.extend("com.supabase.easyui5.controller.EntityList",{_isAdjustingWidths:false,onInit:function(){const e=new t({tableName:"",tableId:"",items:[],allItems:[],busy:false,visibleColumns:[],availableColumns:[],filterCriteria:{},filterInfo:""});this.setModel(e,"viewModel");this.getRouter().getRoute("entityList").attachPatternMatched(this._onRouteMatched,this);this.getView().addEventDelegate({onAfterRendering:function(){setTimeout(this._forceColumnWidths.bind(this),500)}.bind(this)},this)},onAfterRendering:function(){try{var e=this.byId("entityTable");if(!e){return}var t=this.getModel("viewModel");if(!t){console.log("View model not available yet in onAfterRendering");return}try{var o=t.getProperty("/visibleColumns")||[];if(o.length>5){this._createTopScrollContainer(o.length);setTimeout(this._forceColumnWidths.bind(this),300)}var n=this.byId("dynamicPageId");if(n){n.setHeaderExpanded(false)}}catch(e){console.log("Could not access view model properties:",e)}}catch(e){console.error("Error in onAfterRendering:",e)}},onToggleNav:function(){try{const e=sap.ui.getCore().byId("content");let t=null;if(this.getOwnerComponent()&&this.getOwnerComponent().getSplitApp){t=this.getOwnerComponent().getSplitApp()}if(!t&&this.getOwnerComponent()&&this.getOwnerComponent().getRootControl){const e=this.getOwnerComponent().getRootControl();if(e){t=e.byId("app")}}if(!t){t=sap.ui.getCore().byId("__component0---app");if(!t){t=sap.ui.getCore().byId("__xmlview0--app")}}if(!t){const e=sap.ui.getCore().byFieldGroupId("").filter(function(e){return e instanceof sap.m.SplitApp});if(e.length>0){t=e[0]}}if(!t){console.error("SplitApp control not found!");return}const o=this.getOwnerComponent().getModel("appView");if(!o){console.error("AppView model not found!");return}const n=o.getProperty("/navExpanded");const r=this.getView().byId("navToggleButton");console.log("Entity List toggle nav button pressed. Current state:",n?"expanded":"collapsed");if(n){if(sap.ui.Device.system.phone){t.hideMaster()}else{const e=t.getMode();if(e!=="HideMode"&&e!=="ShowHideMode"){t.setMode("ShowHideMode")}t.hideMaster()}if(r){r.setIcon("sap-icon://menu2");r.setTooltip("Show Navigation")}o.setProperty("/navExpanded",false)}else{if(sap.ui.Device.system.phone){t.showMaster()}else{t.setMode("ShowHideMode");t.showMaster()}if(r){r.setIcon("sap-icon://navigation-left-arrow");r.setTooltip("Hide Navigation")}o.setProperty("/navExpanded",true)}}catch(e){console.error("Error in menu toggle:",e)}},_onRouteMatched:function(e){console.log("1. _onRouteMatched started");const t=e.getParameter("arguments").table;console.log("2. Table ID:",t);const o=this.getModel("viewModel");console.log("3. ViewModel:",o?"available":"not available");o.setProperty("/filterCriteria",{});o.setProperty("/visibleColumns",[]);o.setProperty("/availableColumns",[]);o.setProperty("/filterInfo","");const n=t.charAt(0).toUpperCase()+t.slice(1).replace(/_/g," ");o.setProperty("/tableName",n);o.setProperty("/tableId",t);this.getView().byId("entityListPage").setTitle(n+" List");try{const e=this.getView().byId("dynamicPageId");if(e){e.setHeaderExpanded(false)}}catch(e){console.error("Error setting header state:",e)}console.log("4. About to call getTableMetadata");this.getTableMetadata(t).then(e=>{console.log("5. Metadata received:",e);this._tableMetadata=e;this._configureSearchForm(e);this._configureTable(e);console.log("6. About to call _loadData");this._loadData(t,e)}).catch(e=>{console.error("Error loading metadata:",e);g.error("Failed to load table metadata: "+e.message)})},_configureSearchForm:function(e){const t=this.getView().byId("searchForm");t.removeAllContent();e.columns.forEach(e=>{if(!e.visible||e.name==="created_at"||e.name==="updated_at"){return}t.addContent(new r({text:e.label,tooltip:"Search by "+e.label}));let o;switch(e.type){case"date":o=new a({valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%"});break;case"boolean":o=new l({width:"100%",items:[new m({key:"",text:"All"}),new m({key:"true",text:"Yes"}),new m({key:"false",text:"No"})]});break;case"relation":o=new l({width:"100%",showSecondaryValues:true});this._loadRelationOptions(o,e.relation,e.name);break;default:o=new i({width:"100%"})}o.data("columnName",e.name);o.data("columnType",e.type);t.addContent(o)})},_configureTable:function(e){const t=this.getView().byId("entityTable");const o=this.getModel("viewModel");t.setFixedLayout(true);t.setSticky(["ColumnHeaders"]);t.removeAllColumns();const n=e.columns.filter(e=>e.visible).slice(0,7);o.setProperty("/visibleColumns",n);const r=e.columns.filter(e=>e.visible);o.setProperty("/availableColumns",r);if(!document.getElementById("fixedTableStyles")){var i=document.createElement("style");i.id="fixedTableStyles";i.innerHTML=`\n                    .sapMListTblHeader {\n                        position: sticky !important;\n                        top: 0 !important;\n                        z-index: 100 !important;\n                        background-color: #f7f7f7 !important;\n                    }\n                    \n                    .fixedWidthTable {\n                        overflow-x: auto !important;\n                    }\n                    \n                    .fixedWidthTable table {\n                        table-layout: fixed !important;\n                    }\n                    \n                    .sapMListTblCell {\n                        padding-left: 4px !important;\n                        padding-right: 4px !important;\n                    }\n                `;document.head.appendChild(i)}setTimeout(function(){var e=t.$().parent();if(e.length){e.addClass("fixedWidthTable")}},100);n.forEach((e,o)=>{let n="8rem";switch(e.type){case"boolean":n="5rem";break;case"date":n="8rem";break;case"number":n="7rem";break;case"relation":n="10rem";break;default:if(o===0)n="10rem";else if(o===1)n="12rem";else n="9rem"}const r=new sap.m.Column({header:new sap.m.Label({text:e.label,design:"Bold"}),width:n,hAlign:e.type==="number"?"End":"Begin",demandPopin:true,minScreenWidth:"Tablet"});r.data("columnName",e.name);r.data("columnType",e.type);t.addColumn(r)});var a=new sap.m.ColumnListItem({type:"Navigation",press:this.onItemPress.bind(this)});n.forEach(function(e){var t;switch(e.type){case"date":t=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:function(e){if(!e)return"";return new Date(e).toLocaleDateString()}}});break;case"boolean":t=new sap.m.Text({text:{path:"viewModel>"+e.name,formatter:function(e){return e?"Yes":"No"}}});break;case"relation":t=new sap.m.Text({text:{path:"viewModel>"+e.name+"_text"}});break;default:t=new sap.m.Text({text:"{viewModel>"+e.name+"}"})}a.addCell(t)});t.bindItems({path:"viewModel>/items",template:a,templateShareable:false})},_populateRelationComboBox:function(e,t,o,n){if(!e)return;e.removeAllItems();e.addItem(new sap.ui.core.Item({key:"",text:"All"}));if(t&&t.length>0){t.forEach(t=>{e.addItem(new sap.ui.core.Item({key:t[o],text:t[n]||t[o]}))})}},_loadRelationOptions:function(e,t,o){if(this._relationCache&&this._relationCache[t]){const o=this._relationCache[t];this._populateRelationComboBox(e,o.items,o.metadata.primaryKey,o.metadata.titleField);return}this.getTableMetadata(t).then(n=>{const r=n.primaryKey;const i=n.titleField||r;this.getSupabaseClient().from(t).select(`${r}, ${i}`).then(({data:a,error:s})=>{if(s){console.error(`Error loading relation options for ${o}:`,s);return}if(!this._relationCache){this._relationCache={}}this._relationCache[t]={items:a,metadata:n,lookup:a.reduce((e,t)=>{e[t[r]]=t[i];return e},{})};this._populateRelationComboBox(e,a,r,i)}).catch(e=>{console.error(`Error in Supabase query for relation options:`,e)})}).catch(e=>{console.error(`Error getting metadata for relation ${t}:`,e)})},onColumnsButtonPress:function(){const e=this.getModel("viewModel");const o=e.getProperty("/availableColumns");const n=e.getProperty("/visibleColumns");if(!this._oColumnDialog){this._oColumnDialog=new d({title:"Select Columns",contentWidth:"400px",content:new h({mode:"MultiSelect",includeItemInSelection:true,items:{path:"columns>/",template:new u({title:"{columns>label}",description:"{columns>name}",type:"Active",selected:{path:"columns>visible",formatter:function(e){return e===true}}})}}),beginButton:new y({text:"Apply",type:"Emphasized",press:function(){const t=this._oColumnDialog.getContent()[0];const o=t.getSelectedItems();const n=o.map(e=>{const t=e.getBindingContext("columns").getPath();return this._oColumnDialog.getModel("columns").getProperty(t)});e.setProperty("/visibleColumns",n);this._reconfigureTable(n);this._oColumnDialog.close();setTimeout(this._forceColumnWidths.bind(this),100);setTimeout(this._forceColumnWidths.bind(this),500);setTimeout(this._forceColumnWidths.bind(this),1e3)}.bind(this)}),endButton:new y({text:"Cancel",press:function(){this._oColumnDialog.close()}.bind(this)})});this.getView().addDependent(this._oColumnDialog)}const r=o.map(e=>({name:e.name,label:e.label,type:e.type,visible:n.some(t=>t.name===e.name)}));this._oColumnDialog.setModel(new t(r),"columns");this._oColumnDialog.open()},_reconfigureTableWithFixedWidths:function(e){const t=this.getView().byId("entityTable");t.setWidth("100%");t.removeAllColumns();let i=t.getBindingInfo("items")&&t.getBindingInfo("items").template;if(!i){i=new sap.m.ColumnListItem({type:"Navigation",press:this.onItemPress.bind(this)})}else{i.removeAllCells()}const a=Math.max(jQuery(t.getDomRef()).width(),800);const s=Math.floor(a/(e.length||1));const l=80;console.log("Table width:",a,"Average column width:",s);let c=0;e.forEach((e,a)=>{let s;switch(e.type){case"boolean":s=5;break;case"date":s=8;break;case"number":case"integer":s=7;break;case"email":case"url":s=10;break;case"relation":s=8;break;default:if(a===0){s=8}else if(a===1){s=10}else if(a===2){s=10}else{s=7}}if(e.name){const t=e.name.toLowerCase();if(t.includes("id")&&t!=="id"){s=6}else if(t==="id"){s=5}else if(t.includes("code")||t.includes("status")){s=6}}c+=s;const l=s+"rem";const d=new o({header:new r({text:e.label,design:"Bold"}),width:l,minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"Inline",hAlign:e.type==="number"||e.type==="integer"?"End":"Begin"});d.data("columnName",e.name);d.data("columnType",e.type);t.addColumn(d);let h;switch(e.type){case"date":h=new n({text:{path:"viewModel>"+e.name,formatter:function(e){if(!e){return""}return new Date(e).toLocaleDateString()}},wrapping:false});break;case"boolean":h=new n({text:{path:"viewModel>"+e.name,formatter:function(e){return e?"Yes":"No"}},wrapping:false});break;case"relation":h=new n({text:{path:"viewModel>"+e.name+"_text"},wrapping:false});break;case"number":h=new n({text:{path:"viewModel>"+e.name,formatter:function(e){if(e===undefined||e===null)return"";return parseFloat(e).toFixed(2)}},wrapping:false});break;default:h=new n({text:"{viewModel>"+e.name+"}",wrapping:false,maxLines:1})}i.addCell(h)});console.log("Total allocated width (rem):",c);const d=t.getBinding("items");if(d){d.getTemplate=function(){return i};t.invalidate()}else{t.bindItems({path:"viewModel>/items",template:i})}setTimeout(function(){this._createFixedWidthScrollContainer(c)}.bind(this),100)},_createFixedScrollContainer:function(e){try{var t=this.byId("entityTable");if(!t)return;var o=t.$().parent();if(!o.length)return;jQuery(".tableScrollContainer").remove();var n=document.createElement("div");n.className="tableScrollContainer";n.style.width="100%";n.style.overflowX="auto";n.style.position="sticky";n.style.top="0";n.style.zIndex="99";n.style.backgroundColor="#fff";n.style.borderBottom="1px solid #e5e5e5";n.style.padding="4px 0";var r=parseFloat(getComputedStyle(document.documentElement).fontSize);var i=Math.max(e*r,o.width());var a=document.createElement("div");a.style.width=i+"px";a.style.height="16px";n.appendChild(a);o.prepend(n);var s=t.$().find("table");if(s.length){s.css({"min-width":i+"px",width:i+"px","table-layout":"fixed"})}if(!document.getElementById("fixedScrollStyles")){var l=document.createElement("style");l.id="fixedScrollStyles";l.innerHTML=`\n                        .tableScrollContainer::-webkit-scrollbar {\n                            height: 8px;\n                            background-color: #f5f5f5;\n                        }\n                        \n                        .tableScrollContainer::-webkit-scrollbar-thumb {\n                            border-radius: 4px;\n                            background-color: #999;\n                        }\n                        \n                        .tableScrollContainer::-webkit-scrollbar-thumb:hover {\n                            background-color: #777;\n                        }\n                        \n                        .tableScrollContainer {\n                            scrollbar-width: thin;\n                            scrollbar-color: #999 #f5f5f5;\n                        }\n                        \n                        .sapMListTblHeader {\n                            position: sticky !important;\n                            top: 28px !important; \n                            z-index: 98 !important;\n                        }\n                    `;document.head.appendChild(l)}n.addEventListener("scroll",function(){var e=t.$().find(".sapMListTblCnt");if(e.length){e.scrollLeft(this.scrollLeft)}});t.$().find(".sapMListTblCnt").on("scroll",function(){n.scrollLeft=this.scrollLeft});console.log("Fixed scroll container created")}catch(e){console.error("Error creating fixed scroll container:",e)}},_reconfigureTable:function(e){const t=this.getView().byId("entityTable");t.removeAllColumns();let i=t.getBindingInfo("items")&&t.getBindingInfo("items").template;if(!i){i=new sap.m.ColumnListItem({type:"Navigation",press:this.onItemPress.bind(this)})}else{i.removeAllCells()}e.forEach((e,a)=>{let s=this._getOptimizedColumnWidth(e.type,a,e.name);const l=new o({header:new r({text:e.label,design:"Bold"}),width:s,minScreenWidth:"Tablet",demandPopin:true,popinDisplay:"Inline",hAlign:e.type==="number"||e.type==="integer"?"End":"Begin"});l.data("columnName",e.name);l.data("columnType",e.type);t.addColumn(l);let c;switch(e.type){case"date":c=new n({text:{path:"viewModel>"+e.name,formatter:function(e){if(!e){return""}return new Date(e).toLocaleDateString()}},wrapping:false});break;case"boolean":c=new n({text:{path:"viewModel>"+e.name,formatter:function(e){return e?"Yes":"No"}},wrapping:false});break;case"relation":c=new n({text:{path:"viewModel>"+e.name+"_text"},wrapping:false});break;case"number":c=new n({text:{path:"viewModel>"+e.name,formatter:function(e){if(e===undefined||e===null)return"";return parseFloat(e).toFixed(2)}},wrapping:false});break;default:c=new n({text:"{viewModel>"+e.name+"}",wrapping:false,maxLines:2})}c.addStyleClass("sapUiTinyMarginBeginEnd");i.addCell(c)});const a=t.getBinding("items");if(a){a.getTemplate=function(){return i};t.invalidate()}else{t.bindItems({path:"viewModel>/items",template:i})}if(e.length>5){setTimeout(function(){this._createTopScrollContainer(e.length*6)}.bind(this),300)}},onServerSearchPress:function(){try{var e=this.getView().byId("dynamicPageId");if(e){e.setHeaderExpanded(true);p.show("Server search activated - use form to search database")}}catch(e){console.error("Error in server search button handler:",e);p.show("Could not activate server search form")}},onResetSearch:function(){const e=this.getView().byId("searchForm");const t=e.getContent();for(let e=0;e<t.length;e++){const o=t[e];if(o instanceof r){continue}if(o instanceof l){o.setSelectedKey("")}else if(o instanceof s){o.setSelected(false)}else if(o instanceof a){o.setValue("")}else{o.setValue("")}}const o=this.getModel("viewModel");o.setProperty("/filterCriteria",{});o.setProperty("/filterInfo","");o.setProperty("/items",o.getProperty("/allItems"));const n=o.getProperty("/items");const i=n.length+" "+(n.length===1?"item":"items");this.getView().byId("tableCountText").setText(i);p.show("Search criteria reset. Showing all records.");const c=o.getProperty("/visibleColumns")||[];if(c.length>5){setTimeout(function(){this._createTopScrollContainer(c.length*12)}.bind(this),300)}},onSearch:function(e){const t=e.getParameter("query").toLowerCase();const o=this.getModel("viewModel");const n=[...o.getProperty("/allItems")];if(!t){o.setProperty("/items",n);o.setProperty("/filterInfo","");const e=n.length+" "+(n.length===1?"item":"items");this.getView().byId("tableCountText").setText(e);return}const r=n.filter(e=>JSON.stringify(e).toLowerCase().includes(t));o.setProperty("/items",r);o.setProperty("/filterInfo","Table search for: "+t);const i=r.length+" "+(r.length===1?"item":"items")+" (filtered)";this.getView().byId("tableCountText").setText(i);const a=o.getProperty("/visibleColumns")||[];if(a.length>5){setTimeout(function(){this._createTopScrollContainer(a.length*12)}.bind(this),300)}},onItemPress:function(e){const t=e.getSource();const o=t.getBindingContext("viewModel");if(!o){console.error("No binding context found");return}const n=o.getObject();const r=this.getModel("viewModel");const i=r.getProperty("/tableId");console.log("Item clicked:",n);console.log("Table ID:",i);if(!i){console.error("Table ID is empty. Cannot navigate.");p.show("Navigation error: Cannot determine table");return}this.getTableMetadata(i).then(e=>{const t=e.primaryKey||`${i}_id`;console.log("Primary key field:",t);console.log("Item data keys:",Object.keys(n));const o=n[t];if(o===undefined){console.error("Primary key value is undefined. Cannot navigate.");p.show("Navigation error: Record ID not found");return}console.log("Navigating to detail with ID:",o);try{this.getRouter().navTo("entityDetail",{table:i,id:o},false);console.log("Navigation call completed")}catch(e){console.error("Navigation error:",e);p.show("Navigation error: "+e.message)}}).catch(e=>{console.error("Error getting metadata for navigation:",e);p.show("Navigation error: Could not retrieve table metadata")})},onCreatePress:function(){const e=this.getModel("viewModel").getProperty("/tableId");this.getRouter().navTo("entityCreate",{table:e})},onRefreshPress:function(){const e=this.getModel("viewModel").getProperty("/tableId");const t=this.getModel("viewModel");t.setProperty("/filterCriteria",{});t.setProperty("/filterInfo","");const o=this.getView().byId("searchForm");const n=o.getContent();for(let e=0;e<n.length;e++){const t=n[e];if(t instanceof r){continue}if(t instanceof l){t.setSelectedKey("")}else if(t instanceof s){t.setSelected(false)}else if(t instanceof a){t.setValue("")}else{t.setValue("")}}const i=this.getView().byId("quickSearch");if(i){i.setValue("")}const c=this.getView().byId("tableSearch");if(c){c.setValue("")}this.getTableMetadata(e).then(t=>{this._loadData(e,t)})},onExportPress:function(){const e=this.getModel("viewModel");const t=e.getProperty("/items");const o=e.getProperty("/tableName");if(!t||t.length===0){p.show("No data to export");return}const n=e.getProperty("/visibleColumns");const r=n.map(e=>e.label);const i=n.map(e=>e.name);let a=r.join(",")+"\n";t.forEach(e=>{const t=i.map(t=>{const o=e[t]===undefined?"":e[t];if(typeof o==="string"){return`"${o.replace(/"/g,'""')}"`}else if(o===null){return""}else{return o}});a+=t.join(",")+"\n"});const s=new Blob([a],{type:"text/csv;charset=utf-8"});const l=`${o}_Export_${(new Date).toISOString().split("T")[0]}.csv`;if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(s,l)}else{const e=document.createElement("a");e.href=URL.createObjectURL(s);e.download=l;document.body.appendChild(e);e.click();document.body.removeChild(e)}p.show(`Exported ${t.length} records to ${l}`)},onNavBack:function(){this.navBack()},_createTopScrollContainer:function(e){if(!this._scrollRetryCount){this._scrollRetryCount=0}if(this._scrollContainerInProgress||this._scrollRetryCount>5){if(this._scrollRetryCount>5){console.warn("Maximum scroll container retry attempts reached - giving up");this._scrollRetryCount=0}return}this._scrollContainerInProgress=true;this._scrollRetryCount++;try{var t=this.byId("entityTable");if(!t){console.error("Table control not found");this._scrollContainerInProgress=false;return}var o=t.getDomRef();if(!o){console.log("Table DOM not ready - scheduling retry #"+this._scrollRetryCount);if(this._scrollRetryCount<=5){setTimeout(function(){this._scrollContainerInProgress=false;this._createTopScrollContainer(e)}.bind(this),1e3)}else{console.warn("Maximum retry attempts reached - giving up");this._scrollRetryCount=0;this._scrollContainerInProgress=false}return}this._scrollRetryCount=0;console.log("Creating horizontal scroll container");jQuery(".horizontalScrollWrapper").remove();var n=document.createElement("div");n.className="horizontalScrollWrapper";n.style.width="100%";n.style.overflowX="auto";n.style.position="sticky";n.style.top="0";n.style.zIndex="100";n.style.height="16px";n.style.background="#f5f5f5";n.style.borderRadius="4px";n.style.border="1px solid #e5e5e5";var r=parseInt(getComputedStyle(document.documentElement).fontSize)||16;var i=e*r;var a=document.createElement("div");a.style.width=i+"px";a.style.height="1px";n.appendChild(a);o.parentNode.insertBefore(n,o);var s=t.$().find(".sapMListTbl");if(s.length){s.css({"min-width":i+"px","table-layout":"fixed"})}jQuery(o).css({"overflow-x":"hidden","min-width":"100%"});n.addEventListener("scroll",function(){var e=jQuery(o).find(".sapMListTbl");if(e.length){e.css("margin-left",-this.scrollLeft+"px")}});console.log("Scroll container created successfully")}catch(e){console.error("Error creating scroll container:",e)}finally{setTimeout(function(){this._scrollContainerInProgress=false}.bind(this),300)}},_getOptimizedColumnWidth:function(e,t,o){let n;switch(e){case"boolean":n="5rem";break;case"date":n="8rem";break;case"number":case"integer":n="7rem";break;case"email":case"url":n="12rem";break;case"relation":n="10rem";break;default:if(t===0){n="10rem"}else if(t===1){n="12rem"}else if(t===2){n="12rem"}else{n="9rem"}}if(o){const e=o.toLowerCase();if(e.includes("id")&&e!=="id"){n="6rem"}else if(e==="id"){n="5rem"}else if(e.includes("code")||e.includes("status")){n="6rem"}}return n},_forceColumnWidths:function(){if(this._isAdjustingWidths){console.log("Width adjustment already in progress, skipping");return}try{this._isAdjustingWidths=true;var e=this.byId("entityTable");if(!e)return;var t=e.getColumns();if(!t||t.length===0)return;console.log("Forcing strict column widths for",t.length,"columns");var o="";o+=`\n                    #${e.getId()} table {\n                        table-layout: fixed !important;\n                        width: auto !important;\n                    }\n                    \n                    #${e.getId()} .sapMListTblCell {\n                        padding-left: 4px !important;\n                        padding-right: 4px !important;\n                        overflow: hidden;\n                        text-overflow: ellipsis;\n                        white-space: nowrap;\n                    }\n                `;t.forEach(function(e,t){var n=e.getId();var r=e.data("columnType")||"string";var i=e.data("columnName")||"";var a;switch(r){case"boolean":a="50px";break;case"date":a="80px";break;case"number":case"integer":a="70px";break;case"relation":a="100px";break;default:if(t===0){a="80px"}else if(t===1){a="100px"}else{a="90px"}}if(i){var s=i.toLowerCase();if(s.includes("id")&&s!=="id"){a="60px"}else if(s==="id"){a="50px"}}o+=`\n                        #${n} {\n                            width: ${a} !important;\n                            max-width: ${a} !important;\n                            min-width: 0 !important;\n                        }\n                    `});var n="entityTableColumnStyles";var r=document.getElementById(n);if(!r){r=document.createElement("style");r.id=n;document.head.appendChild(r)}r.innerHTML=o;jQuery("#"+e.getId()).find(".sapMListTbl").css({"table-layout":"fixed",width:"auto"});console.log("Column width styles applied directly to DOM")}catch(e){console.error("Error forcing column widths:",e)}finally{this._isAdjustingWidths=false}},_loadData:function(e,t,o){console.log("_loadData started for table:",e);const n=this.getModel("viewModel");n.setProperty("/busy",true);const r=this.getOwnerComponent().getEntityCacheManager();const i={ignoreCache:o===true};r.getEntityData(e,i,()=>{console.log("Loading fresh data from server for:",e);return new Promise((o,n)=>{const r=this.getSupabaseClient();r.from(e).select("*").then(async({data:e,error:r})=>{if(r){console.error("Error loading data:",r);n(r);return}e=e||[];console.log(`Loaded ${e.length} records from server`);if(t&&t.columns){const e=t.columns.filter(e=>e.type==="relation");if(e.length>0){}}o(e)}).catch(e=>{console.error("Error in Supabase query:",e);n(e)})})}).then(e=>{n.setProperty("/items",e);n.setProperty("/allItems",[...e]);const o=e.length+" "+(e.length===1?"item":"items");this.getView().byId("tableCountText").setText(o);var r=this.byId("entityTable");if(r){var i=r.getBinding("items");if(i){console.log("Refreshing existing table binding");i.refresh(true)}else{console.log("No binding found, table may need configuration");var a=n.getProperty("/visibleColumns")||[];if(a.length>0){this._configureTable(t)}}}}).catch(e=>{console.error("Error loading data:",e);this.showErrorMessage("Error loading data",e)}).finally(()=>{n.setProperty("/busy",false)})},_executeAdvancedSearch:function(e,t){const o=this.getModel("viewModel");o.setProperty("/busy",true);let n=this.getSupabaseClient().from(e).select("*");const r=[];Object.keys(t).forEach(e=>{const o=t[e];const i=o.value;const a=o.type;if(a==="relation"||a==="number"||a==="boolean"){n=n.eq(e,i);r.push(`${e} = ${i}`)}else if(a==="date"){n=n.eq(e,i);r.push(`${e} = ${i}`)}else{n=n.ilike(e,`%${i}%`);r.push(`${e} contains "${i}"`)}});n.then(async({data:e,error:t})=>{if(t){console.error("Error executing search:",t);this.showErrorMessage("Error executing search",t);o.setProperty("/busy",false);return}e=e||[];console.log(`Search returned ${e.length} records`);for(let t=0;t<e.length;t++){for(const o of this._tableMetadata.columns){if(o.type==="relation"&&e[t][o.name]){const n=e[t][o.name];const r=o.relation;try{const i=await this.getTableMetadata(r);const{data:a,error:s}=await this.getSupabaseClient().from(r).select("*").eq(i.primaryKey,n).single();if(!s&&a){e[t][o.name+"_text"]=a[i.titleField]}}catch(e){console.error("Error loading related data",e)}}}}const n=this.getOwnerComponent().getEntityCacheManager();o.setProperty("/items",e);const i=r.length>0?"Filtered by: "+r.join(", "):"";o.setProperty("/filterInfo",i);const a=e.length+" "+(e.length===1?"item":"items")+(r.length>0?" (filtered)":"");this.getView().byId("tableCountText").setText(a);o.setProperty("/busy",false);const s=o.getProperty("/visibleColumns")||[];if(s.length>5){setTimeout(()=>{this._createTopScrollContainer(s.length*6)},300)}}).catch(e=>{console.error("Error in Supabase query:",e);o.setProperty("/busy",false)})},onRefreshPress:function(){const e=this.getModel("viewModel").getProperty("/tableId");const t=this.getModel("viewModel");t.setProperty("/filterCriteria",{});t.setProperty("/filterInfo","");const o=this.getView().byId("searchForm");const n=o.getContent();for(let e=0;e<n.length;e++){const t=n[e];if(t instanceof r){continue}if(t instanceof l){t.setSelectedKey("")}else if(t instanceof s){t.setSelected(false)}else if(t instanceof a){t.setValue("")}else{t.setValue("")}}const i=this.getView().byId("quickSearch");if(i){i.setValue("")}const c=this.getView().byId("tableSearch");if(c){c.setValue("")}const d=this.getOwnerComponent().getEntityCacheManager();d.clearEntityCache(e);this.getTableMetadata(e).then(t=>{this._loadData(e,t,true)});p.show("Refreshing data from server...")},onAdvancedSearch:function(){console.log("Starting advanced search...");const e=this.getView().byId("searchForm");const t=this.getModel("viewModel");const o=t.getProperty("/tableId");console.log("Current table ID:",o);const n={};let i=false;const c=e.getContent();for(let e=0;e<c.length;e++){const t=c[e];if(t instanceof r){continue}const o=t.data("columnName");const d=t.data("columnType");let h;if(t instanceof l){h=t.getSelectedKey()}else if(t instanceof s){h=t.getSelected()?"true":"false"}else if(t instanceof a){h=t.getValue()}else{h=t.getValue()}if(h&&h.trim()!==""){n[o]={value:h,type:d};i=true;console.log(`Added filter: ${o} = ${h} (${d})`)}}const d=this.getOwnerComponent().getEntityCacheManager();if(d){console.log(`Explicitly clearing cache for ${o} before search`);d.clearEntityCache(o);if(d.isCached(o)){console.error(`WARNING: Cache for ${o} was not properly cleared!`)}else{console.log(`Confirmed: Cache for ${o} is now cleared`)}}else{console.error("Cache manager not available!")}if(!i){console.log("No search criteria specified, loading all data from server");t.setProperty("/busy",true);this.getSupabaseClient().from(o).select("*").then(async({data:e,error:n})=>{if(n){console.error("Error loading data:",n);this.showErrorMessage("Error loading data",n);t.setProperty("/busy",false);return}e=e||[];console.log(`Loaded ${e.length} records directly from server`);if(d){console.log(`Explicitly updating cache for ${o} with ${e.length} records`);d.setEntityCache(o,e);if(d.isCached(o)){console.log(`Confirmed: Cache for ${o} has been updated`)}else{console.error(`WARNING: Cache for ${o} was not properly updated!`)}}t.setProperty("/items",e);t.setProperty("/allItems",[...e]);t.setProperty("/filterInfo","");const r=e.length+" "+(e.length===1?"item":"items");this.getView().byId("tableCountText").setText(r);t.setProperty("/busy",false);p.show("Loaded all records from server")}).catch(e=>{console.error("Error loading data:",e);t.setProperty("/busy",false)});return}t.setProperty("/filterCriteria",n);console.log("Executing server search with filters:",Object.keys(n).length);this._executeAdvancedSearch(o,n)},_executeAdvancedSearch:function(e,t){console.log("Starting server search execution for",e);const o=this.getModel("viewModel");o.setProperty("/busy",true);let n=this.getSupabaseClient().from(e).select("*");const r=[];Object.keys(t).forEach(e=>{const o=t[e];const i=o.value;const a=o.type;if(a==="relation"||a==="number"||a==="boolean"){n=n.eq(e,i);r.push(`${e} = ${i}`)}else if(a==="date"){n=n.eq(e,i);r.push(`${e} = ${i}`)}else{n=n.ilike(e,`%${i}%`);r.push(`${e} contains "${i}"`)}});console.log("Executing Supabase query with filters:",r);n.then(async({data:t,error:n})=>{if(n){console.error("Error executing search:",n);this.showErrorMessage("Error executing search",n);o.setProperty("/busy",false);return}t=t||[];console.log(`Search returned ${t.length} records from server`);const i=this.getOwnerComponent().getEntityCacheManager();if(i){console.log(`Explicitly updating cache for ${e} with ${t.length} records from search`);if(i.isCached(e)){console.warn(`Cache for ${e} was not cleared properly. Clearing now.`);i.clearEntityCache(e)}i.setEntityCache(e,t);if(i.isCached(e)){console.log(`Confirmed: Cache for ${e} has been updated with search results`)}else{console.error(`WARNING: Failed to update cache for ${e}!`)}}else{console.error("Cache manager not available during search results processing!")}o.setProperty("/items",t);o.setProperty("/allItems",[...t]);const a=r.length>0?"Filtered by: "+r.join(", "):"";o.setProperty("/filterInfo",a);const s=t.length+" "+(t.length===1?"item":"items")+(r.length>0?" (filtered)":"");this.getView().byId("tableCountText").setText(s);o.setProperty("/busy",false);p.show(`Search complete: Found ${t.length} records`);if(this._scrollTimerId){clearTimeout(this._scrollTimerId)}this._scrollTimerId=setTimeout(()=>{var e=o.getProperty("/visibleColumns")||[];if(e.length>5){this._createTopScrollContainer(e.length*6)}delete this._scrollTimerId},500)}).catch(e=>{console.error("Error in Supabase query:",e);o.setProperty("/busy",false)})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityMetadataProvider.controller", ["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";return e.extend("com.supabase.easyui5.enhanced.EnhancedMetadataProvider",{getEnhancedTableMetadata:function(e){return this.getOwnerComponent().getTableMetadata(e).then(n=>{const t=JSON.parse(JSON.stringify(n));t._enhanced=true;const r=t.primaryKey;if(r==="id"){t.primaryKey=`${e}_id`;const n=t.columns.findIndex(e=>e.name===r);if(n>=0){t.columns[n].name=`${e}_id`;t.columns[n].label=`${e.charAt(0).toUpperCase()+e.slice(1)} ID`}}return t})},getPrimaryKeyValue:function(e,n,t){const r=t?Promise.resolve(t):this.getEnhancedTableMetadata(e);return r.then(t=>{const r=t.primaryKey;const a=t.compositePrimaryKey;const i=[r,a,`${e}_${r}`,"ID","key","uuid"];for(const e of i){if(e&&n[e]!==undefined){return n[e]}}const s=Object.keys(n)[0];return n[s]})},buildPrimaryKeyQuery:function(e,n,t,r){if(!e){return Promise.reject(new Error("Supabase client is required"))}let a=e.from(n).select("*");const i=r?Promise.resolve(r):this.getEnhancedTableMetadata(n);return i.then(e=>{const r=e.primaryKey||`${n}_id`;return a.eq(r,t)})}})});
sap.ui.predefine("com/supabase/easyui5/controller/EntityValidation.controller", ["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";return e.extend("com.supabase.easyui5.controller.EntityValidation",{validateForm:function(e,t){const s={};let a=true;const o=[];this.getView().$().find(".sapMInputBase, .sapMCheckBox").each(function(){const e=this.id;const t=sap.ui.getCore().byId(e);if(t){o.push(t)}});console.log("Found input controls:",o.length);o.forEach(e=>{if(e.setValueState){e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});e.columns.forEach(i=>{if(i.editable===false||i.name===e.primaryKey||i.name==="created_at"||i.name==="updated_at"){return}const n=i.name;const l=t[n];let r=null;for(let e=0;e<o.length;e++){const t=o[e].getId();if(t.endsWith(n+"Input")||t.indexOf(n+"Input")!==-1){r=o[e];break}}if(!r){console.log("Control not found for field:",n)}else{console.log("Found control for field:",n,r.getId())}if(i.required&&(l===undefined||l===null||l==="")){a=false;s[n]="This field is required";if(r&&r.setValueState){r.setValueState("Error");if(r.setValueStateText){r.setValueStateText("This field is required")}}console.log("Required field validation failed:",n)}else if(l!==undefined&&l!==null&&l!==""){let e=true;let t="";switch(i.type){case"number":if(isNaN(parseFloat(l))||!isFinite(l)){e=false;t="Please enter a valid number"}break;case"date":const s=new Date(l);if(isNaN(s.getTime())){e=false;t="Please enter a valid date"}break;case"email":const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!a.test(l)){e=false;t="Please enter a valid email address"}break;case"url":const o=/^(http|https):\/\/[^ "]+$/;if(!o.test(l)){e=false;t="Please enter a valid URL (starting with http:// or https://)"}break}if(!e){a=false;s[n]=t;if(r&&r.setValueState){r.setValueState("Error");if(r.setValueStateText){r.setValueStateText(t)}}console.log("Type validation failed:",n,t)}}});const i=this.getModel("viewModel");if(i){i.setProperty("/validationErrors",s)}console.log("Validation result:",a?"Valid":"Invalid",s);return a},resetFormErrorStates:function(){console.log("Resetting error states on all form fields");const e=[];this.getView().$().find(".sapMInputBase").each(function(){const t=this.id;const s=sap.ui.getCore().byId(t);if(s){e.push(s)}});this.getView().$().find(".sapMCb").each(function(){const t=this.id;const s=sap.ui.getCore().byId(t);if(s){e.push(s)}});this.getView().$().find(".sapMComboBox").each(function(){const t=this.id;const s=sap.ui.getCore().byId(t);if(s){e.push(s)}});console.log("Found",e.length,"controls to reset");e.forEach(e=>{if(e.setValueState){console.log("Resetting value state for",e.getId());e.setValueState("None");if(e.setValueStateText){e.setValueStateText("")}}});const t=this.getModel("viewModel");if(t){t.setProperty("/validationErrors",{})}console.log("Form error states reset complete")}})});
sap.ui.predefine("com/supabase/easyui5/controller/Home.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/Button","sap/m/Text","sap/m/VBox","sap/m/HBox","sap/m/Title","sap/ui/core/Icon","sap/m/Panel","sap/ui/core/CustomData"],function(e,t,o,n,s,a,i,l,r,d,c,p,g){"use strict";return e.extend("com.supabase.easyui5.controller.Home",{onInit:function(){if(!this.getOwnerComponent().getModel("tables")){const e=new t({tables:[{id:"suppliers",title:"Suppliers",icon:"sap-icon://supplier",count:0},{id:"products",title:"Products",icon:"sap-icon://product",count:0},{id:"customers",title:"Customers",icon:"sap-icon://customer",count:0},{id:"orders",title:"Orders",icon:"sap-icon://sales-order",count:0},{id:"order_items",title:"Order Items",icon:"sap-icon://list",count:0}]});this.getOwnerComponent().setModel(e,"tables");console.log("Created fallback tables model")}const e=new t({selectedTab:"all",theme:"sap_horizon",compactDensity:true});this.getView().setModel(e,"settings");this.getView().byId("idIconTabBar").setSelectedKey("all");this._loadTableCounts();this._createCategoryCards()},onToggleNav:function(){try{const e=sap.ui.getCore().byId("content");let t=null;if(this.getOwnerComponent()&&this.getOwnerComponent().getSplitApp){t=this.getOwnerComponent().getSplitApp()}if(!t&&this.getOwnerComponent()&&this.getOwnerComponent().getRootControl){const e=this.getOwnerComponent().getRootControl();if(e){t=e.byId("app")}}if(!t){t=sap.ui.getCore().byId("__component0---app");if(!t){t=sap.ui.getCore().byId("__xmlview0--app")}}if(!t){const e=sap.ui.getCore().byFieldGroupId("").filter(function(e){return e instanceof sap.m.SplitApp});if(e.length>0){t=e[0]}}if(!t){console.error("SplitApp control not found!");return}const o=this.getOwnerComponent().getModel("appView");if(!o){console.error("AppView model not found!");return}const n=o.getProperty("/navExpanded");const s=this.getView().byId("navToggleButton");console.log("Home toggle nav button pressed. Current state:",n?"expanded":"collapsed");if(n){if(sap.ui.Device.system.phone){t.hideMaster()}else{const e=t.getMode();if(e!=="HideMode"&&e!=="ShowHideMode"){t.setMode("ShowHideMode")}t.hideMaster()}if(s){s.setIcon("sap-icon://menu2");s.setTooltip("Show Navigation")}o.setProperty("/navExpanded",false)}else{if(sap.ui.Device.system.phone){t.showMaster()}else{t.setMode("ShowHideMode");t.showMaster()}if(s){s.setIcon("sap-icon://navigation-left-arrow");s.setTooltip("Hide Navigation")}o.setProperty("/navExpanded",true)}}catch(e){console.error("Error in menu toggle:",e)}},_createCategoryCards:function(){const e=this.getView().byId("categoryGrid");const t=this.getOwnerComponent().getModel("tables");const o=t.getProperty("/tables");e.removeAllContent();o.forEach(t=>{const o=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});o.addStyleClass("sapUiSmallMargin");o.addStyleClass("categoryCard");const n=new r;n.addStyleClass("sapUiSmallMargin");n.setAlignItems("Center");const s=new c({src:t.icon,size:"2rem",color:"#0854A0"});s.addStyleClass("sapUiSmallMarginEnd");n.addItem(s);const u=new d({text:t.title,level:"H3"});n.addItem(u);o.setHeaderText(t.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+t.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(t.count>0){const e=new i({text:"Total records: "+t.count});e.addStyleClass("sapUiTinyMarginTop");m.addItem(e)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new a({text:"Open "+t.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:t.id,writeToDom:true}));h.addItem(w);m.addItem(h);o.addContent(m);e.addContent(o)})},_loadTableCounts:function(){const e=setInterval(()=>{if(this.getSupabaseClient()){clearInterval(e);this._updateTableCounts()}},500);setTimeout(()=>{clearInterval(e)},1e4)},_updateTableCounts:function(){const e=this.getOwnerComponent().getModel("tables");const t=e.getProperty("/tables");t.forEach(o=>{this.getSupabaseClient().from(o.id).select("*",{count:"exact",head:true}).then(({count:n,error:s})=>{if(!s){const s=t.findIndex(e=>e.id===o.id);if(s!==-1){const t="/tables/"+s+"/count";e.setProperty(t,n||0)}}}).catch(e=>{console.error("Error getting count for table "+o.id,e)})});setTimeout(()=>{this._createCategoryCards()},1e3)},onCategoryPress:function(e){const t=e.getSource();let o="";const n=t.getCustomData();for(let e=0;e<n.length;e++){if(n[e].getKey()==="table"){o=n[e].getValue();break}}if(o){this.getRouter().navTo("entityList",{table:o})}else{s.show("Could not determine which table to open")}},onTabSelect:function(e){const t=e.getParameter("key");const o=this.getView().getModel("settings");o.setProperty("/selectedTab",t);if(t!=="all"){const e=this.getOwnerComponent().getModel("tables");const o=e.getProperty("/tables");const n=o.find(e=>e.id===t);if(n){s.show("Selected "+n.title+" category")}}},onSearch:function(e){const t=e.getParameter("query")||"";if(t.length>0){const e=this.getOwnerComponent().getModel("tables");const o=e.getProperty("/tables");const n=o.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase()));const u=this.getView().byId("categoryGrid");u.removeAllContent();n.forEach(e=>{const t=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});t.addStyleClass("sapUiSmallMargin");t.addStyleClass("categoryCard");const o=new r;o.addStyleClass("sapUiSmallMargin");o.setAlignItems("Center");const n=new c({src:e.icon,size:"2rem",color:"#0854A0"});n.addStyleClass("sapUiSmallMarginEnd");o.addItem(n);const s=new d({text:e.title,level:"H3"});o.addItem(s);t.setHeaderText(e.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+e.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(e.count>0){const t=new i({text:"Total records: "+e.count});t.addStyleClass("sapUiTinyMarginTop");m.addItem(t)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new a({text:"Open "+e.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:e.id,writeToDom:true}));h.addItem(w);m.addItem(h);t.addContent(m);u.addContent(t)});if(n.length===0){s.show("No tables found matching: "+t)}else{s.show("Found "+n.length+" matching tables")}}else{this._createCategoryCards()}}})});
sap.ui.predefine("com/supabase/easyui5/controller/Main.controller", ["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/Button","sap/m/Text","sap/m/VBox","sap/m/HBox","sap/m/Title","sap/ui/core/Icon","sap/m/Panel","sap/ui/core/CustomData"],function(e,t,s,a,n,o,i,l,r,d,c,p,g){"use strict";return e.extend("com.supabase.easyui5.controller.Main",{onInit:function(){if(!this.getOwnerComponent().getModel("tables")){const e=new t({tables:[{id:"suppliers",title:"Suppliers",icon:"sap-icon://supplier",count:0},{id:"products",title:"Products",icon:"sap-icon://product",count:0},{id:"customers",title:"Customers",icon:"sap-icon://customer",count:0},{id:"orders",title:"Orders",icon:"sap-icon://sales-order",count:0},{id:"order_items",title:"Order Items",icon:"sap-icon://list",count:0}]});this.getOwnerComponent().setModel(e,"tables");console.log("Created fallback tables model")}const e=new t({selectedTab:"all",theme:"sap_horizon",compactDensity:true});this.getView().setModel(e,"settings");this.getView().byId("idIconTabBar").setSelectedKey("all");this._loadTableCounts();this._createCategoryCards()},onToggleNav:function(){const e=this.getOwnerComponent().byId("app");const t=this.getOwnerComponent().getView().getModel("appView");if(e){const s=t?t.getProperty("/navExpanded"):true;if(s){e.hideMaster()}else{e.showMaster()}if(t){t.setProperty("/navExpanded",!s)}}},_createCategoryCards:function(){const e=this.getView().byId("categoryGrid");const t=this.getOwnerComponent().getModel("tables");const s=t.getProperty("/tables");e.removeAllContent();s.forEach(t=>{const s=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});s.addStyleClass("sapUiSmallMargin");s.addStyleClass("categoryCard");const a=new r;a.addStyleClass("sapUiSmallMargin");a.setAlignItems("Center");const n=new c({src:t.icon,size:"2rem",color:"#0854A0"});n.addStyleClass("sapUiSmallMarginEnd");a.addItem(n);const u=new d({text:t.title,level:"H3"});a.addItem(u);s.setHeaderText(t.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+t.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(t.count>0){const e=new i({text:"Total records: "+t.count});e.addStyleClass("sapUiTinyMarginTop");m.addItem(e)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new o({text:"Open "+t.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:t.id,writeToDom:true}));h.addItem(w);m.addItem(h);s.addContent(m);e.addContent(s)})},_loadTableCounts:function(){const e=setInterval(()=>{if(this.getSupabaseClient()){clearInterval(e);this._updateTableCounts()}},500);setTimeout(()=>{clearInterval(e)},1e4)},_updateTableCounts:function(){const e=this.getOwnerComponent().getModel("tables");const t=e.getProperty("/tables");t.forEach(s=>{this.getSupabaseClient().from(s.id).select("*",{count:"exact",head:true}).then(({count:a,error:n})=>{if(!n){const n=t.findIndex(e=>e.id===s.id);if(n!==-1){const t="/tables/"+n+"/count";e.setProperty(t,a||0)}}}).catch(e=>{console.error("Error getting count for table "+s.id,e)})});setTimeout(()=>{this._createCategoryCards()},1e3)},onCategoryPress:function(e){const t=e.getSource();let s="";const a=t.getCustomData();for(let e=0;e<a.length;e++){if(a[e].getKey()==="table"){s=a[e].getValue();break}}if(s){this.getRouter().navTo("entityList",{table:s})}else{n.show("Could not determine which table to open")}},onTabSelect:function(e){const t=e.getParameter("key");const s=this.getView().getModel("settings");s.setProperty("/selectedTab",t);if(t!=="all"){const e=this.getOwnerComponent().getModel("tables");const s=e.getProperty("/tables");const a=s.find(e=>e.id===t);if(a){n.show("Selected "+a.title+" category")}}},onSearch:function(e){const t=e.getParameter("query")||"";if(t.length>0){const e=this.getOwnerComponent().getModel("tables");const s=e.getProperty("/tables");const a=s.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase()));const u=this.getView().byId("categoryGrid");u.removeAllContent();a.forEach(e=>{const t=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});t.addStyleClass("sapUiSmallMargin");t.addStyleClass("categoryCard");const s=new r;s.addStyleClass("sapUiSmallMargin");s.setAlignItems("Center");const a=new c({src:e.icon,size:"2rem",color:"#0854A0"});a.addStyleClass("sapUiSmallMarginEnd");s.addItem(a);const n=new d({text:e.title,level:"H3"});s.addItem(n);t.setHeaderText(e.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+e.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(e.count>0){const t=new i({text:"Total records: "+e.count});t.addStyleClass("sapUiTinyMarginTop");m.addItem(t)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new o({text:"Open "+e.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:e.id,writeToDom:true}));h.addItem(w);m.addItem(h);t.addContent(m);u.addContent(t)});if(a.length===0){n.show("No tables found matching: "+t)}else{n.show("Found "+a.length+" matching tables")}}else{this._createCategoryCards()}}})});
sap.ui.predefine("com/supabase/easyui5/controller/NotFound.controller", ["com/supabase/easyui5/controller/BaseController"],function(e){"use strict";return e.extend("com.supabase.easyui5.controller.NotFound",{onNavBack:function(){this.getRouter().navTo("home")}})});
sap.ui.predefine("com/supabase/easyui5/flexibilityServices-none", [],function(){"use strict";sap.ui.require.predefine("sap/ui/fl/FlexConfiguration",["sap/ui/fl/registry/Settings"],function(i){return{getFlexibilityServices:function(){return false},isFlexibilityAdaptationEnabled:function(){return false},isFlexibilityEnabled:function(){return false}}});return{}});
sap.ui.predefine("com/supabase/easyui5/model/EntityCacheManager", ["sap/ui/base/Object","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("com.supabase.easyui5.model.EntityCacheManager",{constructor:function(){this._entityCache={};this._cacheMetadata={};this._defaultSettings={enabled:true,maxAgeSeconds:300,enforceMaxAge:false}},isCached:function(e,t){t=t||{};const a=t.ignoreCache||false;if(a){return false}return!!this._entityCache[e]},getEntityData:function(e,t,a){t=t||{};const n=t.ignoreCache||false;const c=!n&&this.isCached(e);if(c){console.log(`Using cached data for ${e}`);return Promise.resolve(this._entityCache[e])}else{console.log(`Loading fresh data for ${e}`);if(typeof a!=="function"){return Promise.reject(new Error("Load callback function is required when data is not cached"))}return a().then(t=>{this.setEntityCache(e,t);return t})}},setEntityCache:function(e,t,a){this._entityCache[e]=t;this._cacheMetadata[e]={timestamp:(new Date).getTime(),count:Array.isArray(t)?t.length:t?1:0,lastUpdated:(new Date).toLocaleString()};console.log(`Updated cache for ${e} with ${this._cacheMetadata[e].count} records`)},clearEntityCache:function(e){if(this._entityCache[e]){delete this._entityCache[e];delete this._cacheMetadata[e];console.log(`Cleared cache for ${e}`)}},clearAllCache:function(){this._entityCache={};this._cacheMetadata={};console.log("Cleared all entity caches")},getCacheStats:function(){const e={entityCount:Object.keys(this._entityCache).length,entities:{}};Object.keys(this._cacheMetadata).forEach(t=>{const a=this._cacheMetadata[t];const n=((new Date).getTime()-a.timestamp)/1e3;e.entities[t]={recordCount:a.count,ageSeconds:Math.round(n),lastUpdated:a.lastUpdated}});return e}})});
sap.ui.predefine("com/supabase/easyui5/model/formatter", function(){"use strict";return{formatValue:function(e){return e&&e.toUpperCase()}}});
sap.ui.predefine("com/supabase/easyui5/model/models", ["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){const i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
sap.ui.predefine("com/supabase/easyui5/service/EnhancedDataService", ["sap/ui/base/Object","sap/ui/model/json/JSONModel"],function(t,e){"use strict";return t.extend("com.supabase.easyui5.service.EnhancedDataService",{constructor:function(e,a){t.call(this);this._oSupabaseClient=e;this._oMetadataProvider=a;this._mMetadataCache={};this._mRelationCache={};this._mEntityCache={};this._iCacheDuration=5*60*1e3},setCacheDuration:function(t){this._iCacheDuration=t},getMetadata:function(t){const e=this._mMetadataCache[t];if(e&&Date.now()-e.timestamp<this._iCacheDuration){return Promise.resolve(e.data)}return this._oMetadataProvider.getEnhancedTableMetadata(t).then(e=>{this._mMetadataCache[t]={data:e,timestamp:Date.now()};return e})},getRelationOptions:function(t,e,a){const i=`${t}_${e}_${a}`;const n=this._mRelationCache[i];if(n&&Date.now()-n.timestamp<this._iCacheDuration){return Promise.resolve(n.data)}return this._oSupabaseClient.from(t).select("*").then(({data:t,error:n})=>{if(n){return Promise.reject(n)}const r=(t||[]).map(t=>({key:t[e],text:t[a]||t[e]}));this._mRelationCache[i]={data:r,timestamp:Date.now()};return r})},getEntityById:function(t,e){const a=`${t}_${e}`;const i=this._mEntityCache[a];if(i&&Date.now()-i.timestamp<this._iCacheDuration){return Promise.resolve(i.data)}return this.getMetadata(t).then(a=>this._oMetadataProvider.buildPrimaryKeyQuery(this._oSupabaseClient,t,e,a)).then(t=>t.single()).then(({data:t,error:e})=>{if(e){return Promise.reject(e)}if(!t){return Promise.reject(new Error("Entity not found"))}this._mEntityCache[a]={data:t,timestamp:Date.now()};return t})},listEntities:function(t,e){const a=e?JSON.stringify(e):"";const i=`${t}_list_${a}`;const n=this._mEntityCache[i];if(n&&Date.now()-n.timestamp<this._iCacheDuration){return Promise.resolve(n.data)}let r=this._oSupabaseClient.from(t).select("*");if(e){Object.keys(e).forEach(t=>{const a=e[t];if(a!==undefined&&a!==null){r=r.eq(t,a)}})}return r.then(({data:t,error:e})=>{if(e){return Promise.reject(e)}this._mEntityCache[i]={data:t||[],timestamp:Date.now()};return t||[]})},createEntity:function(t,e){return this._oSupabaseClient.from(t).insert(e).select().then(({data:e,error:a})=>{if(a){return Promise.reject(a)}this._invalidateListCache(t);return e&&e.length>0?e[0]:null})},updateEntity:function(t,e,a){return this.getMetadata(t).then(i=>{const n=this._oMetadataProvider.buildPrimaryKeyQuery(this._oSupabaseClient,t,e,i);return n.update(a).select()}).then(({data:a,error:i})=>{if(i){return Promise.reject(i)}const n=`${t}_${e}`;delete this._mEntityCache[n];this._invalidateListCache(t);return a&&a.length>0?a[0]:null})},deleteEntity:function(t,e){return this.getMetadata(t).then(a=>{const i=this._oMetadataProvider.buildPrimaryKeyQuery(this._oSupabaseClient,t,e,a);return i.delete()}).then(({error:a})=>{if(a){return Promise.reject(a)}const i=`${t}_${e}`;delete this._mEntityCache[i];this._invalidateListCache(t);return true})},_invalidateListCache:function(t){Object.keys(this._mEntityCache).forEach(e=>{if(e.startsWith(`${t}_list_`)){delete this._mEntityCache[e]}})},clearCaches:function(){this._mMetadataCache={};this._mRelationCache={};this._mEntityCache={}}})});
sap.ui.predefine("com/supabase/easyui5/service/SchemaDetectionService", ["sap/ui/base/Object"],function(e){"use strict";return e.extend("com.supabase.easyui5.service.SchemaDetectionService",{constructor:function(t){e.call(this);this._oSupabaseClient=t;this._mSchemaCache={}},detectSchema:function(e){if(this._mSchemaCache[e]){return Promise.resolve(this._mSchemaCache[e])}return this._fetchSampleData(e).then(t=>{if(!t||t.length===0){return this._fetchTableDefinition(e)}const i=this._detectSchemaFromSample(e,t);this._mSchemaCache[e]=i;return i})},_fetchSampleData:function(e){return this._oSupabaseClient.from(e).select("*").limit(10).then(({data:e,error:t})=>{if(t){console.error("Error fetching sample data:",t);return[]}return e||[]}).catch(e=>{console.error("Error in Supabase query:",e);return[]})},_fetchTableDefinition:function(e){const t=this._createDefaultSchema(e);this._mSchemaCache[e]=t;return Promise.resolve(t)},_detectSchemaFromSample:function(e,t){const i={primaryKey:null,titleField:null,subtitleField:null,columns:[],relations:[]};if(!t||t.length===0){return this._createDefaultSchema(e)}const r=t[0];const n=Object.keys(r);const s=["id",`${e}_id`,"uuid","key","code"];for(const e of s){if(n.includes(e)){i.primaryKey=e;break}}if(!i.primaryKey&&n.length>0){i.primaryKey=n[0]}const a=["name","title","label","description","summary"];for(const e of a){if(n.includes(e)){i.titleField=e;break}}if(!i.titleField){i.titleField=i.primaryKey}const l=["description","summary","subtitle","details","status"];for(const e of l){if(n.includes(e)&&e!==i.titleField){i.subtitleField=e;break}}n.forEach(r=>{const n=t.map(e=>e[r]).filter(e=>e!==null&&e!==undefined);const s=this._detectColumnProperties(r,n,e);i.columns.push(s);if(this._isLikelyRelationField(r,n)){const t=this._detectRelatedTable(r);if(t&&t!==e){s.type="relation";s.relation=t;i.relations.push({table:t,foreignKey:r})}}});this._mSchemaCache[e]=i;return i},_detectColumnProperties:function(e,t,i){const r={name:e,label:this._generateLabel(e),type:"string",visible:true,editable:true,required:false};if(!t||t.length===0){return r}if(this._matchesPattern(e,["id",`${i}_id`,"code","uuid"])){r.editable=false;r.required=false}else if(this._matchesPattern(e,["created_at","created","creation_date"])){r.type="date";r.editable=false;r.required=false}else if(this._matchesPattern(e,["updated_at","modified","modified_date"])){r.type="date";r.editable=false;r.required=false}else if(this._matchesPattern(e,["name","title"])){r.type="string";r.required=true}else if(this._matchesPattern(e,["description","details","notes"])){r.type="text"}else if(this._matchesPattern(e,["email"])){r.type="email"}else if(this._matchesPattern(e,["url","website","link"])){r.type="url"}else if(this._matchesPattern(e,["phone","telephone","mobile"])){r.type="phone"}else if(this._matchesPattern(e,["password","pwd"])){r.type="password"}else if(this._matchesPattern(e,["color","colour"])){r.type="color"}else if(this._matchesPattern(e,["date","day"])){r.type="date"}else if(this._matchesPattern(e,["time"])){r.type="time"}else if(this._matchesPattern(e,["datetime","timestamp"])){r.type="datetime"}else if(this._matchesPattern(e,["enabled","active","is_","has_"])){r.type="boolean"}else if(this._matchesPattern(e,["price","amount","total","cost","fee"])){r.type="number"}else if(this._matchesPattern(e,["quantity","count","number","age","duration"])){r.type="integer"}else if(this._matchesPattern(e,["tags","categories","keywords"])){r.type="tags"}else if(this._endsWithPattern(e,["_id"])){r.type="relation";r.relation=e.replace(/_id$/,"");r.required=true}if(r.type==="string"){const e=t.find(e=>e!==null&&e!==undefined);if(e!==undefined){const t=this._detectTypeFromValue(e);if(t!=="string"){r.type=t}}}return r},_matchesPattern:function(e,t){const i=e.toLowerCase();return t.some(e=>{const t=e.toLowerCase();return i===t||i.includes(t)||i.startsWith(t)})},_endsWithPattern:function(e,t){const i=e.toLowerCase();return t.some(e=>{const t=e.toLowerCase();return i.endsWith(t)})},_generateLabel:function(e){let t=e.replace(/^(fk_|pk_|r_|tbl_|col_)/i,"").replace(/_id$/i,"");t=t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");t=t.replace(/([a-z])([A-Z])/g,"$1 $2");return t},_detectTypeFromValue:function(e){if(e===null||e===undefined){return"string"}const t=typeof e;switch(t){case"boolean":return"boolean";case"number":return Number.isInteger(e)?"integer":"number";case"string":if(this._isDateString(e)){return"date"}if(this._isTimeString(e)){return"time"}if(this._isDateTimeString(e)){return"datetime"}if(this._isEmailString(e)){return"email"}if(this._isUrlString(e)){return"url"}if(this._isColorString(e)){return"color"}if(e.length>100){return"text"}return"string";case"object":if(e instanceof Date){return"datetime"}if(Array.isArray(e)){return"tags"}return"string";default:return"string"}},_isDateString:function(e){const t=[/^\d{4}-\d{2}-\d{2}$/,/^\d{1,2}\/\d{1,2}\/\d{4}$/,/^\d{1,2}\.\d{1,2}\.\d{4}$/,/^\d{4}\/\d{1,2}\/\d{1,2}$/];return t.some(t=>t.test(e))},_isTimeString:function(e){const t=[/^\d{1,2}:\d{2}(:\d{2})?$/];return t.some(t=>t.test(e))},_isDateTimeString:function(e){const t=[/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/,/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/];return t.some(t=>t.test(e))},_isEmailString:function(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},_isUrlString:function(e){const t=/^(https?:\/\/)/i;return t.test(e)},_isColorString:function(e){const t=/^#([0-9A-F]{3}|[0-9A-F]{6})$/i;return t.test(e)},_isLikelyRelationField:function(e,t){if(e.endsWith("_id")||e.endsWith("Id")||e.endsWith("_key")||e.startsWith("fk_")){return true}if(t.length>0){const e=t.every(e=>typeof e==="number"||typeof e==="string"&&/^[a-zA-Z0-9_-]+$/.test(e));if(e){return true}}return false},_detectRelatedTable:function(e){if(e.endsWith("_id")){return e.substring(0,e.length-3)}if(e.endsWith("Id")&&e.length>2){const t=e.substring(0,e.length-2);return t.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}if(e.startsWith("fk_")&&e.length>3){return e.substring(3)}return e.replace(/_key$/,"").replace(/_code$/,"").replace(/_ref$/,"")},_createDefaultSchema:function(e){return{primaryKey:"id",titleField:"name",subtitleField:"description",columns:[{name:"id",label:"ID",type:"string",visible:true,editable:false,required:false},{name:"name",label:"Name",type:"string",visible:true,editable:true,required:true},{name:"description",label:"Description",type:"text",visible:true,editable:true,required:false},{name:"created_at",label:"Created At",type:"date",visible:true,editable:false,required:false},{name:"updated_at",label:"Updated At",type:"date",visible:true,editable:false,required:false}],relations:[]}}})});
sap.ui.require.preload({
	"com/supabase/easyui5/changes/changes-bundle.json":'{"changes":[],"settings":{}}',
	"com/supabase/easyui5/changes/flexibility-bundle.json":'{"changes":[],"settings":{}}',
	"com/supabase/easyui5/i18n/i18n.properties":'# App Descriptor\nappTitle=Supabase UI5 Application\nappDescription=A UI5 application connected to Supabase\n\n# Home Page\nhomePageTitle=Data Management\nhomeWelcomeMessage=Welcome to the Supabase UI5 Application\n\n# Common\ncreate=Create\nedit=Edit\nsave=Save\ncancel=Cancel\ndelete=Delete\nconfirm=Confirm\nyes=Yes\nno=No\nback=Back\nsearch=Search\nfilter=Filter\nrefresh=Refresh\nloading=Loading...\nnoDataText=No data available\nitemsFound={0} items found\ndetails=Details\n\n# Entity List\nentityListTitle={0} List\nentityListSearchPlaceholder=Search...\nentityListNoData=No {0} found\nentityListDeleteConfirmation=Are you sure you want to delete this {0}?\nentityListDeleteSuccess={0} deleted successfully\nentityListCreateNew=Create New {0}\n\n# Entity Detail\nentityDetailTitle={0} Details\nentityDetailDeleteConfirmation=Are you sure you want to delete this {0}?\nentityDetailDeleteSuccess={0} deleted successfully\nentityDetailSaveSuccess={0} updated successfully\nentityDetailRelatedItems=Related {0}\n\n# Entity Create\nentityCreateTitle=Create New {0}\nentityCreateSuccess={0} created successfully\n\n# NotFound\nnotFoundTitle=Not Found\nnotFoundText=The requested resource was not found\nbackToHome=Back to Home',
	"com/supabase/easyui5/i18n/i18n_de.properties":'appTitle=com.supabase.easyui5\nappDescription=UI5 Application com.supabase.easyui5\nbtnText=Sag Hallo\n',
	"com/supabase/easyui5/i18n/i18n_en.properties":'appTitle=com.supabase.easyui5\nappDescription=UI5 Application com.supabase.easyui5\nbtnText=Say Hello\n',
	"com/supabase/easyui5/manifest.json":'{"_version":"1.48.0","sap.app":{"id":"com.supabase.easyui5","type":"application","applicationVersion":{"version":"0.0.1"},"title":"Supabase UI5 Application","description":"UI5 application connected to Supabase","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":["en","de"],"fallbackLocale":"en"}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":false,"rootView":{"viewName":"com.supabase.easyui5.view.App","type":"XML","async":true,"id":"app"},"dependencies":{"minUI5Version":"1.120.1","libs":{"sap.ui.core":{},"sap.m":{},"sap.ui.layout":{},"sap.f":{},"sap.ui.mdc":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"com.supabase.easyui5.i18n.i18n","supportedLocales":["en","de"],"fallbackLocale":"en"}}},"resources":{"css":[{"uri":"css/style.css"}],"js":[{"name":"com/supabase/easyui5/controller/EntityCreateForm.js"},{"name":"com/supabase/easyui5/controller/EntityDetailForm.js"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","viewType":"XML","viewPath":"com.supabase.easyui5.view","controlId":"app","controlAggregation":"detailPages","transition":"slide","bypassed":{"target":"notFound"},"async":true},"routes":[{"pattern":"","name":"home","target":"home"},{"pattern":"entity/{table}","name":"entityList","target":"entityList"},{"pattern":"entity/{table}/detail/{id}","name":"entityDetail","target":"entityDetail"},{"pattern":"entity/{table}/create","name":"entityCreate","target":"entityCreate"}],"targets":{"home":{"viewId":"home","viewName":"Home","viewLevel":0,"transition":"slide"},"entityList":{"viewId":"entityList","viewName":"EntityList","viewLevel":1,"transition":"slide"},"entityDetail":{"viewId":"entityDetail","viewName":"EntityDetail","viewLevel":2,"transition":"slide"},"entityCreate":{"viewId":"entityCreate","viewName":"EntityCreate","viewLevel":2,"transition":"slide"},"notFound":{"viewId":"notFound","viewName":"NotFound","viewLevel":1,"transition":"slide"}}}}}',
	"com/supabase/easyui5/view/App.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.App"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns:core="sap.ui.core"\n    displayBlock="true"><Shell><SplitApp id="app" \n            defaultTransitionNameDetail="slide" \n            mode="ShowHideMode"\n            afterMasterOpen=".onAfterMasterOpen"\n            afterMasterClose=".onAfterMasterClose"><masterPages><Page id="masterPage" title="Navigation" showHeader="true"><customHeader><Toolbar class="sapContrastPlus sapMTBHeader-CTX"><Title text="Database Tables" level="H2" /><ToolbarSpacer/><Button \n                                id="collapseNavButton"\n                                icon="sap-icon://navigation-left-arrow" \n                                tooltip="Hide Navigation" \n                                press=".onCollapseNav"/></Toolbar></customHeader><content><List id="navigationList" \n                            mode="SingleSelectMaster"\n                            selectionChange=".onNavListItemSelect"><items><StandardListItem \n                                    id="homeItem" \n                                    title="Home" \n                                    icon="sap-icon://home"\n                                    type="Navigation"\n                                    press=".onNavHome" /></items></List></content><footer><Toolbar><ToolbarSpacer/><Button \n                                icon="sap-icon://information" \n                                tooltip="About" \n                                press=".onShowAbout"/><Button \n                                icon="sap-icon://action-settings" \n                                tooltip="Settings" \n                                press=".onShowSettings"/></Toolbar></footer></Page></masterPages><detailPages></detailPages></SplitApp></Shell></mvc:View>',
	"com/supabase/easyui5/view/EntityCreate.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.EntityCreate"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:layout="sap.ui.layout"\n    xmlns:form="sap.ui.layout.form"\n    xmlns:core="sap.ui.core"\n    xmlns:f="sap.f"\n    displayBlock="true"\n    id="entityCreateView"><Page id="entityCreatePage" title="Create New {viewModel>/tableName}" showHeader="true"><customHeader><Toolbar><Button \n                    id="navToggleButton" \n                    icon="sap-icon://menu2" \n                    press=".onToggleNav" /><Title text="Create New {viewModel>/tableName}" level="H2" /><ToolbarSpacer /></Toolbar></customHeader><content><f:DynamicPage showFooter="true"><f:title><f:DynamicPageTitle><f:heading><Title text="Create New {viewModel>/tableName}" /></f:heading></f:DynamicPageTitle></f:title><f:content><form:Form \n    id="entityCreateForm"\n    editable="true"><form:layout><form:ResponsiveGridLayout\n            labelSpanXL="4"\n            labelSpanL="4"\n            labelSpanM="4"\n            labelSpanS="12"\n            adjustLabelSpan="false"\n            emptySpanXL="0"\n            emptySpanL="0"\n            emptySpanM="0"\n            emptySpanS="0"\n            columnsXL="2"\n            columnsL="2"\n            columnsM="1"\n            singleContainerFullSize="false" /></form:layout><form:formContainers><form:FormContainer \n            id="entityCreateContainer"\n            title="Create New Entry"><form:formElements></form:formElements></form:FormContainer></form:formContainers></form:Form></f:content><f:footer><Toolbar><ToolbarSpacer /><Button \n                            type="Accept" \n                            text="Save" \n                            press=".onSavePress" /><Button \n                            type="Reject" \n                            text="Cancel" \n                            press=".onCancelPress" /></Toolbar></f:footer></f:DynamicPage></content></Page></mvc:View>',
	"com/supabase/easyui5/view/EntityDetail.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.EntityDetail"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    xmlns:layout="sap.ui.layout"\n    xmlns:form="sap.ui.layout.form"\n    xmlns:f="sap.f"\n    xmlns:uxap="sap.uxap"\n    displayBlock="true"><Page showHeader="false"><customHeader><Toolbar><Button \n                    id="navToggleButton" \n                    icon="sap-icon://menu2" \n                    press=".onToggleNav" /><Title text="{viewModel>/entityTitle}" level="H2" /><ToolbarSpacer /></Toolbar></customHeader><content><uxap:ObjectPageLayout\n                id="ObjectPageLayout"\n                showTitleInHeaderContent="true"\n                alwaysShowContentHeader="true"\n                showEditHeaderButton="true"\n                editHeaderButtonPress=".onEditPress"\n                upperCaseAnchorBar="false"><uxap:headerTitle><uxap:ObjectPageDynamicHeaderTitle><uxap:heading><Title text="{viewModel>/entityTitle}" wrapping="true" /></uxap:heading><uxap:snappedContent><Text text="{viewModel>/entitySubtitle}" /></uxap:snappedContent><uxap:expandedContent><Text text="{viewModel>/entitySubtitle}" /></uxap:expandedContent><uxap:actions><Button \n                                type="Emphasized" \n                                text="Edit" \n                                icon="sap-icon://edit" \n                                press=".onEditPress" \n                                visible="{= !${viewModel>/editMode} }"/><Button \n                                type="Accept" \n                                text="Save" \n                                icon="sap-icon://save" \n                                press=".onSavePress" \n                                visible="{viewModel>/editMode}"/><Button \n                                type="Reject" \n                                text="Cancel" \n                                icon="sap-icon://cancel" \n                                press=".onCancelPress" \n                                visible="{viewModel>/editMode}"/><Button \n                                type="Reject" \n                                text="Delete" \n                                icon="sap-icon://delete" \n                                press=".onDeletePress"\n                                visible="{= !${viewModel>/editMode} }"/></uxap:actions><uxap:navigationActions><Button \n                                type="Transparent" \n                                icon="sap-icon://nav-back" \n                                press=".onNavBack"/></uxap:navigationActions></uxap:ObjectPageDynamicHeaderTitle></uxap:headerTitle><uxap:headerContent><FlexBox alignItems="Start" justifyContent="SpaceBetween" wrap="Wrap"><layout:VerticalLayout class="sapUiSmallMarginEnd"><ObjectAttribute \n                                title="ID" \n                                text="{viewModel>/entityId}"/><ObjectAttribute \n                                title="Table" \n                                text="{viewModel>/tableName}"/></layout:VerticalLayout><layout:VerticalLayout class="sapUiSmallMarginEnd"><ObjectAttribute \n                                title="Created" \n                                text="{path: \'viewModel>/entity/created_at\', formatter: \'.formatter.formatDate\'}"/><ObjectAttribute \n                                title="Last Updated" \n                                text="{path: \'viewModel>/entity/updated_at\', formatter: \'.formatter.formatDate\'}"/></layout:VerticalLayout><layout:VerticalLayout><ObjectStatus\n                                text="{= ${viewModel>/editMode} ? \'Edit Mode\' : \'View Mode\' }"\n                                state="{= ${viewModel>/editMode} ? \'Warning\' : \'None\' }"/><ObjectAttribute \n                                title="Related Items" \n                                text="{viewModel>/relatedItems/length}"/></layout:VerticalLayout></FlexBox></uxap:headerContent><uxap:sections><uxap:ObjectPageSection title="Details"><uxap:subSections><uxap:ObjectPageSubSection title="Entity Information"><uxap:blocks><form:Form \n                                        id="entityDetailsForm"\n                                        editable="{= ${viewModel>/editMode} ? true : false}"><form:layout><form:ResponsiveGridLayout\n                                                labelSpanXL="4"\n                                                labelSpanL="4"\n                                                labelSpanM="4"\n                                                labelSpanS="12"\n                                                adjustLabelSpan="false"\n                                                emptySpanXL="0"\n                                                emptySpanL="0"\n                                                emptySpanM="0"\n                                                emptySpanS="0"\n                                                columnsXL="2"\n                                                columnsL="2"\n                                                columnsM="1"\n                                                singleContainerFullSize="false" /></form:layout><form:formContainers><form:FormContainer id="entityDetailsContainer"><form:formElements></form:formElements></form:FormContainer></form:formContainers></form:Form></uxap:blocks></uxap:ObjectPageSubSection></uxap:subSections></uxap:ObjectPageSection><uxap:ObjectPageSection title="Related Items" id="relatedItemsSection" visible="true"><uxap:subSections><uxap:ObjectPageSubSection><uxap:blocks><VBox><Table\n                                            id="relatedItemsTable"\n                                            growing="true"\n                                            growingThreshold="10"\n                                            width="100%"\n                                            mode="None"><headerToolbar><Toolbar><Title text="Related Items" level="H2"/><ToolbarSpacer/><SearchField \n                                                        width="30%" \n                                                        search=".onRelatedItemsSearch"\n                                                        placeholder="Search..."/><Button \n                                                        text="Add New" \n                                                        icon="sap-icon://add" \n                                                        press=".onAddRelatedItemPress" \n                                                        type="Emphasized"/></Toolbar></headerToolbar><columns></columns><items><ColumnListItem id="relatedItemRow" type="Inactive"></ColumnListItem></items><noData><FlexBox \n                                                    alignItems="Center" \n                                                    justifyContent="Center" \n                                                    direction="Column"\n                                                    class="sapUiMediumMargin"><core:Icon \n                                                        src="sap-icon://table" \n                                                        size="3rem" \n                                                        class="sapUiMediumMarginBottom" /><Text \n                                                        text="No related items found." \n                                                        class="sapUiTinyMarginBottom"/><Button \n                                                        text="Add New Item" \n                                                        press=".onAddRelatedItemPress" \n                                                        type="Emphasized"/></FlexBox></noData></Table><MessageStrip\n                                            text="This entity cannot be deleted while related items exist"\n                                            type="Warning"\n                                            showIcon="true"\n                                            visible="{= ${viewModel>/relatedItems}.length > 0 }"\n                                            class="sapUiSmallMarginTop"></MessageStrip></VBox></uxap:blocks></uxap:ObjectPageSubSection></uxap:subSections></uxap:ObjectPageSection><uxap:ObjectPageSection title="Additional Information"><uxap:subSections><uxap:ObjectPageSubSection title="Notes &amp; Attachments"><uxap:blocks><VBox><Panel headerText="Notes"><TextArea \n                                                id="notesTextArea"\n                                                rows="4" \n                                                width="100%" \n                                                placeholder="Add notes about this entity..." \n                                                class="sapUiSmallMarginBottom"/><Button text="Save Notes" type="Emphasized" width="auto"/></Panel><Panel headerText="Statistics" class="sapUiMediumMarginTop"><form:SimpleForm\n                                                editable="false"\n                                                layout="ResponsiveGridLayout"\n                                                labelSpanXL="4"\n                                                labelSpanL="4"\n                                                labelSpanM="4"\n                                                labelSpanS="12"\n                                                adjustLabelSpan="false"\n                                                emptySpanXL="0"\n                                                emptySpanL="0"\n                                                emptySpanM="0"\n                                                emptySpanS="0"\n                                                columnsXL="2"\n                                                columnsL="2"\n                                                columnsM="1"><core:Title text="Entity Statistics" /><Label text="Related Items Count" /><Text text="{viewModel>/relatedItems/length}" /><Label text="Last Modified By" /><Text text="System" /><Label text="Creation Date" /><Text text="{path: \'viewModel>/entity/created_at\', formatter: \'.formatter.formatDate\'}" /></form:SimpleForm></Panel></VBox></uxap:blocks></uxap:ObjectPageSubSection></uxap:subSections></uxap:ObjectPageSection></uxap:sections></uxap:ObjectPageLayout></content></Page></mvc:View>',
	"com/supabase/easyui5/view/EntityList.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.EntityList"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:f="sap.f"\n    xmlns:core="sap.ui.core"\n    xmlns:fb="sap.ui.comp.filterbar"\n    xmlns:form="sap.ui.layout.form"\n    xmlns:cd="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"\n    displayBlock="true"><Page id="entityListPage" title="{viewModel>/tableName} List"><customHeader><Toolbar><Button \n                    id="navToggleButton" \n                    icon="sap-icon://menu2" \n                    press=".onToggleNav" /><Title text="{viewModel>/tableName} List" level="H2" /><ToolbarSpacer /><Button icon="sap-icon://add" tooltip="Create New" press=".onCreatePress" /><Button icon="sap-icon://refresh" tooltip="Refresh Data" press=".onRefreshPress" /></Toolbar></customHeader><content><f:DynamicPage id="dynamicPageId" headerExpanded="false" toggleHeaderOnTitleClick="true"><f:title><f:DynamicPageTitle><f:heading><Title text="{viewModel>/tableName} Management" /></f:heading><f:actions><Button \n                                icon="sap-icon://search" \n                                text="Server Search"\n                                tooltip="Expand to search on server" \n                                press=".onServerSearchPress" /></f:actions></f:DynamicPageTitle></f:title><f:header><f:DynamicPageHeader pinnable="true"><f:content><VBox class="sapUiSmallMargin"><HBox alignItems="Center" class="sapUiTinyMarginBottom"><Label text="Advanced Search" class="sapUiSmallMarginEnd" design="Bold" /><ToolbarSpacer /><Button \n                                        text="Search" \n                                        press=".onAdvancedSearch" \n                                        type="Emphasized" \n                                        class="sapUiTinyMarginBegin" /><Button \n                                        text="Reset" \n                                        press=".onResetSearch" \n                                        class="sapUiTinyMarginBegin" /></HBox><form:SimpleForm \n                                    id="searchForm"\n                                    layout="ResponsiveGridLayout"\n                                    editable="true"\n                                    labelSpanXL="4"\n                                    labelSpanL="4"\n                                    labelSpanM="4"\n                                    labelSpanS="12"\n                                    adjustLabelSpan="false"\n                                    emptySpanXL="0"\n                                    emptySpanL="0"\n                                    emptySpanM="0"\n                                    emptySpanS="0"\n                                    columnsXL="2"\n                                    columnsL="2"\n                                    columnsM="1"></form:SimpleForm></VBox></f:content></f:DynamicPageHeader></f:header><f:content><VBox class="sapUiSmallMargin"><MessageStrip\n                            text="Click on any row to view details"\n                            type="Information"\n                            showIcon="true"\n                            class="sapUiSmallMarginBottom"></MessageStrip><HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMarginBottom"><Text id="tableCountText" text="No items" /><Button \n                                text="Columns" \n                                icon="sap-icon://column-chart-dual-axis" \n                                press=".onColumnsButtonPress" \n                                tooltip="Select Columns" /></HBox><VBox id="tableContainer" width="100%" class="sapUiNoContentPadding"><VBox width="100%" class="tableScrollContainer"><Table\n                                    id="entityTable"\n\n                                    growing="true"\n                                    growingThreshold="20"\n                                    growingScrollToLoad="true"\n                                    alternateRowColors="true"\n                                    sticky="ColumnHeaders,HeaderToolbar"><headerToolbar><Toolbar><Title text="{viewModel>/tableName} List" level="H2"/><ToolbarSpacer/><SearchField \n                                                id="tableSearch"\n                                                width="30%" \n                                                search=".onSearch" \n                                                placeholder="Search..."/><Button \n                                                text="Create New" \n                                                icon="sap-icon://add" \n                                                press=".onCreatePress" \n                                                type="Emphasized"/><Button \n                                                icon="sap-icon://refresh" \n                                                tooltip="Refresh Data" \n                                                press=".onRefreshPress" /></Toolbar></headerToolbar><columns></columns><items><ColumnListItem type="Navigation" press=".onItemPress"></ColumnListItem></items></Table></VBox></VBox></VBox></f:content></f:DynamicPage></content><footer><Toolbar><Text text="{viewModel>/filterInfo}" class="sapUiSmallMarginBegin" /><ToolbarSpacer /><Button icon="sap-icon://action-settings" text="Export" press=".onExportPress" /></Toolbar></footer></Page></mvc:View>',
	"com/supabase/easyui5/view/Home.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.Home"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:f="sap.f"\n    xmlns:layout="sap.ui.layout"\n    xmlns:grid="sap.ui.layout.cssgrid"\n    xmlns:core="sap.ui.core"\n    displayBlock="true"><Page id="homePage" title="Dashboard" showHeader="true" class="sapUiNoContentPadding"><customHeader><Toolbar><Button \n                    id="navToggleButton" \n                    icon="sap-icon://navigation-right-arrow" \n                    press=".onToggleNav"\n                    tooltip="Show Navigation" /><Title text="Dashboard" level="H2"/><ToolbarSpacer /><SearchField \n                    id="searchField"\n                    width="30%" \n                    placeholder="Search tables..." \n                    search=".onSearch" /></Toolbar></customHeader><landmarkInfo><PageAccessibleLandmarkInfo\n                rootRole="Region"\n                rootLabel="Home"\n                contentRole="Main"\n                contentLabel="Home Content"\n                headerRole="Banner"\n                headerLabel="Banner"/></landmarkInfo><content><VBox class="sapUiMediumMargin sapUiNoMarginTop sapUiNoMarginBottom"><HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiMediumMarginTop sapUiMediumMarginBottom"><Title text="Welcome to Supabase Data Management" level="H1" titleStyle="H1" class="sapUiNoMarginTop" /></HBox><Text text="Manage your data seamlessly with our powerful Supabase integration" class="sapUiTinyMarginBottom" /></VBox><IconTabBar\n                id="idIconTabBar"\n                select=".onTabSelect"\n                class="sapUiResponsiveContentPadding sapUiNoMarginTop"\n                headerMode="Inline"\n                backgroundDesign="Transparent"\n                expandable="false"><items><IconTabFilter\n                        key="all"\n                        text="All Categories"\n                        icon="sap-icon://home"><layout:Grid\n                            id="categoryGrid"\n                            defaultSpan="XL3 L4 M6 S12"\n                            hSpacing="1"\n                            vSpacing="1"\n                            class="sapUiSmallMarginTop"><layout:content></layout:content></layout:Grid></IconTabFilter><IconTabFilter\n                        key="suppliers"\n                        text="Suppliers"\n                        icon="sap-icon://supplier"><VBox class="sapUiMediumMargin"><Title text="Supplier Management" level="H2" class="sapUiMediumMarginBottom" /><Text text="Manage your suppliers and their contact information." class="sapUiSmallMarginBottom" /><Button \n                                text="Open Suppliers" \n                                type="Emphasized" \n                                press=".onCategoryPress" \n                                class="sapUiSmallMarginTop"><customData><core:CustomData key="table" value="suppliers" /></customData></Button></VBox></IconTabFilter></items></IconTabBar></content><footer><Toolbar><ToolbarSpacer/><Text text="Connected to Supabase" /><ToolbarSpacer/></Toolbar></footer></Page></mvc:View>',
	"com/supabase/easyui5/view/Main.view.xml":'<mvc:View\n\tcontrollerName="com.supabase.easyui5.controller.Main"\n\tdisplayBlock="true"\n\txmlns="sap.m"\n\txmlns:mvc="sap.ui.core.mvc"\n\txmlns:core="sap.ui.core"\n\tcore:require="{\n\t\tformatter: \'com/supabase/easyui5/model/formatter\'\n\t}"><Page\n\t\ttitle="{i18n>appTitle}"\n\t\tid="page"><content><IllustratedMessage\n\t\t\t\ttitle="{i18n>appTitle}"\n\t\t\t\tillustrationType="sapIllus-SuccessHighFive"\n\t\t\t\tenableVerticalResponsiveness="true"\n\t\t\t\tdescription="{i18n>appDescription}"><additionalContent><Button\n\t\t\t\t\t\tid="helloButton"\n\t\t\t\t\t\ttext="{formatter: \'formatter.formatValue\', path: \'i18n>btnText\'}"\n\t\t\t\t\t\tpress="sayHello" /></additionalContent></IllustratedMessage></content></Page></mvc:View>\n',
	"com/supabase/easyui5/view/NotFound.view.xml":'<mvc:View\n    controllerName="com.supabase.easyui5.controller.NotFound"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    displayBlock="true"><Page showHeader="false" title="{i18n>notFoundTitle}"><content><FlexBox\n                height="100%"\n                alignItems="Center"\n                justifyContent="Center"><FlexBox\n                    direction="Column"\n                    alignItems="Center"\n                    justifyContent="Center"\n                    width="100%"><core:Icon\n                        src="sap-icon://document"\n                        size="8rem"\n                        class="sapUiMediumMarginBottom" /><Title\n                        text="{i18n>notFoundTitle}"\n                        level="H1"\n                        titleStyle="H1"\n                        class="sapUiMediumMarginBottom" /><Text\n                        text="{i18n>notFoundText}"\n                        class="sapUiMediumMarginBottom" /><Button\n                        text="{i18n>backToHome}"\n                        press=".onNavBack"\n                        type="Emphasized"\n                        class="sapUiMediumMarginBottom" /></FlexBox></FlexBox></content></Page></mvc:View>'
});
//# sourceMappingURL=Component-preload.js.map
