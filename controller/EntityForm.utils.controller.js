sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/Text","sap/m/Input","sap/m/TextArea","sap/m/CheckBox","sap/m/DatePicker","sap/m/ComboBox","sap/ui/core/Item"],function(e,t,a,r,o,i,n,l){"use strict";return e.extend("com.supabase.easyui5.controller.EntityFormUtils",{loadRelationOptions:function(e,t,a){console.log(`Loading relation options for ${a} from table ${t}`);this.getTableMetadata(t).then(a=>{console.log(`Metadata for related table ${t}:`,JSON.stringify(a,null,2));const r=a.primaryKey;const o=a.titleField||r;console.log(`Primary Key: ${r}, Title Field: ${o}`);this.getSupabaseClient().from(t).select("*").then(({data:t,error:a})=>{if(a){console.error("Error loading relation options",a);return}console.log(`Loaded ${t?t.length:0} relation options`);e.removeAllItems();if(t){t.forEach(t=>{const a=new l({key:t[r],text:t[o]});e.addItem(a);console.log(`Added item: Key=${t[r]}, Text=${t[o]}`)})}})})},createInputField:function(e,l,s,d,u){let c;switch(e.type){case"relation":if(u){c=new t({id:d,text:`Connected to parent ${this.getModel("viewModel").getProperty("/parentInfo/parentTable")} (ID: ${this.getModel("viewModel").getProperty("/parentInfo/parentId")})`})}else{c=new n({id:d,selectedKey:{path:l},width:"100%",required:s,showSecondaryValues:true,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",selectionChange:function(t){t.getSource().setValueState("None");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};if(r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}.bind(this)});this.loadRelationOptions(c,e.relation,e.name)}break;case"boolean":c=new o({id:d,selected:{path:l},width:"100%",select:function(t){const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors");if(r&&r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}.bind(this)});break;case"date":c=new i({id:d,value:{path:l,type:new sap.ui.model.type.Date({pattern:"yyyy-MM-dd"})},valueFormat:"yyyy-MM-dd",displayFormat:"medium",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",change:function(t){if(t.getParameter("valid")){t.getSource().setValueState("None");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors");if(r&&r[e.name]){delete r[e.name];a.setProperty("/validationErrors",r)}}else{t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid date");const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};r[e.name]="Please enter a valid date";a.setProperty("/validationErrors",r)}}.bind(this)});break;case"number":c=new a({id:d,value:{path:l,type:new sap.ui.model.type.Float({minFractionDigits:0,maxFractionDigits:2})},type:"Number",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=this.getModel("viewModel");const o=r.getProperty("/validationErrors")||{};if(a&&isNaN(parseFloat(a))){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid number");o[e.name]="Please enter a valid number";r.setProperty("/validationErrors",o)}else{t.getSource().setValueState("None");if(o[e.name]){delete o[e.name];r.setProperty("/validationErrors",o)}}}.bind(this)});break;case"email":c=new a({id:d,value:{path:l},type:"Email",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const o=this.getModel("viewModel");const i=o.getProperty("/validationErrors")||{};if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid email address");i[e.name]="Please enter a valid email address";o.setProperty("/validationErrors",i)}else{t.getSource().setValueState("None");if(i[e.name]){delete i[e.name];o.setProperty("/validationErrors",i)}}}.bind(this)});break;case"url":c=new a({id:d,value:{path:l},type:"Url",width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}",liveChange:function(t){const a=t.getParameter("value");const r=/^(http|https):\/\/[^ "]+$/;const o=this.getModel("viewModel");const i=o.getProperty("/validationErrors")||{};if(a&&!r.test(a)){t.getSource().setValueState("Error");t.getSource().setValueStateText("Please enter a valid URL (starting with http:// or https://)");i[e.name]="Please enter a valid URL (starting with http:// or https://)";o.setProperty("/validationErrors",i)}else{t.getSource().setValueState("None");if(i[e.name]){delete i[e.name];o.setProperty("/validationErrors",i)}}}.bind(this)});break;case"text":c=new r({id:d,value:{path:l},rows:3,width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"});break;default:c=new a({id:d,value:{path:l},width:"100%",required:s,valueState:"{= ${viewModel>/validationErrors/"+e.name+"} ? 'Error' : 'None' }",valueStateText:"{viewModel>/validationErrors/"+e.name+"}"})}if(c.setId){c.setId(this.getView().createId(e.name+"Input"))}return c},createFieldChangeHandler:function(e){return function(t){if(t.getSource().setValueState){t.getSource().setValueState("None")}this.clearFieldError(e.name)}.bind(this)},setFieldError:function(e,t){const a=this.getModel("viewModel");const r=a.getProperty("/validationErrors")||{};r[e]=t;a.setProperty("/validationErrors",r)},clearFieldError:function(e){const t=this.getModel("viewModel");const a=t.getProperty("/validationErrors")||{};if(a[e]){delete a[e];t.setProperty("/validationErrors",a)}},createDisplayField:function(e,a){let r;switch(e.type){case"relation":const o=a[e.name+"_text"]||a[e.name];r=new t({text:o||""});break;case"boolean":r=new t({text:a[e.name]?"Yes":"No"});break;case"date":r=new t({text:a[e.name]?new Date(a[e.name]).toLocaleDateString():""});break;case"number":r=new t({text:a[e.name]!==undefined?parseFloat(a[e.name]).toFixed(2):""});break;default:r=new t({text:a[e.name]||""})}return r},initFormFields:function(){this.getView().getController()._formFields=this.getView().getController()._formFields||{}},getEntityDataForSave:function(e,t,a){const r={};if(!e||!t){return r}e.columns.forEach(e=>{if(e.editable===false&&e.name!==a||e.name===a){return}r[e.name]=t[e.name]});if("updated_at"in t){r["updated_at"]=(new Date).toISOString()}return r}})});
//# sourceMappingURL=EntityForm.utils.controller.js.map