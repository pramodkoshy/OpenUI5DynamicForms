sap.ui.define(["com/supabase/easyui5/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/Button","sap/m/Text","sap/m/VBox","sap/m/HBox","sap/m/Title","sap/ui/core/Icon","sap/m/Panel","sap/ui/core/CustomData"],function(e,t,s,a,n,o,i,l,r,d,c,p,g){"use strict";return e.extend("com.supabase.easyui5.controller.Main",{onInit:function(){if(!this.getOwnerComponent().getModel("tables")){const e=new t({tables:[{id:"suppliers",title:"Suppliers",icon:"sap-icon://supplier",count:0},{id:"products",title:"Products",icon:"sap-icon://product",count:0},{id:"customers",title:"Customers",icon:"sap-icon://customer",count:0},{id:"orders",title:"Orders",icon:"sap-icon://sales-order",count:0},{id:"order_items",title:"Order Items",icon:"sap-icon://list",count:0}]});this.getOwnerComponent().setModel(e,"tables");console.log("Created fallback tables model")}const e=new t({selectedTab:"all",theme:"sap_horizon",compactDensity:true});this.getView().setModel(e,"settings");this.getView().byId("idIconTabBar").setSelectedKey("all");this._loadTableCounts();this._createCategoryCards()},onToggleNav:function(){const e=this.getOwnerComponent().byId("app");const t=this.getOwnerComponent().getView().getModel("appView");if(e){const s=t?t.getProperty("/navExpanded"):true;if(s){e.hideMaster()}else{e.showMaster()}if(t){t.setProperty("/navExpanded",!s)}}},_createCategoryCards:function(){const e=this.getView().byId("categoryGrid");const t=this.getOwnerComponent().getModel("tables");const s=t.getProperty("/tables");e.removeAllContent();s.forEach(t=>{const s=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});s.addStyleClass("sapUiSmallMargin");s.addStyleClass("categoryCard");const a=new r;a.addStyleClass("sapUiSmallMargin");a.setAlignItems("Center");const n=new c({src:t.icon,size:"2rem",color:"#0854A0"});n.addStyleClass("sapUiSmallMarginEnd");a.addItem(n);const u=new d({text:t.title,level:"H3"});a.addItem(u);s.setHeaderText(t.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+t.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(t.count>0){const e=new i({text:"Total records: "+t.count});e.addStyleClass("sapUiTinyMarginTop");m.addItem(e)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new o({text:"Open "+t.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:t.id,writeToDom:true}));h.addItem(w);m.addItem(h);s.addContent(m);e.addContent(s)})},_loadTableCounts:function(){const e=setInterval(()=>{if(this.getSupabaseClient()){clearInterval(e);this._updateTableCounts()}},500);setTimeout(()=>{clearInterval(e)},1e4)},_updateTableCounts:function(){const e=this.getOwnerComponent().getModel("tables");const t=e.getProperty("/tables");t.forEach(s=>{this.getSupabaseClient().from(s.id).select("*",{count:"exact",head:true}).then(({count:a,error:n})=>{if(!n){const n=t.findIndex(e=>e.id===s.id);if(n!==-1){const t="/tables/"+n+"/count";e.setProperty(t,a||0)}}}).catch(e=>{console.error("Error getting count for table "+s.id,e)})});setTimeout(()=>{this._createCategoryCards()},1e3)},onCategoryPress:function(e){const t=e.getSource();let s="";const a=t.getCustomData();for(let e=0;e<a.length;e++){if(a[e].getKey()==="table"){s=a[e].getValue();break}}if(s){this.getRouter().navTo("entityList",{table:s})}else{n.show("Could not determine which table to open")}},onTabSelect:function(e){const t=e.getParameter("key");const s=this.getView().getModel("settings");s.setProperty("/selectedTab",t);if(t!=="all"){const e=this.getOwnerComponent().getModel("tables");const s=e.getProperty("/tables");const a=s.find(e=>e.id===t);if(a){n.show("Selected "+a.title+" category")}}},onSearch:function(e){const t=e.getParameter("query")||"";if(t.length>0){const e=this.getOwnerComponent().getModel("tables");const s=e.getProperty("/tables");const a=s.filter(e=>e.title.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase()));const u=this.getView().byId("categoryGrid");u.removeAllContent();a.forEach(e=>{const t=new p({expandable:false,expanded:true,backgroundDesign:"Solid"});t.addStyleClass("sapUiSmallMargin");t.addStyleClass("categoryCard");const s=new r;s.addStyleClass("sapUiSmallMargin");s.setAlignItems("Center");const a=new c({src:e.icon,size:"2rem",color:"#0854A0"});a.addStyleClass("sapUiSmallMarginEnd");s.addItem(a);const n=new d({text:e.title,level:"H3"});s.addItem(n);t.setHeaderText(e.title);const m=new l;m.addStyleClass("sapUiSmallMargin");const C=new i({text:"Manage your "+e.title+" data with full CRUD operations"});C.addStyleClass("sapUiTinyMarginBottom");m.addItem(C);const y=new i({text:"Search, filter, and edit records easily"});y.addStyleClass("sapUiTinyMarginBottom");m.addItem(y);if(e.count>0){const t=new i({text:"Total records: "+e.count});t.addStyleClass("sapUiTinyMarginTop");m.addItem(t)}const h=new r;h.addStyleClass("sapUiSmallMarginTop");h.setJustifyContent("End");h.setAlignItems("Center");const w=new o({text:"Open "+e.title,type:"Emphasized",press:this.onCategoryPress.bind(this)});w.addCustomData(new g({key:"table",value:e.id,writeToDom:true}));h.addItem(w);m.addItem(h);t.addContent(m);u.addContent(t)});if(a.length===0){n.show("No tables found matching: "+t)}else{n.show("Found "+a.length+" matching tables")}}else{this._createCategoryCards()}}})});
//# sourceMappingURL=Main.controller.js.map